import{n as ar,o as cr,q as ze,s as N,t as Do,v as Oo,u as lr,x as Lo,y as Go,z as Uo,D as ur,E as No,H as Ho,I as Ut,J as Vo,K as Jo,N as hr,O as zo,Q as jo,R as Ko,S as Xo,X as ko,Y as Wo,Z as Qo,$ as xs,a0 as dr,a1 as en,a2 as qo,a3 as Yo,a4 as $o,a5 as Zo,a6 as ea,a7 as ta,a8 as na,G as ye,a9 as Yn,aa as ut,ab as sa,ac as $n,ad as ia,ae as D,_ as f,af as fr,ag as ra,L as ke,ah as oa,ai as aa,aj as ca,p as ht,a as dt,U as ot,b as Se,g as gr,ak as le,m as la,W as ua,al as zt,am as Zn,an as mr,F as es,ao as ha,ap as da,aq as fa,ar as ts,C as Ue,j as pr,as as p,at as P,au as nt,av as ve,B as ga,aw as ma,ax as pa,ay as ns,az as Aa,aA as Ca,aB as ge,aC as Ne,l as Ar,aD as Ba,aE as ya,aF as _a,aG as Be,aH as ft,aI as Cr,aJ as Ta,M as he,A as Ea}from"./mapbox-layer.7bbd3cb5.js";import{a1 as Ps}from"./framework.5deb65a5.js";import"./commonjsHelpers.725317a4.js";class ss extends ar{constructor(e=0,n=0){super(2),cr(e)&&arguments.length===1?this.copy(e):(ze.debug&&(N(e),N(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return ze.debug&&(N(e.x),N(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Do(this,this,e),this.check()}transformAsVector(e){return Oo(this,this,e),this.check()}transformByMatrix3(e){return lr(this,this,e),this.check()}transformByMatrix2x3(e){return Lo(this,this,e),this.check()}transformByMatrix2(e){return Go(this,this,e),this.check()}}let Bt;class is extends ar{static get ZERO(){return Bt||(Bt=new is(0,0,0,0),Object.freeze(Bt)),Bt}constructor(e=0,n=0,s=0,i=0){super(-0,-0,-0,-0),cr(e)&&arguments.length===1?this.copy(e):(ze.debug&&(N(e),N(n),N(s),N(i)),this[0]=e,this[1]=n,this[2]=s,this[3]=i)}set(e,n,s,i){return this[0]=e,this[1]=n,this[2]=s,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ze.debug&&(N(e.x),N(e.y),N(e.z),N(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=N(e)}get w(){return this[3]}set w(e){this[3]=N(e)}transform(e){return Uo(this,this,e),this.check()}transformByMatrix3(e){return ur(this,this,e),this.check()}transformByMatrix2(e){return No(this,this,e),this.check()}transformByQuaternion(e){return Ho(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function ba(){var t=new Ut(9);return Ut!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Sa(t,e){if(t===e){var n=e[1],s=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function va(t,e){var n=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=-u*r+a*c,g=l*r-o*c,m=n*h+s*d+i*g;return m?(m=1/m,t[0]=h*m,t[1]=(-u*s+i*l)*m,t[2]=(a*s-i*o)*m,t[3]=d*m,t[4]=(u*n-i*c)*m,t[5]=(-a*n+i*r)*m,t[6]=g*m,t[7]=(-l*n+s*c)*m,t[8]=(o*n-s*r)*m,t):null}function Ma(t){var e=t[0],n=t[1],s=t[2],i=t[3],r=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*r-o*c)+n*(-l*i+o*a)+s*(c*i-r*a)}function Fs(t,e,n){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=n[0],g=n[1],m=n[2],A=n[3],C=n[4],y=n[5],_=n[6],T=n[7],E=n[8];return t[0]=d*s+g*o+m*l,t[1]=d*i+g*a+m*u,t[2]=d*r+g*c+m*h,t[3]=A*s+C*o+y*l,t[4]=A*i+C*a+y*u,t[5]=A*r+C*c+y*h,t[6]=_*s+T*o+E*l,t[7]=_*i+T*a+E*u,t[8]=_*r+T*c+E*h,t}function Ia(t,e,n){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=n[0],g=n[1];return t[0]=s,t[1]=i,t[2]=r,t[3]=o,t[4]=a,t[5]=c,t[6]=d*s+g*o+l,t[7]=d*i+g*a+u,t[8]=d*r+g*c+h,t}function Ra(t,e,n){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=Math.sin(n),g=Math.cos(n);return t[0]=g*s+d*o,t[1]=g*i+d*a,t[2]=g*r+d*c,t[3]=g*o-d*s,t[4]=g*a-d*i,t[5]=g*c-d*r,t[6]=l,t[7]=u,t[8]=h,t}function ws(t,e,n){var s=n[0],i=n[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function xa(t,e){var n=e[0],s=e[1],i=e[2],r=e[3],o=n+n,a=s+s,c=i+i,l=n*o,u=s*o,h=s*a,d=i*o,g=i*a,m=i*c,A=r*o,C=r*a,y=r*c;return t[0]=1-h-m,t[3]=u-y,t[6]=d+C,t[1]=u+y,t[4]=1-l-m,t[7]=g-A,t[2]=d-C,t[5]=g+A,t[8]=1-l-h,t}var In;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(In||(In={}));const Pa=Object.freeze([1,0,0,0,1,0,0,0,1]);class G extends Vo{static get IDENTITY(){return wa()}static get ZERO(){return Fa()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return In}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Pa)}fromObject(e){return this.check()}fromQuaternion(e){return xa(this,e),this.check()}set(e,n,s,i,r,o,a,c,l){return this[0]=e,this[1]=n,this[2]=s,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,n,s,i,r,o,a,c,l){return this[0]=e,this[1]=i,this[2]=a,this[3]=n,this[4]=r,this[5]=c,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return Ma(this)}transpose(){return Sa(this,this),this.check()}invert(){return va(this,this),this.check()}multiplyLeft(e){return Fs(this,e,this),this.check()}multiplyRight(e){return Fs(this,this,e),this.check()}rotate(e){return Ra(this,this,e),this.check()}scale(e){return Array.isArray(e)?ws(this,this,e):ws(this,this,[e,e]),this.check()}translate(e){return Ia(this,this,e),this.check()}transform(e,n){let s;switch(e.length){case 2:s=lr(n||[-0,-0],e,this);break;case 3:s=Jo(n||[-0,-0,-0],e,this);break;case 4:s=ur(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hr(s,e.length),s}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let yt,_t;function Fa(){return yt||(yt=new G([0,0,0,0,0,0,0,0,0]),Object.freeze(yt)),yt}function wa(){return _t||(_t=new G,Object.freeze(_t)),_t}function Ds(){var t=new Ut(4);return Ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Da(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Br(t,e,n){n=n*.5;var s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function Os(t,e,n){var s=e[0],i=e[1],r=e[2],o=e[3],a=n[0],c=n[1],l=n[2],u=n[3];return t[0]=s*u+o*a+i*l-r*c,t[1]=i*u+o*c+r*a-s*l,t[2]=r*u+o*l+s*c-i*a,t[3]=o*u-s*a-i*c-r*l,t}function Oa(t,e,n){n*=.5;var s=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=s*c+o*a,t[1]=i*c+r*a,t[2]=r*c-i*a,t[3]=o*c-s*a,t}function La(t,e,n){n*=.5;var s=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=s*c-r*a,t[1]=i*c+o*a,t[2]=r*c+s*a,t[3]=o*c-i*a,t}function Ga(t,e,n){n*=.5;var s=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=s*c+i*a,t[1]=i*c-s*a,t[2]=r*c+o*a,t[3]=o*c-r*a,t}function Ua(t,e){var n=e[0],s=e[1],i=e[2];return t[0]=n,t[1]=s,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-s*s-i*i)),t}function Dt(t,e,n,s){var i=e[0],r=e[1],o=e[2],a=e[3],c=n[0],l=n[1],u=n[2],h=n[3],d,g,m,A,C;return g=i*c+r*l+o*u+a*h,g<0&&(g=-g,c=-c,l=-l,u=-u,h=-h),1-g>$o?(d=Math.acos(g),m=Math.sin(d),A=Math.sin((1-s)*d)/m,C=Math.sin(s*d)/m):(A=1-s,C=s),t[0]=A*i+C*c,t[1]=A*r+C*l,t[2]=A*o+C*u,t[3]=A*a+C*h,t}function Na(t,e){var n=e[0],s=e[1],i=e[2],r=e[3],o=n*n+s*s+i*i+r*r,a=o?1/o:0;return t[0]=-n*a,t[1]=-s*a,t[2]=-i*a,t[3]=r*a,t}function Ha(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function yr(t,e){var n=e[0]+e[4]+e[8],s;if(n>0)s=Math.sqrt(n+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var r=(i+1)%3,o=(i+2)%3;s=Math.sqrt(e[i*3+i]-e[r*3+r]-e[o*3+o]+1),t[i]=.5*s,s=.5/s,t[3]=(e[r*3+o]-e[o*3+r])*s,t[r]=(e[r*3+i]+e[i*3+r])*s,t[o]=(e[o*3+i]+e[i*3+o])*s}return t}var Va=zo,Ja=jo,za=Ko,ja=Xo,Ka=ko,Xa=Wo,_r=Zo,ka=function(){var t=Qo(),e=xs(1,0,0),n=xs(0,1,0);return function(s,i,r){var o=dr(i,r);return o<-.999999?(en(t,e,i),qo(t)<1e-6&&en(t,n,i),Yo(t,t),Br(s,t,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(en(t,i,r),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=1+o,_r(s,s))}}();(function(){var t=Ds(),e=Ds();return function(n,s,i,r,o,a){return Dt(t,s,o,a),Dt(e,i,r,a),Dt(n,t,e,2*a*(1-a)),n}})();(function(){var t=ba();return function(e,n,s,i){return t[0]=s[0],t[3]=s[1],t[6]=s[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],_r(e,yr(e,t))}})();const Wa=[0,0,0,1];class at extends ea{constructor(e=0,n=0,s=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,s,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,s,i){return this[0]=e,this[1]=n,this[2]=s,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return yr(this,e),this.check()}fromAxisRotation(e,n){return Br(this,e,n),this.check()}identity(){return Da(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=N(e)}get y(){return this[1]}set y(e){this[1]=N(e)}get z(){return this[2]}set z(e){this[2]=N(e)}get w(){return this[3]}set w(e){this[3]=N(e)}len(){return Ka(this)}lengthSquared(){return Xa(this)}dot(e){return za(this,e)}rotationTo(e,n){return ka(this,e,n),this.check()}add(e){return Va(this,this,e),this.check()}calculateW(){return Ua(this,this),this.check()}conjugate(){return Ha(this,this),this.check()}invert(){return Na(this,this),this.check()}lerp(e,n,s){return s===void 0?this.lerp(this,e,n):(ja(this,e,n,s),this.check())}multiplyRight(e){return Os(this,this,e),this.check()}multiplyLeft(e){return Os(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return Oa(this,this,e),this.check()}rotateY(e){return La(this,this,e),this.check()}rotateZ(e){return Ga(this,this,e),this.check()}scale(e){return Ja(this,this,e),this.check()}slerp(e,n,s){let i,r,o;switch(arguments.length){case 1:({start:i=Wa,target:r,ratio:o}=e);break;case 2:i=this,r=e,o=n;break;default:i=e,r=n,o=s}return Dt(this,i,r,o),this.check()}transformVector4(e,n=new is){return ta(n,e,this),hr(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const ct={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},Qa=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,qa=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,rs={name:"pbr",vs:Qa,fs:qa,defines:{LIGHTING_FRAGMENT:1},dependencies:[na]},Ya=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),$a=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Za=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),ec=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),tc={POSITION:{size:3,value:new Float32Array($a)},NORMAL:{size:3,value:new Float32Array(Za)},TEXCOORD_0:{size:2,value:new Float32Array(ec)}};class nc extends ye{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Yn("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(Ya)},attributes:{...tc,...e.attributes}})}}const sc=null,ic=null,Rn=null,Tr=null,rc=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:sc,readFileAsText:ic,requireFromFile:Rn,requireFromString:Tr},Symbol.toStringTag,{value:"Module"})),oc="3.4.15",tn={};async function be(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(t=ac(t,e,n)),tn[t]=tn[t]||cc(t),await tn[t]}function ac(t,e,n){if(t.startsWith("http"))return t;const s=n.modules||{};return s[t]?s[t]:ut?n.CDN?(sa(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(oc,"/dist/libs/").concat(t)):$n?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function cc(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!ut)try{return rc&&Rn&&await Rn(t)}catch{return null}if($n)return importScripts(t);const n=await(await fetch(t)).text();return lc(n,t)}function lc(t,e){if(!ut)return Tr;if($n)return eval.call(ia,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function uc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Ls(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Ls(t,0,e):""}function Ls(t,e,n){if(t.byteLength<=e+n)return"";const s=new DataView(t);let i="";for(let r=0;r<n;r++)i+=String.fromCharCode(s.getUint8(e+r));return i}function hc(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(uc(t),'"'))}}function gt(t,e){return D(t>=0),D(e>0),t+(e-1)&~(e-1)}function dc(t,e,n){let s;if(t instanceof ArrayBuffer)s=new Uint8Array(t);else{const i=t.byteOffset,r=t.byteLength;s=new Uint8Array(t.buffer||t.arrayBuffer,i,r)}return e.set(s,n),n+gt(s.byteLength,4)}const fc="Queued Requests",gc="Active Requests",mc="Cancelled Requests",pc="Queued Requests Ever",Ac="Active Requests Ever",Cc={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Bc{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f(this,"props",void 0),f(this,"stats",void 0),f(this,"activeRequestCount",0),f(this,"requestQueue",[]),f(this,"requestMap",new Map),f(this,"deferredUpdate",null),this.props={...Cc,...e},this.stats=new fr({id:this.props.id}),this.stats.get(fc),this.stats.get(gc),this.stats.get(mc),this.stats.get(pc),this.stats.get(Ac)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const s={handle:e,priority:0,getPriority:n},i=new Promise(r=>(s.resolve=r,s));return this.requestQueue.push(s),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:n,resolve:s}=e;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const s=e[n];this._updateRequest(s)||(e.splice(n,1),this.requestMap.delete(s.handle),n--)}e.sort((n,s)=>n.priority-s.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}const nn={};function yc(t){if(nn[t]===void 0){const e=ra?Tc(t):_c(t);nn[t]=e}return nn[t]}function _c(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:s=e}=globalThis;return!!n&&s.includes(t)}function Tc(t){switch(t){case"image/avif":case"image/webp":return Ec(t);default:return!0}}function Ec(t){try{return document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))===0}catch{return!1}}const bc="compositeLayer.renderLayers";class os extends ke{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:s}=this.props;return s&&s[e]&&s[e].type||n}getSubLayerRow(e,n,s){return e.__source={parent:this,object:n,index:s},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(s,i)=>s&&s.__source?(n.index=s.__source.index,e(s.__source.object,n)):e(s,i)}return e}getSubLayerProps(e={}){var n;const{opacity:s,pickable:i,visible:r,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:h,coordinateOrigin:d,wrapLongitude:g,positionFormat:m,modelMatrix:A,extensions:C,fetch:y,operation:_,_subLayerProps:T}=this.props,E={id:"",updateTriggers:{},opacity:s,pickable:i,visible:r,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:h,coordinateOrigin:d,wrapLongitude:g,positionFormat:m,modelMatrix:A,extensions:C,fetch:y,operation:_},S=T&&e.id&&T[e.id],F=S&&S.updateTriggers,w=e.id||"sublayer";if(S){const R=this.props[oa],I=e.type?e.type._propTypes:{};for(const b in S){const q=I[b]||R[b];q&&q.type==="accessor"&&(S[b]=this.getSubLayerAccessor(S[b]))}}Object.assign(E,e,S),E.id="".concat(this.props.id,"-").concat(w),E.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...F};for(const R of C){const I=R.getSubLayerProps.call(this,R);I&&Object.assign(E,I,{updateTriggers:Object.assign(E.updateTriggers,I.updateTriggers)})}return E}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let s=this.internalState.subLayers;const i=!s||this.needsUpdate();if(i){const r=this.renderLayers();s=aa(r,Boolean),this.internalState.subLayers=s}ca(bc,this,i,s);for(const r of s)r.parent=this}}f(os,"layerName","CompositeLayer");const Sc=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vc=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Mc=[0,0,0,255],Ic={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Mc},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class as extends ke{getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Sc,fs:vc,modules:[ht,dt]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:s}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:s,widthMinPixels:i,widthMaxPixels:r,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:ot[n],widthScale:s,widthMinPixels:i,widthMaxPixels:r,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Se(e,{...this.getShaders(),id:this.props.id,geometry:new ye({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}f(as,"layerName","LineLayer");f(as,"defaultProps",Ic);const Rc=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xc=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Er=[0,0,0,255],br=[0,0,1],Pc={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:br},getColor:{type:"accessor",value:Er},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Fc(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class cs extends ke{getShaders(){return super.getShaders({vs:Rc,fs:xc,modules:[ht,gr,dt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:br},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Er}})}updateState(e){const{changeFlags:n,props:s}=e;if(super.updateState(e),n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}n.dataChanged&&Fc(s.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ot[s],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let s=0;s<3;s++){const i=s/3*Math.PI*2;n.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new Se(e,{...this.getShaders(),id:this.props.id,geometry:new ye({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}f(cs,"layerName","PointCloudLayer");f(cs,"defaultProps",Pc);class wc extends ye{constructor(e){const{id:n=Yn("column-geometry")}=e,{indices:s,attributes:i}=Dc(e);super({...e,id:n,indices:s,attributes:i})}}function Dc(t){const{radius:e,height:n=1,nradial:s=10}=t;let{vertices:i}=t;i&&(le.assert(i.length>=s),i=i.flatMap(g=>[g[0],g[1]]),la(i,ua.COUNTER_CLOCKWISE));const r=n>0,o=s+1,a=r?o*3+1:s,c=Math.PI*2/s,l=new Uint16Array(r?s*3*2:0),u=new Float32Array(a*3),h=new Float32Array(a*3);let d=0;if(r){for(let g=0;g<o;g++){const m=g*c,A=g%s,C=Math.sin(m),y=Math.cos(m);for(let _=0;_<2;_++)u[d+0]=i?i[A*2]:y*e,u[d+1]=i?i[A*2+1]:C*e,u[d+2]=(1/2-_)*n,h[d+0]=i?i[A*2]:y,h[d+1]=i?i[A*2+1]:C,d+=3}u[d+0]=u[d-3],u[d+1]=u[d-2],u[d+2]=u[d-1],d+=3}for(let g=r?0:1;g<o;g++){const m=Math.floor(g/2)*Math.sign(.5-g%2),A=m*c,C=(m+s)%s,y=Math.sin(A),_=Math.cos(A);u[d+0]=i?i[C*2]:_*e,u[d+1]=i?i[C*2+1]:y*e,u[d+2]=n/2,h[d+2]=1,d+=3}if(r){let g=0;for(let m=0;m<s;m++)l[g++]=m*2+0,l[g++]=m*2+2,l[g++]=m*2+0,l[g++]=m*2+1,l[g++]=m*2+1,l[g++]=m*2+3}return{indices:l,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:h}}}}const Oc=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Lc=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Nt=[0,0,0,255],Gc={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:Nt},getLineColor:{type:"accessor",value:Nt},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class mt extends ke{getShaders(){const{gl:e}=this.context,n=!zt(e),s={},i=this.props.flatShading&&Zn(e,es.GLSL_DERIVATIVES);return i&&(s.FLAT_SHADING=1),super.getShaders({vs:Oc,fs:Lc,defines:s,transpileToGLSL100:n,modules:[ht,i?mr:gr,dt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Nt},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Nt},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:s,changeFlags:i}=e,r=i.extensionsChanged||n.flatShading!==s.flatShading;if(r){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(r||n.diskResolution!==s.diskResolution||n.vertices!==s.vertices||(n.extruded||n.stroked)!==(s.extruded||s.stroked))&&this._updateGeometry(n)}getGeometry(e,n,s){const i=new wc({radius:1,height:s?2:0,vertices:n,nradial:e});let r=0;if(n)for(let o=0;o<e;o++){const a=n[o],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]);r+=c/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),i}_getModel(e){return new Se(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:s,stroked:i}){const r=this.getGeometry(e,n,s||i);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3,wireframeVertexCount:r.indices.value.length}),this.state.model.setProps({geometry:r})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:s,lineWidthMinPixels:i,lineWidthMaxPixels:r,radiusUnits:o,elevationScale:a,extruded:c,filled:l,stroked:u,wireframe:h,offset:d,coverage:g,radius:m,angle:A}=this.props,{model:C,fillVertexCount:y,wireframeVertexCount:_,edgeDistance:T}=this.state;C.setUniforms(e).setUniforms({radius:m,angle:A/180*Math.PI,offset:d,extruded:c,stroked:u,coverage:g,elevationScale:a,edgeDistance:T,radiusUnits:ot[o],widthUnits:ot[n],widthScale:s,widthMinPixels:i,widthMaxPixels:r}),c&&h&&(C.setProps({isIndexed:!0}),C.setVertexCount(_).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(C.setProps({isIndexed:!1}),C.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&u&&(C.setProps({isIndexed:!1}),C.setVertexCount(y*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}f(mt,"layerName","ColumnLayer");f(mt,"defaultProps",Gc);const Uc={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class jt extends mt{getGeometry(e){return new nc}draw({uniforms:e}){const{elevationScale:n,extruded:s,offset:i,coverage:r,cellSize:o,angle:a,radiusUnits:c}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:ot[c],angle:a,offset:i,extruded:s,coverage:r,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}f(jt,"layerName","GridCellLayer");f(jt,"defaultProps",Uc);const xe={SUM:1,MEAN:2,MIN:3,MAX:4};function Sr(t,e){return t+e}function Nc(t,e){return e>t?e:t}function Hc(t,e){return e<t?e:t}function Vc(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(Sr,0)/n.length:null}function Jc(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(Sr,0):null}function zc(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(Nc,-1/0):null}function jc(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(Hc,1/0):null}function Kc(t,e,n){const s=xe[t]||xe.SUM;switch(e=Xc(e,n),s){case xe.MIN:return i=>jc(i,e);case xe.SUM:return i=>Jc(i,e);case xe.MEAN:return i=>Vc(i,e);case xe.MAX:return i=>zc(i,e);default:return null}}function Xc(t,e={}){return Number.isFinite(t)?t:n=>(e.index=n.index,t(n.source,e))}function kc(t,e={}){return n=>(e.indices=n.map(s=>s.index),t(n.map(s=>s.source),e))}const vr=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Wc(t,e){const n={};for(const s in t)e.includes(s)||(n[s]=t[s]);return n}class ls extends os{constructor(...e){super(...e),f(this,"state",void 0)}initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:Wc(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){const s=this.getShaders({});s&&s.defines&&(s.defines.NON_INSTANCED_MODEL=1),this.updateShaders(s)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:e,mousePosition:n,gl:s}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:n,pickingActive:0,devicePixelRatio:ha(s)})}updateShaders(e){}isAggregationDirty(e,n={}){const{props:s,oldProps:i,changeFlags:r}=e,{compareAll:o=!1,dimension:a}=n,{ignoreProps:c}=this.state,{props:l,accessors:u=[]}=a,{updateTriggersChanged:h}=r;if(r.dataChanged)return!0;if(h){if(h.all)return!0;for(const d of u)if(h[d])return!0}if(o)return r.extensionsChanged?!0:da({oldProps:i,newProps:s,ignoreProps:c,propTypes:this.constructor._propTypes});for(const d of l)if(s[d]!==i[d])return!0;return!1}isAttributeChanged(e){const{changedAttributes:n}=this.state;return e?n&&n[e]!==void 0:!Qc(n)}_getAttributeManager(){return new fa(this.context.gl,{id:this.props.id,stats:this.context.stats})}}f(ls,"layerName","AggregationLayer");function Qc(t){let e=!0;for(const n in t){e=!1;break}return e}function Kt(t,e,n){const s=n;return s.domain=()=>t,s.range=()=>e,s}function Gs(t,e){return Kt(t,e,s=>sl(t,e,s))}function qc(t,e){return Kt(t,e,s=>il(t,e,s))}function Yc(t,e){const n=t.sort(Mr);let s=0;const i=Math.max(1,e.length),r=new Array(i-1);for(;++s<i;)r[s-1]=$c(n,s/i);const o=a=>el(r,e,a);return o.thresholds=()=>r,Kt(t,e,o)}function Mr(t,e){return t-e}function $c(t,e){const n=t.length;if(e<=0||n<2)return t[0];if(e>=1)return t[n-1];const s=(n-1)*e,i=Math.floor(s),r=t[i],o=t[i+1];return r+(o-r)*(s-i)}function Zc(t,e){let n=0,s=t.length;for(;n<s;){const i=n+s>>>1;Mr(t[i],e)>0?s=i:n=i+1}return n}function el(t,e,n){return e[Zc(t,n)]}function tl(t,e,n,s){const i="".concat(s);let r=e.get(i);return r===void 0&&(r=t.push(s),e.set(i,r)),n[(r-1)%n.length]}function nl(t,e){const n=new Map,s=[];for(const r of t){const o="".concat(r);n.has(o)||n.set(o,s.push(r))}return Kt(t,e,r=>tl(s,n,e,r))}function sl(t,e,n){const s=t[1]-t[0];if(s<=0)return le.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const i=s/e.length,r=Math.floor((n-t[0])/i),o=Math.max(Math.min(r,e.length-1),0);return e[o]}function il(t,e,n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}function Ir(t){return t!=null}function rl(t){const e=[];return t.forEach(n=>{!e.includes(n)&&Ir(n)&&e.push(n)}),e}function Rr(t,e){return(typeof e=="function"?t.map(e):t).filter(Ir)}function ol(t,e){return Rr(t,e)}function al(t,e){return rl(Rr(t,e))}function cl(t,e,n){return Math.max(e,Math.min(n,t))}function ll(t){switch(t){case"quantize":return Gs;case"linear":return qc;case"quantile":return Yc;case"ordinal":return nl;default:return Gs}}const xr=t=>t.length,ul=3402823466e29,Pr=t=>t.points,Fr=t=>t.index,Us=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,hl={getValue:xr,getPoints:Pr,getIndex:Fr,filterData:null};class dl{constructor(e=[],n=hl){f(this,"maxCount",void 0),f(this,"maxValue",void 0),f(this,"minValue",void 0),f(this,"totalCount",void 0),f(this,"aggregatedBins",void 0),f(this,"sortedBins",void 0),f(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(e,n),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,n){const{getValue:s=xr,getPoints:i=Pr,getIndex:r=Fr,filterData:o}=n,a=typeof o=="function",c=e.length,l=[];let u=0;for(let h=0;h<c;h++){const d=e[h],g=i(d),m=r(d),A=a?g.filter(o):g;d.filteredPoints=a?A:null;const C=A.length?s(A):null;C!=null&&(l[u]={i:Number.isFinite(m)?m:h,value:C,counts:A.length},u++)}return l}_percentileToIndex(e){const n=this.sortedBins.length;if(n<2)return[0,0];const[s,i]=e.map(a=>cl(a,0,100)),r=Math.ceil(s/100*(n-1)),o=Math.floor(i/100*(n-1));return[r,o]}getBinMap(){const e={};for(const n of this.aggregatedBins)e[n.i]=n;return e}_updateMinMaxValues(){let e=0,n=0,s=ul,i=0;for(const r of this.aggregatedBins)e=e>r.counts?e:r.counts,n=n>r.value?n:r.value,s=s<r.value?s:r.value,i+=r.counts;this.maxCount=e,this.maxValue=n,this.minValue=s,this.totalCount=i}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((i,r)=>Us(i.value,r.value))),!this.sortedBins.length)return[];let n=0,s=this.sortedBins.length-1;if(Array.isArray(e)){const i=this._percentileToIndex(e);n=i[0],s=i[1]}return[this.sortedBins[n].value,this.sortedBins[s].value]}getValueDomainByScale(e,[n=0,s=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((r,o)=>Us(r.value,o.value))),!this.sortedBins.length)return[];const i=this._percentileToIndex([n,s]);return this._getScaleDomain(e,i)}_getScaleDomain(e,[n,s]){const i=this.sortedBins;switch(e){case"quantize":case"linear":return[i[n].value,i[s].value];case"quantile":return ol(i.slice(n,s+1),r=>r.value);case"ordinal":return al(i,r=>r.value);default:return[i[n].value,i[s].value]}}}const wr=6378e3;function fl(t,e,n=!0){if(!n)return{xOffset:e,yOffset:e};const{yMin:s,yMax:i}=t,r=(s+i)/2;return gl(e,r)}function gl(t,e){const n=ml(t),s=pl(e,t);return{yOffset:n,xOffset:s}}function ml(t){return t/wr*(180/Math.PI)}function pl(t,e){return e/wr*(180/Math.PI)/Math.cos(t*Math.PI/180)}function Al(t,e){const n=Cl(t,e),s=Bl(n);return{gridHash:n.gridHash,gridOffset:n.gridOffset,data:s}}function Cl(t,e){const{data:n=[],cellSize:s}=t,{attributes:i,viewport:r,projectPoints:o,numInstances:a}=e,c=i.positions.value,{size:l}=i.positions.getAccessor(),u=e.boundingBox||yl(i.positions,a),h=e.posOffset||[180,90],d=e.gridOffset||fl(u,s);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};const{width:g,height:m}=r,A=Math.ceil(g/d.xOffset),C=Math.ceil(m/d.yOffset),y={},{iterable:_,objectInfo:T}=ts(n),E=new Array(3);for(const S of _){T.index++,E[0]=c[T.index*l],E[1]=c[T.index*l+1],E[2]=l>=3?c[T.index*l+2]:0;const[F,w]=o?r.project(E):E;if(Number.isFinite(F)&&Number.isFinite(w)){const R=Math.floor((w+h[1])/d.yOffset),I=Math.floor((F+h[0])/d.xOffset);if(!o||I>=0&&I<A&&R>=0&&R<C){const b="".concat(R,"-").concat(I);y[b]=y[b]||{count:0,points:[],lonIdx:I,latIdx:R},y[b].count+=1,y[b].points.push({source:S,index:T.index})}}}return{gridHash:y,gridOffset:d,offsets:[h[0]*-1,h[1]*-1]}}function Bl({gridHash:t,gridOffset:e,offsets:n}){const s=new Array(Object.keys(t).length);let i=0;for(const r in t){const o=r.split("-"),a=parseInt(o[0],10),c=parseInt(o[1],10),l=i++;s[l]={index:l,position:[n[0]+e.xOffset*c,n[1]+e.yOffset*a],...t[r]}}return s}function yl(t,e){const n=t.value,{size:s}=t.getAccessor();let i=1/0,r=-1/0,o=1/0,a=-1/0,c,l;for(let u=0;u<e;u++)l=n[u*s],c=n[u*s+1],Number.isFinite(l)&&Number.isFinite(c)&&(i=c<i?c:i,r=c>r?c:r,o=l<o?l:o,a=l>a?l:a);return{xMin:o,xMax:a,yMin:i,yMax:r}}function Ns(){}const Hs=["getBins","getDomain","getScaleFunc"],Vs=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],_l=t=>t.cellSize;class Dr{constructor(e){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||_l,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||Vs)}static defaultDimensions(){return Vs}updateState(e,n){const{oldProps:s,props:i,changeFlags:r}=e;this.updateGetValueFuncs(s,i,r);const o=this.needsReProjectPoints(s,i,r);let a=!1;return r.dataChanged||o?(this.getAggregatedData(i,n),a=!0):((this.getDimensionChanges(s,i,r)||[]).forEach(l=>typeof l=="function"&&l()),a=!0),this.setState({aggregationDirty:a}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,n){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...n}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,n){const i=this._getAggregator(e)(e,n);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,n,s){for(const i in this.dimensionUpdaters){const{value:r,weight:o,aggregation:a}=this.dimensionUpdaters[i].getBins.triggers;let c=n[r.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,e,n,s)&&(c?c=kc(c,{data:n.data}):c=Kc(n[a.prop],n[o.prop],{data:n.data})),c&&this.setDimensionState(i,{getValue:c})}}needsReProjectPoints(e,n,s){return this._getCellSize(e)!==this._getCellSize(n)||this._getAggregator(e)!==this._getAggregator(n)||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach(n=>{const{key:s}=n;this.dimensionUpdaters[s]=this.getDimensionUpdaters(n),this.state.dimensions[s]={getValue:null,domain:null,sortedBins:null,scaleFunc:Ns}})}getDimensionUpdaters({key:e,accessor:n,pickingInfo:s,getBins:i,getDomain:r,getScaleFunc:o,nullValue:a}){return{key:e,accessor:n,pickingInfo:s,getBins:{updater:this.getDimensionSortedBins,...i},getDomain:{updater:this.getDimensionValueDomain,...r},getScaleFunc:{updater:this.getDimensionScale,...o},attributeAccessor:this.getSubLayerDimensionAttribute(e,a)}}needUpdateDimensionStep(e,n,s,i){return Object.values(e.triggers).some(r=>r.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[r.updateTrigger]):n[r.prop]!==s[r.prop])}getDimensionChanges(e,n,s){const i=[];for(const r in this.dimensionUpdaters){const o=Hs.find(a=>this.needUpdateDimensionStep(this.dimensionUpdaters[r][a],e,n,s));o&&i.push(this.dimensionUpdaters[r][o].updater.bind(this,n,this.dimensionUpdaters[r]))}return i.length?i:null}getUpdateTriggers(e){const n=e.updateTriggers||{},s={};for(const i in this.dimensionUpdaters){const{accessor:r}=this.dimensionUpdaters[i];s[r]={},Hs.forEach(o=>{Object.values(this.dimensionUpdaters[i][o].triggers).forEach(({prop:a,updateTrigger:c})=>{if(c){const l=n[c];typeof l=="object"&&!Array.isArray(l)?Object.assign(s[r],l):l!==void 0&&(s[r][a]=l)}else s[r][a]=e[a]})})}return s}getSortedBins(e){for(const n in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[n])}getDimensionSortedBins(e,n){const{key:s}=n,{getValue:i}=this.state.dimensions[s],r=new dl(this.state.layerData.data||[],{getValue:i,filterData:e._filterData});this.setDimensionState(s,{sortedBins:r}),this.getDimensionValueDomain(e,n)}getDimensionValueDomain(e,n){const{getDomain:s,key:i}=n,{triggers:{lowerPercentile:r,upperPercentile:o,scaleType:a}}=s,c=this.state.dimensions[i].sortedBins.getValueDomainByScale(e[a.prop],[e[r.prop],e[o.prop]]);this.setDimensionState(i,{valueDomain:c}),this.getDimensionScale(e,n)}getDimensionScale(e,n){const{key:s,getScaleFunc:i,getDomain:r}=n,{domain:o,range:a}=i.triggers,{scaleType:c}=r.triggers,{onSet:l}=i,u=e[a.prop],h=e[o.prop]||this.state.dimensions[s].valueDomain,g=ll(c&&e[c.prop])(h,u);typeof l=="object"&&typeof e[l.props]=="function"&&e[l.props](g.domain()),this.setDimensionState(s,{scaleFunc:g})}getSubLayerDimensionAttribute(e,n){return s=>{const{sortedBins:i,scaleFunc:r}=this.state.dimensions[e],o=i.binMap[s.index];if(o&&o.counts===0)return n;const a=o&&o.value,c=r.domain();return a>=c[0]&&a<=c[c.length-1]?r(a):n}}getSubLayerAccessors(e){const n={};for(const s in this.dimensionUpdaters){const{accessor:i}=this.dimensionUpdaters[s];n[i]=this.getSubLayerDimensionAttribute(e,s)}return n}getPickingInfo({info:e}){const n=e.picked&&e.index>-1;let s=null;if(n){const i=this.state.layerData.data[e.index],r={};for(const o in this.dimensionUpdaters){const{pickingInfo:a}=this.dimensionUpdaters[o],{sortedBins:c}=this.state.dimensions[o],l=c.binMap[i.index]&&c.binMap[i.index].value;r[a]=l}s=Object.assign(r,i,{points:i.filteredPoints||i.points})}return e.picked=!!s,e.object=s,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:Ns}}function Js(){}const Tl={colorDomain:null,colorRange:vr,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Js,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Js,gridAggregator:Al,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class us extends ls{initializeState(){const e=new Dr({getAggregator:s=>s.gridAggregator,getCellSize:s=>s.cellSize});this.state={cpuAggregator:e,aggregatorState:e.state},this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(e){super.updateState(e),this.setState({aggregatorState:this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:n,cellSize:s,coverage:i,material:r,transitions:o}=this.props,{cpuAggregator:a}=this.state,c=this.getSubLayerClass("grid-cell",jt),l=this._getSublayerUpdateTriggers();return new c({cellSize:s,coverage:i,material:r,elevationScale:e,extruded:n,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:l}),{data:a.state.layerData.data})}}f(us,"layerName","CPUGridLayer");f(us,"defaultProps",Tl);var De=Math.PI/3,El=[0,De,2*De,3*De,4*De,5*De];function bl(t){return t[0]}function Sl(t){return t[1]}function vl(){var t=0,e=0,n=1,s=1,i=bl,r=Sl,o,a,c;function l(h){var d={},g=[],m,A=h.length;for(m=0;m<A;++m)if(!(isNaN(y=+i.call(null,C=h[m],m,h))||isNaN(_=+r.call(null,C,m,h)))){var C,y,_,T=Math.round(_=_/c),E=Math.round(y=y/a-(T&1)/2),S=_-T;if(Math.abs(S)*3>1){var F=y-E,w=E+(y<E?-1:1)/2,R=T+(_<T?-1:1),I=y-w,b=_-R;F*F+S*S>I*I+b*b&&(E=w+(T&1?1:-1)/2,T=R)}var q=E+"-"+T,ne=d[q];ne?ne.push(C):(g.push(ne=d[q]=[C]),ne.x=(E+(T&1)/2)*a,ne.y=T*c)}return g}function u(h){var d=0,g=0;return El.map(function(m){var A=Math.sin(m)*h,C=-Math.cos(m)*h,y=A-d,_=C-g;return d=A,g=C,[y,_]})}return l.hexagon=function(h){return"m"+u(h==null?o:+h).join("l")+"z"},l.centers=function(){for(var h=[],d=Math.round(e/c),g=Math.round(t/a),m=d*c;m<s+o;m+=c,++d)for(var A=g*a+(d&1)*a/2;A<n+a/2;A+=a)h.push([A,m]);return h},l.mesh=function(){var h=u(o).slice(0,4).join("l");return l.centers().map(function(d){return"M"+d+"m"+h}).join("")},l.x=function(h){return arguments.length?(i=h,l):i},l.y=function(h){return arguments.length?(r=h,l):r},l.radius=function(h){return arguments.length?(o=+h,a=o*2*Math.sin(De),c=o*1.5,l):o},l.size=function(h){return arguments.length?(t=e=0,n=+h[0],s=+h[1],l):[n-t,s-e]},l.extent=function(h){return arguments.length?(t=+h[0][0],e=+h[0][1],n=+h[1][0],s=+h[1][1],l):[[t,e],[n,s]]},l.radius(1)}function Ml(t,e){const{data:n,radius:s}=t,{viewport:i,attributes:r}=e,o=n.length?Il(n,e):null,a=Rl(s,i,o),c=[],{iterable:l,objectInfo:u}=ts(n),h=r.positions.value,{size:d}=r.positions.getAccessor();for(const A of l){u.index++;const C=u.index*d,y=[h[C],h[C+1]];Number.isFinite(y[0])&&Number.isFinite(y[1])?c.push({screenCoord:i.projectFlat(y),source:A,index:u.index}):le.warn("HexagonLayer: invalid position")()}return{hexagons:vl().radius(a).x(A=>A.screenCoord[0]).y(A=>A.screenCoord[1])(c).map((A,C)=>({position:i.unprojectFlat([A.x,A.y]),points:A,index:C})),radiusCommon:a}}function Il(t,e){const{attributes:n}=e,s=n.positions.value,{size:i}=n.positions.getAccessor();let r=1/0,o=1/0,a=-1/0,c=-1/0,l;for(l=0;l<i*t.length;l+=i){const u=s[l],h=s[l+1];Number.isFinite(u)&&Number.isFinite(h)&&(r=Math.min(u,r),a=Math.max(u,a),o=Math.min(h,o),c=Math.max(h,c))}return[r,o,a,c].every(Number.isFinite)?[(r+a)/2,(o+c)/2]:null}function Rl(t,e,n){const{unitsPerMeter:s}=e.getDistanceScales(n);return t*s[0]}function zs(){}const xl={colorDomain:null,colorRange:vr,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:zs,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:zs,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:Ml,getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class hs extends ls{constructor(...e){super(...e),f(this,"state",void 0)}initializeState(){const e=new Dr({getAggregator:s=>s.hexagonAggregator,getCellSize:s=>s.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const n=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==n.layerData){const{hexagonVertices:s}=n.layerData||{};this.setState({vertices:s&&this.convertLatLngToMeterOffset(s)})}this.setState({aggregatorState:n})}}convertLatLngToMeterOffset(e){const{viewport:n}=this.context;if(Array.isArray(e)&&e.length===6){const s=e[0],i=e[3],r=[(s[0]+i[0])/2,(s[1]+i[1])/2],o=n.projectFlat(r),{metersPerUnit:a}=n.getDistanceScales(r);return e.map(l=>{const u=n.projectFlat(l);return[(u[0]-o[0])*a[0],(u[1]-o[1])*a[1]]})}return le.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:n,coverage:s,material:i,transitions:r}=this.props,{aggregatorState:o,vertices:a}=this.state,c=this.getSubLayerClass("hexagon-cell",mt),l=this._getSublayerUpdateTriggers(),u=a?{vertices:a,radius:1}:{radius:o.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new c({...u,diskResolution:6,elevationScale:e,extruded:n,coverage:s,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:r&&{getFillColor:r.getColorValue||r.getColorWeight,getElevation:r.getElevationValue||r.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:l}),{data:o.layerData.data})}}f(hs,"layerName","HexagonLayer");f(hs,"defaultProps",xl);const sn=Math.PI/180,Tt=new Float32Array(16),js=new Float32Array(12);function Ks(t,e,n){const s=e[0]*sn,i=e[1]*sn,r=e[2]*sn,o=Math.sin(r),a=Math.sin(s),c=Math.sin(i),l=Math.cos(r),u=Math.cos(s),h=Math.cos(i),d=n[0],g=n[1],m=n[2];t[0]=d*h*u,t[1]=d*c*u,t[2]=d*-a,t[3]=g*(-c*l+h*a*o),t[4]=g*(h*l+c*a*o),t[5]=g*u*o,t[6]=m*(c*o+h*a*l),t[7]=m*(-h*o+c*a*l),t[8]=m*u*l}function Xs(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const Or={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:s,getOrientation:i,getScale:r,getTranslation:o,getTransformMatrix:a}=this.props,c=Array.isArray(a),l=c&&a.length===16,u=Array.isArray(r),h=Array.isArray(i),d=Array.isArray(o),g=l||!c&&!!a(s[0]);g?t.constant=l:t.constant=h&&u&&d;const m=t.value;if(t.constant){let A;g?(Tt.set(a),A=Xs(Tt)):(A=js,Ks(A,i,r),A.set(o,9)),t.value=new Float32Array(A)}else{let A=e*t.size;const{iterable:C,objectInfo:y}=ts(s,e,n);for(const _ of C){y.index++;let T;if(g)Tt.set(l?a:a(_,y)),T=Xs(Tt);else{T=js;const E=h?i:i(_,y),S=u?r:r(_,y);Ks(T,E,S),T.set(d?o:o(_,y),9)}m[A++]=T[0],m[A++]=T[1],m[A++]=T[2],m[A++]=T[3],m[A++]=T[4],m[A++]=T[5],m[A++]=T[6],m[A++]=T[7],m[A++]=T[8],m[A++]=T[9],m[A++]=T[10],m[A++]=T[11]}}}};function Lr(t,e){return e===Ue.CARTESIAN||e===Ue.METER_OFFSETS||e===Ue.DEFAULT&&!t.isGeospatial}const Pl=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Fl=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function Gr(t){let e=1/0,n=1/0,s=1/0,i=-1/0,r=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],h=a[l+1],d=a[l+2];e=u<e?u:e,n=h<n?h:n,s=d<s?d:s,i=u>i?u:i,r=h>r?h:r,o=d>o?d:o}return[[e,n,s],[i,r,o]]}function wl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class Le{constructor(e,n){f(this,"fields",void 0),f(this,"metadata",void 0),wl(Array.isArray(e)),Dl(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(){const e=Object.create(null);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];for(const o of s)e[o]=!0;const r=this.fields.filter(o=>e[o.name]);return new Le(r,this.metadata)}selectAt(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];const i=n.map(r=>this.fields[r]).filter(Boolean);return new Le(i,this.metadata)}assign(e){let n,s=this.metadata;if(e instanceof Le){const o=e;n=o.fields,s=ks(ks(new Map,this.metadata),o.metadata)}else n=e;const i=Object.create(null);for(const o of this.fields)i[o.name]=o;for(const o of n)i[o.name]=o;const r=Object.values(i);return new Le(r,s)}}function Dl(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function ks(t,e){return new Map([...t||new Map,...e||new Map])}class Ht{constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;f(this,"name",void 0),f(this,"type",void 0),f(this,"nullable",void 0),f(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=s,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new Ht(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let L=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({}),Ur,Nr,Hr;class ds{static isNull(e){return e&&e.typeId===L.Null}static isInt(e){return e&&e.typeId===L.Int}static isFloat(e){return e&&e.typeId===L.Float}static isBinary(e){return e&&e.typeId===L.Binary}static isUtf8(e){return e&&e.typeId===L.Utf8}static isBool(e){return e&&e.typeId===L.Bool}static isDecimal(e){return e&&e.typeId===L.Decimal}static isDate(e){return e&&e.typeId===L.Date}static isTime(e){return e&&e.typeId===L.Time}static isTimestamp(e){return e&&e.typeId===L.Timestamp}static isInterval(e){return e&&e.typeId===L.Interval}static isList(e){return e&&e.typeId===L.List}static isStruct(e){return e&&e.typeId===L.Struct}static isUnion(e){return e&&e.typeId===L.Union}static isFixedSizeBinary(e){return e&&e.typeId===L.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===L.FixedSizeList}static isMap(e){return e&&e.typeId===L.Map}static isDictionary(e){return e&&e.typeId===L.Dictionary}get typeId(){return L.NONE}compareTo(e){return this===e}}Ur=Symbol.toStringTag;class We extends ds{constructor(e,n){super(),f(this,"isSigned",void 0),f(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return L.Int}get[Ur](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class Ol extends We{constructor(){super(!0,8)}}class Ll extends We{constructor(){super(!0,16)}}class Gl extends We{constructor(){super(!0,32)}}class Ul extends We{constructor(){super(!1,8)}}class Nl extends We{constructor(){super(!1,16)}}class Hl extends We{constructor(){super(!1,32)}}const Vr={HALF:16,SINGLE:32,DOUBLE:64};Nr=Symbol.toStringTag;class Jr extends ds{constructor(e){super(),f(this,"precision",void 0),this.precision=e}get typeId(){return L.Float}get[Nr](){return"Float"}toString(){return"Float".concat(this.precision)}}class Vl extends Jr{constructor(){super(Vr.SINGLE)}}class Jl extends Jr{constructor(){super(Vr.DOUBLE)}}Hr=Symbol.toStringTag;class zl extends ds{constructor(e,n){super(),f(this,"listSize",void 0),f(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return L.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Hr](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function jl(t){switch(t.constructor){case Int8Array:return new Ol;case Uint8Array:return new Ul;case Int16Array:return new Ll;case Uint16Array:return new Nl;case Int32Array:return new Gl;case Uint32Array:return new Hl;case Float32Array:return new Vl;case Float64Array:return new Jl;default:throw new Error("array type not supported")}}function Kl(t,e,n){const s=jl(e.value),i=n||Xl(e);return new Ht(t,new zl(e.size,new Ht("value",s)),!1,i)}function Xl(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function Ws(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),le.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function Qs(t,e){if(t.attributes)return Ws(t.attributes,e),t instanceof ye?t:new ye(t);if(t.positions||t.POSITION)return Ws(t,e),new ye({attributes:t});throw Error("Invalid mesh")}const kl=[0,0,0,255],Wl={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:kl},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class fs extends ke{constructor(...e){super(...e),f(this,"state",void 0)}getShaders(){const e=!zt(this.context.gl),n={};return Zn(this.context.gl,es.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:Pl,fs:Fl,modules:[ht,mr,dt],transpileToGLSL100:e,defines:n})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let n=this.state.positionBounds;if(n)return n;const{mesh:s}=this.props;if(!s)return null;if(n=(e=s.header)===null||e===void 0?void 0:e.boundingBox,!n){const{attributes:i}=Qs(s,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,n=Gr(i)}return this.state.positionBounds=n,n}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Or}),this.setState({emptyTexture:new pr(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:s,changeFlags:i}=e;if(n.mesh!==s.mesh||i.extensionsChanged){var r;if(this.state.positionBounds=null,(r=this.state.model)===null||r===void 0||r.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==s.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:s,coordinateSystem:i,_instanced:r}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:s,composeModelMatrix:!r||Lr(n,i),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const n=new Se(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:Qs(e,this.props._useMeshColors),isInstanced:!0}),{texture:s}=this.props,{emptyTexture:i}=this.state;return n.setUniforms({sampler:s||i,hasTexture:!!s}),n}setTexture(e){const{emptyTexture:n,model:s}=this.state;s&&s.setUniforms({sampler:e||n,hasTexture:!!e})}}f(fs,"defaultProps",Wl);f(fs,"layerName","SimpleMeshLayer");class He{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||Yn(this.constructor.name),this.display=!0,this.position=new p,this.rotation=new p,this.scale=new p(1,1,1),this.matrix=new P,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return nt(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return nt(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return nt(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:s,scale:i,update:r=!0}=e;return n&&this.setPosition(n),s&&this.setRotation(s),i&&this.setScale(i),r&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,s=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(s),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:s,scale:i}=e;return n&&this.setPosition(n),s&&this.setRotation(s),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,n){nt(e),n=n||this.matrix;const s=new P(e).multiplyRight(n),i=s.invert(),r=i.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:s,worldInverseMatrix:i,worldInverseTransposeMatrix:r}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class rt extends He{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;ve.assert(n.every(s=>s instanceof He),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];for(const i of n)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(e){const n=this.children,s=n.indexOf(e);return s>-1&&n.splice(s,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,s)=>{let{worldMatrix:i}=s;const r=n.getBounds();if(!r)return;const[o,a]=r,c=new p(o).add(a).divide([2,2,2]);i.transformAsPoint(c,c);const l=new p(a).subtract(o).divide([2,2,2]);i.transformAsVector(l,l);for(let u=0;u<8;u++){const h=new p(u&1?-1:1,u&2?-1:1,u&4?-1:1).multiply(l).add(c);for(let d=0;d<3;d++)e[0][d]=Math.min(e[0][d],h[d]),e[1][d]=Math.max(e[1][d],h[d])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:n=new P}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new P(n).multiplyRight(this.matrix);for(const i of this.children)i instanceof rt?i.traverse(e,{worldMatrix:s}):e(i,{worldMatrix:s})}}const Ql={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ql={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function qs(t){if(!t._animation){const e=ql[t.componentType],n=Ql[t.type],s=n*t.count,{buffer:i,byteOffset:r}=t.bufferView.data,o=new e(i,r+(t.byteOffset||0),s);if(n===1)t._animation=Array.from(o);else{const a=[];for(let c=0;c<o.length;c+=n)a.push(Array.from(o.slice(c,c+n)));t._animation=a}}return t._animation}const Yl=new P;function $l(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=Yl.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const rn=new at;function Zl(t,e,n,s,i){if(e==="rotation"){rn.slerp({start:n,target:s,ratio:i});for(let r=0;r<rn.length;r++)t[e][r]=rn[r]}else for(let r=0;r<n.length;r++)t[e][r]=i*s[r]+(1-i)*n[r]}function eu(t,e,n){let{p0:s,outTangent0:i,inTangent1:r,p1:o,tDiff:a,ratio:c}=n;for(let l=0;l<t[e].length;l++){const u=i[l]*a,h=r[l]*a;t[e][l]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*s[l]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*u+(-2*Math.pow(c,3)+3*Math.pow(c,2))*o[l]+(Math.pow(c,3)-Math.pow(c,2))*h}}function tu(t,e,n){for(let s=0;s<n.length;s++)t[e][s]=n[s]}function nu(t,e,n,s){let{input:i,interpolation:r,output:o}=e;const a=i[i.length-1],c=t%a,l=i.findIndex(g=>g>=c),u=Math.max(0,l-1);if(!Array.isArray(n[s]))switch(s){case"translation":n[s]=[0,0,0];break;case"rotation":n[s]=[0,0,0,1];break;case"scale":n[s]=[1,1,1];break;default:ve.warn("Bad animation path ".concat(s))()}nt(n[s].length===o[u].length);const h=i[u],d=i[l];switch(r){case"STEP":tu(n,s,o[u]);break;case"LINEAR":if(d>h){const g=(c-h)/(d-h);Zl(n,s,o[u],o[l],g)}break;case"CUBICSPLINE":if(d>h){const g=(c-h)/(d-h),m=d-h,A=o[3*u+1],C=o[3*u+2],y=o[3*l+0],_=o[3*l+1];eu(n,s,{p0:A,outTangent0:C,inTangent1:y,p1:_,tDiff:m,ratio:g})}break;default:ve.warn("Interpolation ".concat(r," not supported"))();break}}class su{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const s=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:r,target:o,path:a}=i;nu(s,r,o,a),$l(o,o._node)})}}class iu{constructor(e){this.animations=e.animations.map((n,s)=>{const i=n.name||"Animation-".concat(s),r=n.samplers.map(a=>{let{input:c,interpolation:l="LINEAR",output:u}=a;return{input:qs(e.accessors[c]),interpolation:l,output:qs(e.accessors[u])}}),o=n.channels.map(a=>{let{sampler:c,target:l}=a;return{sampler:r[c],target:e.nodes[l.node],path:l.path}});return new su({name:i,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class ru extends He{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof Se?(this.model=e,this._setModelNodeProps(n)):this.model=new Se(e,n),this.bounds=null,this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class zr{constructor(e,n){let{attributes:s,material:i,pbrDebug:r,imageBasedLightingEnvironment:o,lights:a,useTangents:c}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Zn(e,es.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),r&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(s.NORMAL,"HAS_NORMALS"),this.defineIfPresent(s.TANGENT&&c,"HAS_TANGENTS"),this.defineIfPresent(s.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(r,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},r=e.texture.source.image;let o,a={};r.compressed?(o=r,a={[this.gl.TEXTURE_MIN_FILTER]:r.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):o={data:r};const c=new pr(this.gl,{id:e.name||e.id,parameters:{...i,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...o});this.uniforms[n]=c,this.defineIfPresent(s,s),this.generatedTextures.push(c)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:s=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,s]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(ve.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const ou=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,au=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Ys(t,e){return zt(t)?`#version 300 es
`.concat(e):e}function cu(t,e){const{id:n,drawMode:s,vertexCount:i,attributes:r,modelOptions:o}=e,a=new zr(t,e);ve.info(4,"createGLTFModel defines: ",a.defines)();const c=[];c.push(...a.generatedTextures),c.push(...Object.values(r).map(u=>u.buffer));const l=new ru(t,{id:n,drawMode:s,vertexCount:i,modules:[rs],parameters:a.parameters,vs:Ys(t,ou),fs:Ys(t,au),managedResources:c,...o,defines:{...a.defines,...o.defines}});return l.setProps({attributes:r}),l.setUniforms(a.uniforms),l}const lu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uu={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class hu{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},uu,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(s=>this.createScene(s))}createAnimator(){return Array.isArray(this.gltf.animations)?new iu(this.gltf):null}createScene(e){const s=(e.nodes||[]).map(r=>this.createNode(r));return new rt({id:e.name||e.id,children:s})}createNode(e){if(!e._node){const s=(e.children||[]).map(r=>this.createNode(r));e.mesh&&s.push(this.createMesh(e.mesh));const i=new rt({id:e.name||e.id,children:s});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const r=new P().fromQuaternion(e.rotation);i.matrix.multiplyRight(r)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const s=(e.primitives||[]).map((r,o)=>this.createPrimitive(r,o,e)),i=new rt({id:e.name||e.id,children:s});e._mesh=i}return e._mesh}getVertexCount(e){ve.warn("getVertexCount() not found")()}createPrimitive(e,n,s){const i=cu(this.gl,Object.assign({id:e.name||"".concat(s.name||s.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return i.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],i}createAttributes(e,n){const s={};return Object.keys(e).forEach(i=>{s[i]=this.createAccessor(e[i],this.createBuffer(e[i],this.gl.ARRAY_BUFFER))}),n&&(s.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),ve.info(4,"glTF Attributes",{attributes:e,indices:n,generated:s})(),s}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:s}=e;return s.lumaBuffers||(s.lumaBuffers={}),s.lumaBuffers[n]||(s.lumaBuffers[n]=new ga(this.gl,{id:"from-".concat(s.id),data:s.data||e.value,target:n})),s.lumaBuffers[n]}createAccessor(e,n){return new ma({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:lu[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function du(t,e,n){const s=new hu(t,n),i=s.instantiate(e),r=s.createAnimator();return{scenes:i,animator:r}}const fu="3.4.15",gu="3.4.15",jr="3.4.15",mu="https://unpkg.com/@loaders.gl/textures@".concat(jr,"/dist/libs/basis_encoder.wasm"),pu="https://unpkg.com/@loaders.gl/textures@".concat(jr,"/dist/libs/basis_encoder.js");let on;async function $s(t){const e=t.modules||{};return e.basis?e.basis:(on=on||Au(t),await on)}async function Au(t){let e=null,n=null;return[e,n]=await Promise.all([await be("basis_transcoder.js","textures",t),await be("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await Cu(e,n)}function Cu(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(s=>{t(n).then(i=>{const{BasisFile:r,initializeBasis:o}=i;o(),s({BasisFile:r})})})}let an;async function Zs(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(an=an||Bu(t),await an)}async function Bu(t){let e=null,n=null;return[e,n]=await Promise.all([await be(pu,"textures",t),await be(mu,"textures",t)]),e=e||globalThis.BASIS,await yu(e,n)}function yu(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(s=>{t(n).then(i=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:c}=i;a(),s({BasisFile:r,KTX2File:o,BasisEncoder:c})})})}const Pe={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},_u=["","WEBKIT_","MOZ_"],ei={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Et=null;function Tu(t){if(!Et){t=t||Eu()||void 0,Et=new Set;for(const e of _u)for(const n in ei)if(t&&t.getExtension("".concat(e).concat(n))){const s=ei[n];Et.add(s)}}return Et}function Eu(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var ti,ni,si,ii,ri,oi,ai,ci;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(ti||(ti={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(ni||(ni={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(si||(si={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(ii||(ii={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(ri||(ri={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(oi||(oi={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(ai||(ai={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(ci||(ci={}));const X=[171,75,84,88,32,50,48,187,13,10,26,10];function bu(t){const e=new Uint8Array(t);return!(e.byteLength<X.length||e[0]!==X[0]||e[1]!==X[1]||e[2]!==X[2]||e[3]!==X[3]||e[4]!==X[4]||e[5]!==X[5]||e[6]!==X[6]||e[7]!==X[7]||e[8]!==X[8]||e[9]!==X[9]||e[10]!==X[10]||e[11]!==X[11])}const Su={etc1:{basisFormat:0,compressed:!0,format:Pe.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Pe.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Pe.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Pe.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Pe.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Pe.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function vu(t,e){if(e.basis.containerFormat==="auto"){if(bu(t)){const s=await Zs(e);return li(s.KTX2File,t,e)}const{BasisFile:n}=await $s(e);return cn(n,t,e)}switch(e.basis.module){case"encoder":const n=await Zs(e);switch(e.basis.containerFormat){case"ktx2":return li(n.KTX2File,t,e);case"basis":default:return cn(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:s}=await $s(e);return cn(s,t,e)}}function cn(t,e,n){const s=new t(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const i=s.getNumImages(),r=[];for(let o=0;o<i;o++){const a=s.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(Mu(s,o,l,n));r.push(c)}return r}finally{s.close(),s.delete()}}function Mu(t,e,n,s){const i=t.getImageWidth(e,n),r=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=Kr(s,o),u=t.getImageTranscodedSizeInBytes(e,n,l),h=new Uint8Array(u);if(!t.transcodeImage(h,e,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:r,data:h,compressed:a,format:c,hasAlpha:o}}function li(t,e,n){const s=new t(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=s.getLevels(),r=[];for(let o=0;o<i;o++){r.push(Iu(s,o,n));break}return[r]}finally{s.close(),s.delete()}}function Iu(t,e,n){const{alphaFlag:s,height:i,width:r}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=Kr(n,s),l=t.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!t.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:i,data:u,compressed:o,levelSize:l,hasAlpha:s,format:a}}function Kr(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=Xr()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),Su[n]}function Xr(){const t=Tu();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Ru={name:"Basis",id:ut?"basis":"basis-nodejs",module:"textures",version:gu,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},xu={...Ru,parse:vu};function Q(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function kr(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const s=e.baseUri||e.uri;if(!s)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return s.substr(0,s.lastIndexOf("/")+1)+t}function Pu(t,e,n){const s=t.bufferViews[n];Q(s);const i=s.buffer,r=e[i];Q(r);const o=(s.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,s.byteLength)}const ui=["SCALAR","VEC2","VEC3","VEC4"],Fu=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],wu=new Map(Fu),Du={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ou={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Lu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Wr(t){return ui[t-1]||ui[0]}function Qr(t){const e=wu.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function gs(t,e){const n=Lu[t.componentType],s=Du[t.type],i=Ou[t.componentType],r=t.count*s,o=t.count*s*i;return Q(o>=0&&o<=e.byteLength),{ArrayType:n,length:r,byteLength:o}}function qr(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const s=e.map(o=>o.bufferView);n=n.filter(o=>!s.includes(o));const i=n.reduce((o,a)=>o+a.byteLength,0),r=e.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return i+Math.ceil(4*r*1.33)}const Gu={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class K{constructor(e){f(this,"gltf",void 0),f(this,"sourceBuffers",void 0),f(this,"byteLength",void 0),this.gltf=e||{json:{...Gu},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(i=>i===e),s=this.json.extensions||{};return n?s[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(s=>s===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const s=this.json[e]&&this.json[e][n];if(!s)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return s}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,s=this.gltf.buffers[n];Q(s);const i=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,{ArrayType:r,length:o}=gs(e,n),a=n.byteOffset+e.byteOffset;return new r(i,a,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),i=this.getBuffer(n.buffer).data,r=n.byteOffset||0;return new Uint8Array(i,r,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,s){return e.extensions=e.extensions||{},e.extensions[n]=s,this.registerUsedExtension(n),this}setObjectExtension(e,n,s){const i=e.extensions||{};i[n]=s}removeObjectExtension(e,n){const s=e.extensions||{},i=s[n];return delete s[n],i}addExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Q(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Q(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:s}=e;this.json.nodes=this.json.nodes||[];const i={mesh:n};return s&&(i.matrix=s),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:s,material:i,mode:r=4}=e,a={primitives:[{attributes:this._addAttributes(n),mode:r}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(i)&&(a.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const s={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(e,n){const s=pa(e),i=n||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const n=e.byteLength;Q(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=gt(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,n){const s={bufferView:e,type:Wr(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const s=this.addBufferView(e);let i={min:n.min,max:n.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,n.size));const r={size:n.size,componentType:Qr(e),count:Math.round(e.length/n.size),min:i.min,max:i.max};return this.addAccessor(s,Object.assign(r,n))}addTexture(e){const{imageIndex:n}=e,s={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const s=this.byteLength,i=new ArrayBuffer(s),r=new Uint8Array(i);let o=0;for(const a of this.sourceBuffers||[])o=dc(a,r,o);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,n){let s=!0;for(;s;){const i=e.indexOf(n);i>-1?e.splice(i,1):s=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const s in e){const i=e[s],r=this._getGltfAttributeName(s),o=this.addBinaryBuffer(i.value,i);n[r]=o}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const s={min:null,max:null};if(e.length<n)return s;s.min=[],s.max=[];const i=e.subarray(0,n);for(const r of i)s.min.push(r),s.max.push(r);for(let r=n;r<e.length;r+=n)for(let o=0;o<n;o++)s.min[0+o]=Math.min(s.min[0+o],e[r+o]),s.max[0+o]=Math.max(s.max[0+o],e[r+o]);return s}}const Uu="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",Nu="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",Hu=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Vu=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ju={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},zu={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function ju(t,e,n,s,i){let r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await Ku();Wu(o,o.exports[zu[i]],t,e,n,s,o.exports[Ju[r||"NONE"]])}let ln;async function Ku(){return ln||(ln=Xu()),ln}async function Xu(){let t=Uu;WebAssembly.validate(Hu)&&(t=Nu,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(ku(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function ku(t){const e=new Uint8Array(t.length);for(let s=0;s<t.length;++s){const i=t.charCodeAt(s);e[s]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let n=0;for(let s=0;s<t.length;++s)e[n++]=e[s]<60?Vu[e[s]]:(e[s]-60)*64+e[++s];return e.buffer.slice(0,n)}function Wu(t,e,n,s,i,r,o){const a=t.exports.sbrk,c=s+3&-4,l=a(c*i),u=a(r.length),h=new Uint8Array(t.exports.memory.buffer);h.set(r,u);const d=e(l,s,i,u,r.length);if(d===0&&o&&o(l,c,i),n.set(h.subarray(l,l+s*i)),a(l-a(0)),d!==0)throw new Error("Malformed buffer data: ".concat(d))}const ms="EXT_meshopt_compression",Qu=ms;async function qu(t,e){var n;const s=new K(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const i=[];for(const r of t.json.bufferViews||[])i.push(Yu(s,r));await Promise.all(i),s.removeExtension(ms)}async function Yu(t,e){const n=t.getObjectExtension(e,ms);if(n){const{byteOffset:s=0,byteLength:i=0,byteStride:r,count:o,mode:a,filter:c="NONE",buffer:l}=n,u=t.gltf.buffers[l],h=new Uint8Array(u.arrayBuffer,u.byteOffset+s,i),d=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await ju(d,o,r,h,a,c),d}return null}const $u=Object.freeze(Object.defineProperty({__proto__:null,decode:qu,name:Qu},Symbol.toStringTag,{value:"Module"})),Oe="EXT_texture_webp",Zu=Oe;function eh(t,e){const n=new K(t);if(!yc("image/webp")){if(n.getRequiredExtensions().includes(Oe))throw new Error("gltf: Required extension ".concat(Oe," not supported by browser"));return}const{json:s}=n;for(const i of s.textures||[]){const r=n.getObjectExtension(i,Oe);r&&(i.source=r.source),n.removeObjectExtension(i,Oe)}n.removeExtension(Oe)}const th=Object.freeze(Object.defineProperty({__proto__:null,name:Zu,preprocess:eh},Symbol.toStringTag,{value:"Module"})),Ot="KHR_texture_basisu",nh=Ot;function sh(t,e){const n=new K(t),{json:s}=n;for(const i of s.textures||[]){const r=n.getObjectExtension(i,Ot);r&&(i.source=r.source),n.removeObjectExtension(i,Ot)}n.removeExtension(Ot)}const ih=Object.freeze(Object.defineProperty({__proto__:null,name:nh,preprocess:sh},Symbol.toStringTag,{value:"Module"})),rh="3.4.15",oh={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},ah={name:"Draco",id:ut?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:rh,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:oh};function ch(t,e,n){const s=Yr(e.metadata),i=[],r=lh(e.attributes);for(const o in t){const a=t[o],c=hi(o,a,r[o]);i.push(c)}if(n){const o=hi("indices",n);i.push(o)}return new Le(i,s)}function lh(t){const e={};for(const n in t){const s=t[n];e[s.name||"undefined"]=s}return e}function hi(t,e,n){const s=n?Yr(n.metadata):void 0;return Kl(t,e,s)}function Yr(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const di={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},uh={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},hh=4;class dh{constructor(e){f(this,"draco",void 0),f(this,"decoder",void 0),f(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const i=this.decoder.GetEncodedGeometryType(s),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(i){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,r);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!r.ptr){const d="DRACO decompression failed: ".concat(o.error_msg());throw new Error(d)}const a=this._getDracoLoaderData(r,i,n),c=this._getMeshData(r,a,n),l=Gr(c.attributes),u=ch(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:r.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(s),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,n,s){const i=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,s);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(e,n){const s={};for(let i=0;i<e.num_attributes();i++){const r=this.decoder.GetAttribute(e,i),o=this._getAttributeMetadata(e,i);s[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:o};const a=this._getQuantizationTransform(r,n);a&&(s[r.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(r,n);c&&(s[r.unique_id()].octahedron_transform=c)}return s}_getMeshData(e,n,s){const i=this._getMeshAttributes(n,e,s);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,n,s){const i={};for(const r of Object.values(e.attributes)){const o=this._deduceAttributeName(r,s);r.name=o;const{value:a,size:c}=this._getAttributeValues(n,r);i[o]={value:a,size:c,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return i}_getTriangleListIndices(e){const s=e.num_faces()*3,i=s*hh,r=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,r),new Uint32Array(this.draco.HEAPF32.buffer,r,s).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),mh(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const s=uh[n.data_type],i=n.num_components,o=e.num_points()*i,a=o*s.BYTES_PER_ELEMENT,c=fh(this.draco,s);let l;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,h,c,a,u),l=new s(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:i}}_deduceAttributeName(e,n){const s=e.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===s)return o;const i=e.attribute_type;for(const o in di)if(this.draco[o]===i)return di[o];const r=n.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:"CUSTOM_ATTRIBUTE_".concat(s)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const s=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},s=this.metadataQuerier.NumEntries(e);for(let i=0;i<s;i++){const r=this.metadataQuerier.GetEntryName(e,i);n[r]=this._getDracoMetadataField(e,r)}return n}_getDracoMetadataField(e,n){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,s);const i=gh(s);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:i}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:s=[]}=e,i=[...n,...s];for(const r of i)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,n){const{quantizedAttributes:s=[]}=n,i=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:s=[]}=n,i=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function fh(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function gh(t){const e=t.size(),n=new Int32Array(e);for(let s=0;s<e;s++)n[s]=t.GetValue(s);return n}function mh(t){const e=t.size(),n=new Int32Array(e);for(let s=0;s<e;s++)n[s]=t.GetValue(s);return n}const ph="1.5.5",ps="https://www.gstatic.com/draco/versioned/decoders/".concat(ph),Ah="".concat(ps,"/draco_decoder.js"),Ch="".concat(ps,"/draco_wasm_wrapper.js"),Bh="".concat(ps,"/draco_decoder.wasm");let qe;async function yh(t){const e=t.modules||{};return e.draco3d?qe=qe||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):qe=qe||_h(t),await qe}async function _h(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await be(Ah,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await be(Ch,"draco",t),await be(Bh,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await Th(e,n)}function Th(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(s=>{t({...n,onModuleLoaded:i=>s({draco:i})})})}const $r={...ah,parse:Eh};async function Eh(t,e){const{draco:n}=await yh(e),s=new dh(n);try{return s.parseSync(t,e==null?void 0:e.draco)}finally{s.destroy()}}function bh(t){const e={};for(const n in t){const s=t[n];if(n!=="indices"){const i=Zr(s);e[n]=i}}return e}function Zr(t){const{buffer:e,size:n,count:s}=Sh(t);return{value:e,size:n,byteOffset:0,count:s,type:Wr(n),componentType:Qr(e)}}function Sh(t){let e=t,n=1,s=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=vh(e,Float32Array)),s=e.length/n),{buffer:e,size:n,count:s}}function vh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const Me="KHR_draco_mesh_compression",Mh=Me;function Ih(t,e,n){const s=new K(t);for(const i of eo(s))s.getObjectExtension(i,Me)}async function Rh(t,e,n){var s;if(!(e!=null&&(s=e.gltf)!==null&&s!==void 0&&s.decompressMeshes))return;const i=new K(t),r=[];for(const o of eo(i))i.getObjectExtension(o,Me)&&r.push(Ph(i,o,e,n));await Promise.all(r),i.removeExtension(Me)}function xh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new K(t);for(const s of n.json.meshes||[])Fh(s,e),n.addRequiredExtension(Me)}async function Ph(t,e,n,s){const i=t.getObjectExtension(e,Me);if(!i)return;const r=t.getTypedArrayForBufferView(i.bufferView),o=ns(r.buffer,r.byteOffset),{parse:a}=s,c={...n};delete c["3d-tiles"];const l=await a(o,$r,c,s),u=bh(l.attributes);for(const[h,d]of Object.entries(u))if(h in e.attributes){const g=e.attributes[h],m=t.getAccessor(g);m!=null&&m.min&&m!==null&&m!==void 0&&m.max&&(d.min=m.min,d.max=m.max)}e.attributes=u,l.indices&&(e.indices=Zr(l.indices)),wh(e)}function Fh(t,e){var n;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:t}),a=r==null||(n=r.parseSync)===null||n===void 0?void 0:n.call(r,{attributes:t}),c=i._addFauxAttributes(a.attributes),l=i.addBufferView(o);return{primitives:[{attributes:c,mode:s,extensions:{[Me]:{bufferView:l,attributes:c}}}]}}function wh(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*eo(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const Dh=Object.freeze(Object.defineProperty({__proto__:null,decode:Rh,encode:xh,name:Mh,preprocess:Ih},Symbol.toStringTag,{value:"Module"})),Oh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Lh={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},As="KHR_texture_transform",Gh=As,bt=new p,Uh=new G,Nh=new G;async function Hh(t,e){if(!new K(t).getExtension(As))return;const i=t.json.materials||[];for(let r=0;r<i.length;r++)Vh(r,t)}function Vh(t,e){var n,s,i;const r=[],o=(n=e.json.materials)===null||n===void 0?void 0:n[t],a=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.baseColorTexture;a&&Ye(e,t,a,r);const c=o==null?void 0:o.emissiveTexture;c&&Ye(e,t,c,r);const l=o==null?void 0:o.normalTexture;l&&Ye(e,t,l,r);const u=o==null?void 0:o.occlusionTexture;u&&Ye(e,t,u,r);const h=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;h&&Ye(e,t,h,r)}function Ye(t,e,n,s){const i=Jh(n,s);if(!i)return;const r=t.json.meshes||[];for(const o of r)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&e===c&&zh(t,a,i)}}function Jh(t,e){var n;const s=(n=t.extensions)===null||n===void 0?void 0:n[As],{texCoord:i=0}=t,{texCoord:r=i}=s;if(!(e.findIndex(a=>{let[c,l]=a;return c===i&&l===r})!==-1)){const a=Xh(s);return i!==r&&(t.texCoord=r),e.push([i,r]),{originalTexCoord:i,texCoord:r,matrix:a}}return null}function zh(t,e,n){const{originalTexCoord:s,texCoord:i,matrix:r}=n,o=e.attributes["TEXCOORD_".concat(s)];if(Number.isFinite(o)){var a;const l=(a=t.json.accessors)===null||a===void 0?void 0:a[o];if(l&&l.bufferView){var c;const u=(c=t.json.bufferViews)===null||c===void 0?void 0:c[l.bufferView];if(u){const{arrayBuffer:h,byteOffset:d}=t.buffers[u.buffer],g=(d||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:m,length:A}=gs(l,u),C=Lh[l.componentType],y=Oh[l.type],_=u.byteStride||C*y,T=new Float32Array(A);for(let E=0;E<l.count;E++){const S=new m(h,g+E*_,2);bt.set(S[0],S[1],1),bt.transformByMatrix3(r),T.set([bt[0],bt[1]],E*y)}s===i?jh(l,u,t.buffers,T):Kh(i,l,e,t,T)}}}}function jh(t,e,n,s){t.componentType=5126,n.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=s.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Kh(t,e,n,s,i){s.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const r=s.json.bufferViews;if(!r)return;r.push({buffer:s.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(r==null?void 0:r.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=o.length-1)}function Xh(t){const{offset:e=[0,0],rotation:n=0,scale:s=[1,1]}=t,i=new G().set(1,0,0,0,1,0,e[0],e[1],1),r=Uh.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=Nh.set(s[0],0,0,0,s[1],0,0,0,1);return i.multiplyRight(r).multiplyRight(o)}const kh=Object.freeze(Object.defineProperty({__proto__:null,decode:Hh,name:Gh},Symbol.toStringTag,{value:"Module"})),Ee="KHR_lights_punctual",Wh=Ee;async function Qh(t){const e=new K(t),{json:n}=e,s=e.getExtension(Ee);s&&(e.json.lights=s.lights,e.removeExtension(Ee));for(const i of n.nodes||[]){const r=e.getObjectExtension(i,Ee);r&&(i.light=r.light),e.removeObjectExtension(i,Ee)}}async function qh(t){const e=new K(t),{json:n}=e;if(n.lights){const s=e.addExtension(Ee);Q(!s.lights),s.lights=n.lights,delete n.lights}if(e.json.lights){for(const s of e.json.lights){const i=s.node;e.addObjectExtension(i,Ee,s)}delete e.json.lights}}const Yh=Object.freeze(Object.defineProperty({__proto__:null,decode:Qh,encode:qh,name:Wh},Symbol.toStringTag,{value:"Module"})),lt="KHR_materials_unlit",$h=lt;async function Zh(t){const e=new K(t),{json:n}=e;for(const s of n.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),e.removeObjectExtension(s,lt);e.removeExtension(lt)}function ed(t){const e=new K(t),{json:n}=e;if(e.materials)for(const s of n.materials||[])s.unlit&&(delete s.unlit,e.addObjectExtension(s,lt,{}),e.addExtension(lt))}const td=Object.freeze(Object.defineProperty({__proto__:null,decode:Zh,encode:ed,name:$h},Symbol.toStringTag,{value:"Module"})),st="KHR_techniques_webgl",nd=st;async function sd(t){const e=new K(t),{json:n}=e,s=e.getExtension(st);if(s){const i=rd(s,e);for(const r of n.materials||[]){const o=e.getObjectExtension(r,st);o&&(r.technique=Object.assign({},o,i[o.technique]),r.technique.values=od(r.technique,e)),e.removeObjectExtension(r,st)}e.removeExtension(st)}}async function id(t,e){}function rd(t,e){const{programs:n=[],shaders:s=[],techniques:i=[]}=t,r=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=r.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),i.forEach(o=>{o.program=n[o.program]}),i}function od(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(s=>{t.uniforms[s].value&&!(s in n)&&(n[s]=t.uniforms[s].value)}),Object.keys(n).forEach(s=>{typeof n[s]=="object"&&n[s].index!==void 0&&(n[s].texture=e.getTexture(n[s].index))}),n}const ad=Object.freeze(Object.defineProperty({__proto__:null,decode:sd,encode:id,name:nd},Symbol.toStringTag,{value:"Module"})),to="EXT_feature_metadata",cd=to;async function ld(t){const e=new K(t);ud(e)}function ud(t){var e;const n=t.getExtension(to),s=n==null||(e=n.schema)===null||e===void 0?void 0:e.classes,i=n==null?void 0:n.featureTables;if((n==null?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),s&&i)for(const o in s){const a=s[o],c=fd(i,o);c&&hd(t,c,a)}}function hd(t,e,n){for(const i in n.properties){var s;const r=n.properties[i],o=e==null||(s=e.properties)===null||s===void 0?void 0:s[i],a=e.count;if(o){const c=dd(t,r,a,o);o.data=c}}}function dd(t,e,n,s){const i=s.bufferView;let r=t.getTypedArrayForBufferView(i);switch(e.type){case"STRING":{const o=s.stringOffsetBufferView,a=t.getTypedArrayForBufferView(o);r=gd(r,a,n);break}}return r}function fd(t,e){for(const n in t){const s=t[n];if(s.class===e)return s}return null}function gd(t,e,n){const s=[],i=new TextDecoder("utf8");let r=0;const o=4;for(let a=0;a<n;a++){const c=e[(a+1)*o]-e[a*o],l=t.subarray(r,c+r),u=i.decode(l);s.push(u),r+=c}return s}const md=Object.freeze(Object.defineProperty({__proto__:null,decode:ld,name:cd},Symbol.toStringTag,{value:"Module"})),no=[$u,th,ih,Dh,Yh,td,ad,kh,md];function pd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=no.filter(r=>so(r.name,e));for(const r of s){var i;(i=r.preprocess)===null||i===void 0||i.call(r,t,e,n)}}async function Ad(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=no.filter(r=>so(r.name,e));for(const r of s){var i;await((i=r.decode)===null||i===void 0?void 0:i.call(r,t,e,n))}}function so(t,e){var n;const s=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in s&&!s[t])}const un="KHR_binary_glTF";function Cd(t){const e=new K(t),{json:n}=e;for(const s of n.images||[]){const i=e.getObjectExtension(s,un);i&&Object.assign(s,i),e.removeObjectExtension(s,un)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(un)}const fi={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Bd={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class yd{constructor(){f(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),f(this,"json",void 0)}normalize(e,n){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(s.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),Cd(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in fi)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const s=e[n];if(!(!s||Array.isArray(s))){e[n]=[];for(const i in s){const r=s[i];r.id=r.id||i;const o=e[n].length;e[n].push(r),this.idToIndexMap[n][i]=o}}}_convertObjectIdsToArrayIndices(e){for(const n in fi)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:s,indices:i,material:r}=n;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");i&&(n.indices=this._convertIdToIndex(i,"accessor")),r&&(n.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const s of e[n])for(const i in s){const r=s[i],o=this._convertIdToIndex(r,i);s[i]=o}}_convertIdToIndex(e,n){const s=Bd[n];if(s in this.idToIndexMap){const i=this.idToIndexMap[s][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return i}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const r of e.materials){var n,s,i;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=r.values)===null||n===void 0?void 0:n.tex)||((s=r.values)===null||s===void 0?void 0:s.texture2d_0)||((i=r.values)===null||i===void 0?void 0:i.diffuseTex),a=e.textures.findIndex(c=>c.id===o);a!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:a})}}}function _d(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new yd().normalize(t,e)}const Td={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ed={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},$={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},bd={magFilter:$.TEXTURE_MAG_FILTER,minFilter:$.TEXTURE_MIN_FILTER,wrapS:$.TEXTURE_WRAP_S,wrapT:$.TEXTURE_WRAP_T},Sd={[$.TEXTURE_MAG_FILTER]:$.LINEAR,[$.TEXTURE_MIN_FILTER]:$.NEAREST_MIPMAP_LINEAR,[$.TEXTURE_WRAP_S]:$.REPEAT,[$.TEXTURE_WRAP_T]:$.REPEAT};function vd(t){return Ed[t]}function Md(t){return Td[t]}class Id{constructor(){f(this,"baseUri",""),f(this,"json",{}),f(this,"buffers",[]),f(this,"images",[])}postProcess(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:s,buffers:i=[],images:r=[],baseUri:o=""}=e;return Q(s),this.baseUri=o,this.json=s,this.buffers=i,this.images=r,this._resolveTree(this.json,n),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((n,s)=>this._resolveBufferView(n,s))),e.images&&(e.images=e.images.map((n,s)=>this._resolveImage(n,s))),e.samplers&&(e.samplers=e.samplers.map((n,s)=>this._resolveSampler(n,s))),e.textures&&(e.textures=e.textures.map((n,s)=>this._resolveTexture(n,s))),e.accessors&&(e.accessors=e.accessors.map((n,s)=>this._resolveAccessor(n,s))),e.materials&&(e.materials=e.materials.map((n,s)=>this._resolveMaterial(n,s))),e.meshes&&(e.meshes=e.meshes.map((n,s)=>this._resolveMesh(n,s))),e.nodes&&(e.nodes=e.nodes.map((n,s)=>this._resolveNode(n,s))),e.skins&&(e.skins=e.skins.map((n,s)=>this._resolveSkin(n,s))),e.scenes&&(e.scenes=e.scenes.map((n,s)=>this._resolveScene(n,s))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const s=this.json[e]&&this.json[e][n];return s||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),s}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(s=>this.getNode(s)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(s=>this.getNode(s))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((s,i)=>{const r=this.getMesh(i);return s.id=r.id,s.primitives=s.primitives.concat(r.primitives),s},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(s=>{s={...s};const i=s.attributes;s.attributes={};for(const r in i)s.attributes[r]=this.getAccessor(i[r]);return s.indices!==void 0&&(s.indices=this.getAccessor(s.indices)),s.material!==void 0&&(s.material=this.getMaterial(s.material)),s})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const s=e.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=vd(e.componentType),e.components=Md(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const s=e.bufferView.buffer,{ArrayType:i,byteLength:r}=gs(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+s.byteOffset;let a=s.arrayBuffer.slice(o,o+r);e.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(s,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(a)}return e}_getValueFromInterleavedBuffer(e,n,s,i,r){const o=new Uint8Array(r*i);for(let a=0;a<r;a++){const c=n+a*s;o.set(new Uint8Array(e.arrayBuffer.slice(c,c+i)),a*i)}return o.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):Sd,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const s in e){const i=this._enumSamplerParameter(s);i!==void 0&&(e.parameters[i]=e[s])}return e}_enumSamplerParameter(e){return bd[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const s=this.images[n];return s&&(e.image=s),e}_resolveBufferView(e,n){const s=e.buffer,i={id:"bufferView-".concat(n),...e,buffer:this.buffers[s]},r=this.buffers[s].arrayBuffer;let o=this.buffers[s].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),i.data=new Uint8Array(r,o,e.byteLength),i}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function Rd(t,e){return new Id().postProcess(t,e)}const gi=1735152710,Cs=12,Vt=8,xd=1313821514,Pd=5130562,Fd=0,wd=1,Dd=0,je=!0;function Od(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function Ld(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=new DataView(t),{magic:i=gi}=n,r=s.getUint32(e,!1);return r===i||r===gi}function Gd(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(e),i=Od(s,n+0),r=s.getUint32(n+4,je),o=s.getUint32(n+8,je);switch(Object.assign(t,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:i,version:r,json:{},binChunks:[]}),n+=Cs,t.version){case 1:return Ud(t,s,n);case 2:return Nd(t,s,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function Ud(t,e,n){D(t.header.byteLength>Cs+Vt);const s=e.getUint32(n+0,je),i=e.getUint32(n+4,je);return n+=Vt,D(i===Dd),xn(t,e,n,s),n+=s,n+=Pn(t,e,n,t.header.byteLength),n}function Nd(t,e,n,s){return D(t.header.byteLength>Cs+Vt),Hd(t,e,n,s),n+t.header.byteLength}function Hd(t,e,n,s){for(;n+8<=t.header.byteLength;){const i=e.getUint32(n+0,je),r=e.getUint32(n+4,je);switch(n+=Vt,r){case xd:xn(t,e,n,i);break;case Pd:Pn(t,e,n,i);break;case Fd:s.strict||xn(t,e,n,i);break;case wd:s.strict||Pn(t,e,n,i);break}n+=gt(i,4)}return n}function xn(t,e,n,s){const i=new Uint8Array(e.buffer,n,s),o=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(o),gt(s,4)}function Pn(t,e,n,s){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:s,arrayBuffer:e.buffer}),gt(s,4)}async function Vd(t,e){var n,s,i,r;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;Jd(t,e,o,a),_d(t,{normalize:a==null||(n=a.gltf)===null||n===void 0?void 0:n.normalize}),pd(t,a,c);const l=[];if(a!=null&&(s=a.gltf)!==null&&s!==void 0&&s.loadBuffers&&t.json.buffers&&await zd(t,a,c),a!=null&&(i=a.gltf)!==null&&i!==void 0&&i.loadImages){const h=jd(t,a,c);l.push(h)}const u=Ad(t,a,c);return l.push(u),await Promise.all(l),a!=null&&(r=a.gltf)!==null&&r!==void 0&&r.postProcess?Rd(t,a):t}function Jd(t,e,n,s){if(s.uri&&(t.baseUri=s.uri),e instanceof ArrayBuffer&&!Ld(e,n,s)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=hc(e);else if(e instanceof ArrayBuffer){const o={};n=Gd(o,e,n,s.glb),Q(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),t._glb=o,t.json=o.json}else Q(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const r=t.json.images||[];t.images=new Array(r.length).fill({})}async function zd(t,e,n){const s=t.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){var i,r;const{fetch:c}=n;Q(c);const l=kr(a.uri,e),u=await(n==null||(i=n.fetch)===null||i===void 0?void 0:i.call(n,l)),h=await(u==null||(r=u.arrayBuffer)===null||r===void 0?void 0:r.call(u));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else t.buffers[o]===null&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function jd(t,e,n){const s=Kd(t),i=t.json.images||[],r=[];for(const o of s)r.push(Xd(t,i[o],o,e,n));return await Promise.all(r)}function Kd(t){const e=new Set,n=t.json.textures||[];for(const s of n)s.source!==void 0&&e.add(s.source);return Array.from(e).sort()}async function Xd(t,e,n,s,i){const{fetch:r,parse:o}=i;let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=kr(e.uri,s);a=await(await r(l)).arrayBuffer(),e.bufferView={data:a}}if(Number.isFinite(e.bufferView)){const l=Pu(t.json,t.buffers,e.bufferView);a=ns(l.buffer,l.byteOffset,l.byteLength)}Q(a,"glTF image has no data");let c=await o(a,[Aa,xu],{mimeType:e.mimeType,basis:s.basis||{format:Xr()}},i);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[n]=c}const Ke={name:"glTF",id:"gltf",module:"gltf",version:fu,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:kd,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function kd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...Ke.options,...e},e.gltf={...Ke.options.gltf,...e.gltf};const{byteOffset:s=0}=e;return await Vd({},t,s,e,n)}async function Wd(t){const e=[];return t.scenes.forEach(n=>{n.traverse(s=>{Object.values(s.model.getUniforms()).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await Qd(()=>e.some(n=>!n.loaded))}async function Qd(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const qd=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Yd=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,io=[255,255,255,255],$d={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:io},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ke]};class Xt extends ke{constructor(...e){super(...e),f(this,"state",void 0)}getShaders(){const e=[ht,dt];return this.props._lighting==="pbr"&&e.push(rs),super.getShaders({vs:qd,fs:Yd,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:io,transition:!0},instanceModelMatrix:Or})}updateState(e){super.updateState(e);const{props:n,oldProps:s}=e;n.scenegraph!==s.scenegraph?this._updateScenegraph():n._animations!==s._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let s=null;if(e.scenegraph instanceof He)s={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const a=e.scenegraph,c=du(n,a,this._getModelOptions());s={gltf:a,...c},Wd(c).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(le.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),s=e.scenegraph);const i={layer:this,gl:n},r=e.getScene(s,i),o=e.getAnimator(s,i);r instanceof He?(this._deleteScenegraph(),this._applyAllAttributes(r),this._applyAnimationsProp(r,o,e._animations),this.setState({scenegraph:r,animator:o})):r!==null&&le.warn("invalid scenegraph:",r)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(s=>{this._setModelAttributes(s.model,n)})}}_applyAnimationsProp(e,n,s){if(!e||!n||!s)return;const i=n.getAnimations();Object.keys(s).sort().forEach(r=>{const o=s[r];if(r==="*")i.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(r))){const a=Number(r);a>=0&&a<i.length?Object.assign(i[a],o):le.warn("animation ".concat(r," not found"))()}else{const a=i.find(({name:c})=>c===r);a?Object.assign(a,o):le.warn("animation ".concat(r," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof He&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!zt(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:s}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(s.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:r,sizeMinPixels:o,sizeMaxPixels:a,opacity:c,coordinateSystem:l}=this.props,u=this.getNumInstances();this.state.scenegraph.traverse((h,{worldMatrix:d})=>{h.model.setInstanceCount(u),h.updateModuleSettings(e),h.draw({parameters:n,uniforms:{sizeScale:r,opacity:c,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:Lr(i,l),sceneModelMatrix:d,u_Camera:h.model.getUniforms().project_uCameraPosition}})})}}f(Xt,"defaultProps",$d);f(Xt,"layerName","ScenegraphLayer");const W={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new p;new p;const $e=new p,mi=new p;class pt{constructor(e=[0,0,0],n=0){f(this,"center",void 0),f(this,"radius",void 0),this.radius=-0,this.center=new p,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=$e.from(n),this.center=new p().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new pt(this.center,this.radius)}union(e){const n=this.center,s=this.radius,i=e.center,r=e.radius,o=$e.copy(i).subtract(n),a=o.magnitude();if(s>=a+r)return this.clone();if(r>=a+s)return e.clone();const c=(s+a+r)*.5;return mi.copy(o).scale((-s+c)/a).add(n),this.center.copy(mi),this.radius=c,this}expand(e){const s=$e.from(e).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(e){this.center.transform(e);const n=Ca($e,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const s=$e.from(e).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(e){const n=this.center,s=this.radius,r=e.normal.dot(n)+e.distance;return r<-s?W.OUTSIDE:r<s?W.INTERSECTING:W.INSIDE}}const Zd=new p,ef=new p,St=new p,vt=new p,Mt=new p,tf=new p,nf=new p,fe={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class At{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){f(this,"center",void 0),f(this,"halfAxes",void 0),this.center=new p().from(e),this.halfAxes=new G(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new p(e).len(),new p(n).len(),new p(s).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),i=new p(e).normalize(),r=new p(n).normalize(),o=new p(s).normalize();return new at().fromMatrix3(new G([...i,...r,...o]))}fromCenterHalfSizeQuaternion(e,n,s){const i=new at(s),r=new G().fromQuaternion(i);return r[0]=r[0]*n[0],r[1]=r[1]*n[0],r[2]=r[2]*n[0],r[3]=r[3]*n[1],r[4]=r[4]*n[1],r[5]=r[5]*n[1],r[6]=r[6]*n[2],r[7]=r[7]*n[2],r[8]=r[8]*n[2],this.center=new p().from(e),this.halfAxes=r,this}clone(){return new At(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new pt){const n=this.halfAxes,s=n.getColumn(0,St),i=n.getColumn(1,vt),r=n.getColumn(2,Mt),o=Zd.copy(s).add(i).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,s=e.normal,i=this.halfAxes,r=s.x,o=s.y,a=s.z,c=Math.abs(r*i[fe.COLUMN0ROW0]+o*i[fe.COLUMN0ROW1]+a*i[fe.COLUMN0ROW2])+Math.abs(r*i[fe.COLUMN1ROW0]+o*i[fe.COLUMN1ROW1]+a*i[fe.COLUMN1ROW2])+Math.abs(r*i[fe.COLUMN2ROW0]+o*i[fe.COLUMN2ROW1]+a*i[fe.COLUMN2ROW2]),l=s.dot(n)+e.distance;return l<=-c?W.OUTSIDE:l>=c?W.INSIDE:W.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=ef.from(e).subtract(this.center),s=this.halfAxes,i=s.getColumn(0,St),r=s.getColumn(1,vt),o=s.getColumn(2,Mt),a=i.magnitude(),c=r.magnitude(),l=o.magnitude();i.normalize(),r.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(i))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(r))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(e,n,s=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,St),l=a.getColumn(1,vt),u=a.getColumn(2,Mt),h=tf.copy(c).add(l).add(u).add(o),d=nf.copy(h).subtract(e);let g=n.dot(d);return i=Math.min(g,i),r=Math.max(g,r),h.copy(o).add(c).add(l).subtract(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),h.copy(o).add(c).subtract(l).add(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),h.copy(o).add(c).subtract(l).subtract(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),o.copy(h).subtract(c).add(l).add(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),o.copy(h).subtract(c).add(l).subtract(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),o.copy(h).subtract(c).subtract(l).add(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),o.copy(h).subtract(c).subtract(l).subtract(u),d.copy(h).subtract(e),g=n.dot(d),i=Math.min(g,i),r=Math.max(g,r),s[0]=i,s[1]=r,s}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,St);n.transformAsPoint(e);const s=this.halfAxes.getColumn(1,vt);s.transformAsPoint(e);const i=this.halfAxes.getColumn(2,Mt);return i.transformAsPoint(e),this.halfAxes=new G([...n,...s,...i]),this}getTransform(){throw new Error("not implemented")}}const pi=new p,Ai=new p;class ie{constructor(e=[0,0,1],n=0){f(this,"normal",void 0),f(this,"distance",void 0),this.normal=new p,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return ge(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=pi.from(e),this.normal.from(n).normalize();const s=-this.normal.dot(e);return this.distance=s,this}fromCoefficients(e,n,s,i){return this.normal.set(e,n,s),ge(Ne(this.normal.len(),1)),this.distance=i,this}clone(){return new ie(this.normal,this.distance)}equals(e){return Ne(this.distance,e.distance)&&Ne(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=Ai.copy(this.normal).transformAsVector(e).normalize(),s=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(s,n)}projectPointOntoPlane(e,n=[0,0,0]){e=pi.from(e);const s=this.getPointDistance(e),i=Ai.copy(this.normal).scale(s);return e.subtract(i).to(n)}}const Ci=[new p([1,0,0]),new p([0,1,0]),new p([0,0,1])],Bi=new p,sf=new p;new ie(new p(1,0,0),0);class Z{constructor(e=[]){f(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*Ci.length;const n=e.center,s=e.radius;let i=0;for(const r of Ci){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new ie),a||(a=this.planes[i+1]=new ie);const c=Bi.copy(r).scale(-s).add(n);-r.dot(c),o.fromPointNormal(c,r);const l=Bi.copy(r).scale(s).add(n),u=sf.copy(r).negate();-u.dot(l),a.fromPointNormal(l,u),i+=2}return this}computeVisibility(e){let n=W.INSIDE;for(const s of this.planes)switch(e.intersectPlane(s)){case W.OUTSIDE:return W.OUTSIDE;case W.INTERSECTING:n=W.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(ge(Number.isFinite(n),"parentPlaneMask is required."),n===Z.MASK_OUTSIDE||n===Z.MASK_INSIDE)return n;let s=Z.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(n&o))continue;const a=i[r],c=e.intersectPlane(a);if(c===W.OUTSIDE)return Z.MASK_OUTSIDE;c===W.INTERSECTING&&(s|=o)}return s}}f(Z,"MASK_OUTSIDE",4294967295);f(Z,"MASK_INSIDE",0);f(Z,"MASK_INDETERMINATE",2147483647);new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;const ae=new G,rf=new G,of=new G,It=new G,yi=new G;function af(t,e={}){const n=ct.EPSILON20,s=10;let i=0,r=0;const o=rf,a=of;o.identity(),a.copy(t);const c=n*cf(a);for(;r<s&&lf(a)>c;)uf(a,It),yi.copy(It).transpose(),a.multiplyRight(It),a.multiplyLeft(yi),o.multiplyRight(It),++i>2&&(++r,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function cf(t){let e=0;for(let n=0;n<9;++n){const s=t[n];e+=s*s}return Math.sqrt(e)}const Fn=[1,0,0],wn=[2,2,1];function lf(t){let e=0;for(let n=0;n<3;++n){const s=t[ae.getElementIndex(wn[n],Fn[n])];e+=2*s*s}return Math.sqrt(e)}function uf(t,e){const n=ct.EPSILON15;let s=0,i=1;for(let l=0;l<3;++l){const u=Math.abs(t[ae.getElementIndex(wn[l],Fn[l])]);u>s&&(i=l,s=u)}const r=Fn[i],o=wn[i];let a=1,c=0;if(Math.abs(t[ae.getElementIndex(o,r)])>n){const l=t[ae.getElementIndex(o,o)],u=t[ae.getElementIndex(r,r)],h=t[ae.getElementIndex(o,r)],d=(l-u)/2/h;let g;d<0?g=-1/(-d+Math.sqrt(1+d*d)):g=1/(d+Math.sqrt(1+d*d)),a=1/Math.sqrt(1+g*g),c=g*a}return G.IDENTITY.to(e),e[ae.getElementIndex(r,r)]=e[ae.getElementIndex(o,o)]=a,e[ae.getElementIndex(o,r)]=c,e[ae.getElementIndex(r,o)]=-c,e}const Ae=new p,hf=new p,df=new p,ff=new p,gf=new p,mf=new G,pf={diagonal:new G,unitary:new G};function Af(t,e=new At){if(!t||t.length===0)return e.halfAxes=new G([0,0,0,0,0,0,0,0,0]),e.center=new p,e;const n=t.length,s=new p(0,0,0);for(const I of t)s.add(I);const i=1/n;s.multiplyByScalar(i);let r=0,o=0,a=0,c=0,l=0,u=0;for(const I of t){const b=Ae.copy(I).subtract(s);r+=b.x*b.x,o+=b.x*b.y,a+=b.x*b.z,c+=b.y*b.y,l+=b.y*b.z,u+=b.z*b.z}r*=i,o*=i,a*=i,c*=i,l*=i,u*=i;const h=mf;h[0]=r,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:d}=af(h,pf),g=e.halfAxes.copy(d);let m=g.getColumn(0,df),A=g.getColumn(1,ff),C=g.getColumn(2,gf),y=-Number.MAX_VALUE,_=-Number.MAX_VALUE,T=-Number.MAX_VALUE,E=Number.MAX_VALUE,S=Number.MAX_VALUE,F=Number.MAX_VALUE;for(const I of t)Ae.copy(I),y=Math.max(Ae.dot(m),y),_=Math.max(Ae.dot(A),_),T=Math.max(Ae.dot(C),T),E=Math.min(Ae.dot(m),E),S=Math.min(Ae.dot(A),S),F=Math.min(Ae.dot(C),F);m=m.multiplyByScalar(.5*(E+y)),A=A.multiplyByScalar(.5*(S+_)),C=C.multiplyByScalar(.5*(F+T)),e.center.copy(m).add(A).add(C);const w=hf.set(y-E,_-S,T-F).multiplyByScalar(.5),R=new G([w[0],0,0,0,w[1],0,0,0,w[2]]);return e.halfAxes.multiplyRight(R),e}const Cf={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class Bs extends Ar{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:s,currentTime:i}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:s,currentTime:i},super.draw(e)}}f(Bs,"layerName","TripsLayer");f(Bs,"defaultProps",Cf);const Bf=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yf=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function _f(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const Tf={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class ys extends fs{getShaders(){const e=super.getShaders();return e.modules.push(rs),{...e,vs:Bf,fs:yf}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:s}=e;n.pbrMaterial!==s.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:s}=this.props,i=this.parseMaterial(s,e);this.setState({materialParser:i});const r=this.getShaders();return _f(e.attributes),new Se(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...r.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:s}=this.props,i=this.parseMaterial(e,s);this.setState({materialParser:i}),n.setUniforms(i.uniforms)}}parseMaterial(e,n){var s;const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(s=this.state.materialParser)===null||s===void 0||s.delete(),new zr(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:i,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,s=new Uint8ClampedArray(n.length*e.size),i=[];for(let r=0;r<n.length;r++)this.encodePickingColor(n[r],i),s[r*3]=i[0],s[r*3+1]=i[1],s[r*3+2]=i[2];e.value=s}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}f(ys,"layerName","MeshLayer");f(ys,"defaultProps",Tf);const Ef=6378137,bf=6378137,Sf=6356752314245179e-9;function kt(t){return t}new p;function vf(t,e=[],n=kt){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function Mf(t,e=[]){return vf(t,e,ze._cartographicRadians?kt:Ba)}function If(t,e,n=kt){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function Rf(t,e){return If(t,e,ze._cartographicRadians?kt:ya)}const Fe=new p,xf=new p,Pf=new p;function Ff(t,e,n=[]){const{oneOverRadii:s,oneOverRadiiSquared:i,centerToleranceSquared:r}=e;Fe.from(t);const o=Fe.x,a=Fe.y,c=Fe.z,l=s.x,u=s.y,h=s.z,d=o*o*l*l,g=a*a*u*u,m=c*c*h*h,A=d+g+m,C=Math.sqrt(1/A);if(!Number.isFinite(C))return;const y=xf;if(y.copy(t).scale(C),A<r)return y.to(n);const _=i.x,T=i.y,E=i.z,S=Pf;S.set(y.x*_*2,y.y*T*2,y.z*E*2);let F=(1-C)*Fe.len()/(.5*S.len()),w=0,R,I,b,q;do{F-=w,R=1/(1+F*_),I=1/(1+F*T),b=1/(1+F*E);const ne=R*R,Re=I*I,Yt=b*b,Rs=ne*R,$t=Re*I,Zt=Yt*b;q=d*ne+g*Re+m*Yt-1;const Qe=-2*(d*Rs*_+g*$t*T+m*Zt*E);w=q/Qe}while(Math.abs(q)>ct.EPSILON12);return Fe.scale([R,I,b]).to(n)}const _i=1e-14,wf=new p,Ti={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},hn={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ze={east:new p,north:new p,up:new p,west:new p,south:new p,down:new p},Df=new p,Of=new p,Lf=new p;function Ei(t,e,n,s,i,r){const o=Ti[e]&&Ti[e][n];ge(o&&(!s||s===o));let a,c,l;const u=wf.copy(i);if(Ne(u.x,0,_i)&&Ne(u.y,0,_i)){const d=Math.sign(u.z);a=Df.fromArray(hn[e]),e!=="east"&&e!=="west"&&a.scale(d),c=Of.fromArray(hn[n]),n!=="east"&&n!=="west"&&c.scale(d),l=Lf.fromArray(hn[s]),s!=="east"&&s!=="west"&&l.scale(d)}else{const{up:d,east:g,north:m}=Ze;g.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,d),m.copy(d).cross(g);const{down:A,west:C,south:y}=Ze;A.copy(d).scale(-1),C.copy(g).scale(-1),y.copy(m).scale(-1),a=Ze[e],c=Ze[n],l=Ze[s]}return r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0,r[4]=c.x,r[5]=c.y,r[6]=c.z,r[7]=0,r[8]=l.x,r[9]=l.y,r[10]=l.z,r[11]=0,r[12]=u.x,r[13]=u.y,r[14]=u.z,r[15]=1,r}const Rt=new p,bi=new p,Gf=new p,se=new p,Uf=new p,xt=new p;class O{constructor(e=0,n=0,s=0){f(this,"radii",void 0),f(this,"radiiSquared",void 0),f(this,"radiiToTheFourth",void 0),f(this,"oneOverRadii",void 0),f(this,"oneOverRadiiSquared",void 0),f(this,"minimumRadius",void 0),f(this,"maximumRadius",void 0),f(this,"centerToleranceSquared",ct.EPSILON1),f(this,"squaredXOverSquaredZ",void 0),ge(e>=0),ge(n>=0),ge(s>=0),this.radii=new p(e,n,s),this.radiiSquared=new p(e*e,n*n,s*s),this.radiiToTheFourth=new p(e*e*e*e,n*n*n*n,s*s*s*s),this.oneOverRadii=new p(e===0?0:1/e,n===0?0:1/n,s===0?0:1/s),this.oneOverRadiiSquared=new p(e===0?0:1/(e*e),n===0?0:1/(n*n),s===0?0:1/(s*s)),this.minimumRadius=Math.min(e,n,s),this.maximumRadius=Math.max(e,n,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const s=bi,i=Gf,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,s),i.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(i));return i.scale(1/o),s.scale(r),i.add(s),i.to(n)}cartesianToCartographic(e,n=[0,0,0]){xt.from(e);const s=this.scaleToGeodeticSurface(xt,se);if(!s)return;const i=this.geodeticSurfaceNormal(s,bi),r=Uf;r.copy(xt).subtract(s);const o=Math.atan2(i.y,i.x),a=Math.asin(i.z),c=Math.sign(dr(r,xt))*_a(r);return Rf([o,a,c],n)}eastNorthUpToFixedFrame(e,n=new P){return Ei(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,s,i,r=new P){return Ei(this,e,n,s,i,r)}geocentricSurfaceNormal(e,n=[0,0,0]){return Rt.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const s=Mf(e),i=s[0],r=s[1],o=Math.cos(r);return Rt.set(o*Math.cos(i),o*Math.sin(i),Math.sin(r)).normalize(),Rt.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return Rt.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return Ff(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){se.from(e);const s=se.x,i=se.y,r=se.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+i*i*o.y+r*r*o.z);return se.multiplyScalar(a).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return se.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return se.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,s=[0,0,0]){ge(Ne(this.radii.x,this.radii.y,ct.EPSILON15)),ge(this.radii.z>0),se.from(e);const i=se.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-n))return se.set(0,0,i).to(s)}}f(O,"WGS84",new O(Ef,bf,Sf));class Nf{constructor(e,n,s){f(this,"item",void 0),f(this,"previous",void 0),f(this,"next",void 0),this.item=e,this.previous=n,this.next=s}}class Hf{constructor(){f(this,"head",null),f(this,"tail",null),f(this,"_length",0)}get length(){return this._length}add(e){const n=new Nf(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const s=e.next;e.next=n,this.tail===e?this.tail=n:s.previous=n,n.next=s,n.previous=e,++this._length}}class Vf{constructor(){f(this,"_list",void 0),f(this,"_sentinel",void 0),f(this,"_trimTiles",void 0),this._list=new Hf,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,s){n._cacheNode||(n._cacheNode=this._list.add(n),s&&s(e,n))}unloadTile(e,n,s){const i=n._cacheNode;i&&(this._list.remove(i),n._cacheNode=null,s&&s(e,n))}unloadTiles(e,n){const s=this._trimTiles;this._trimTiles=!1;const i=this._list,r=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=i.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>r||s);){const c=a.item;a=a.next,this.unloadTile(e,c,n)}}trim(){this._trimTiles=!0}}function Jf(t,e){D(t),D(e);const{rtcCenter:n,gltfUpAxis:s}=e,{computedTransform:i,boundingVolume:{center:r}}=t;let o=new P(i);switch(n&&o.translate(n),s){case"Z":break;case"Y":const h=new P().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const d=new P().rotateY(-Math.PI/2);o=o.multiplyRight(d);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new p(r);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const c=O.WGS84.cartesianToCartographic(a,new p),u=O.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=u.multiplyRight(o),e.cartographicOrigin=c,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const Si=new p,dn=new p,Dn=new Z([new ie,new ie,new ie,new ie,new ie,new ie]);function zf(t,e){const{cameraDirection:n,cameraUp:s,height:i}=t,{metersPerUnit:r}=t.distanceScales,o=Lt(t,t.center),a=O.WGS84.eastNorthUpToFixedFrame(o),c=t.unprojectPosition(t.cameraPosition),l=O.WGS84.cartographicToCartesian(c,new p),u=new p(a.transformAsVector(new p(n).scale(r))).normalize(),h=new p(a.transformAsVector(new p(s).scale(r))).normalize();Kf(t);const d=t.constructor,{longitude:g,latitude:m,width:A,bearing:C,zoom:y}=t,_=new d({longitude:g,latitude:m,height:i,width:A,bearing:C,zoom:y,pitch:0});return{camera:{position:l,direction:u,up:h},viewport:t,topDownViewport:_,height:i,cullingVolume:Dn,frameNumber:e,sseDenominator:1.15}}function jf(t,e,n){if(n===0||t.length<=n)return[t,[]];const s=[],{longitude:i,latitude:r}=e.viewport;for(const[l,u]of t.entries()){const[h,d]=u.header.mbs,g=Math.abs(i-h),m=Math.abs(r-d),A=Math.sqrt(m*m+g*g);s.push([l,A])}const o=s.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<n;l++)a.push(t[o[l][0]]);const c=[];for(let l=n;l<o.length;l++)c.push(t[o[l][0]]);return[a,c]}function Kf(t){const e=t.getFrustumPlanes(),n=vi(e.near,t.cameraPosition),s=Lt(t,n),i=Lt(t,t.cameraPosition,dn);let r=0;Dn.planes[r++].fromPointNormal(s,Si.copy(s).subtract(i));for(const o in e){if(o==="near")continue;const a=e[o],c=vi(a,n,dn),l=Lt(t,c,dn);Dn.planes[r++].fromPointNormal(l,Si.copy(s).subtract(l))}}function vi(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-s).add(e),n}function Lt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=t.unprojectPosition(e);return O.WGS84.cartographicToCartesian(s,n)}const Xf=6378137,kf=6378137,On=6356752314245179e-9,Mi=new p;function Wf(t,e){if(t instanceof At){const{halfAxes:n}=t,s=qf(n);return Math.log2(On/(s+e[2]))}else if(t instanceof pt){const{radius:n}=t;return Math.log2(On/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:s}=t,i=Math.log2(Xf/n),r=Math.log2(kf/s);return(i+r)/2}return 1}function ro(t,e,n){const s=O.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new p),i=Math.sqrt(Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2)+Math.pow(s[2]-n[2],2));return Math.log2(On/(i+e[2]))}function Qf(t,e,n){const[s,i,r,o]=t;return ro({xmin:s,xmax:r,ymin:i,ymax:o,zmin:0,zmax:0},e,n)}function qf(t){t.getColumn(0,Mi);const e=t.getColumn(1),n=t.getColumn(2);return Mi.add(e).add(n).len()}const k={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},pe={ADD:1,REPLACE:2},Ve={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Y={I3S:"I3S",TILES3D:"TILES3D"},Wt={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Yf={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function oo(t){return t!=null}const V=new p,Gt=new p,$f=new p,Zf=new p;function fn(t,e,n){if(D(t,"3D Tile: boundingVolume must be defined"),t.box)return tg(t.box,e,n);if(t.region){const[s,i,r,o,a,c]=t.region,l=O.WGS84.cartographicToCartesian([Be(s),Be(o),a],$f),u=O.WGS84.cartographicToCartesian([Be(r),Be(i),c],Zf),h=new p().addVectors(l,u).multiplyScalar(.5),d=new p().subVectors(l,u).len()/2;return Ii([h[0],h[1],h[2],d],new P)}if(t.sphere)return Ii(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function eg(t,e){if(t.box)return ng(e);if(t.region){const[n,s,i,r,o,a]=t.region;return[[Be(n),Be(s),o],[Be(i),Be(r),a]]}if(t.sphere)return sg(e);throw new Error("Unkown boundingVolume type")}function tg(t,e,n){const s=new p(t[0],t[1],t[2]);e.transform(s,s);let i=[];if(t.length===10){const l=t.slice(3,6),u=new at;u.fromArray(t,6);const h=new p([1,0,0]),d=new p([0,1,0]),g=new p([0,0,1]);h.transformByQuaternion(u),h.scale(l[0]),d.transformByQuaternion(u),d.scale(l[1]),g.transformByQuaternion(u),g.scale(l[2]),i=[...h.toArray(),...d.toArray(),...g.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const r=e.transformAsVector(i.slice(0,3)),o=e.transformAsVector(i.slice(3,6)),a=e.transformAsVector(i.slice(6,9)),c=new G([r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return oo(n)?(n.center=s,n.halfAxes=c,n):new At(s,c)}function Ii(t,e,n){const s=new p(t[0],t[1],t[2]);e.transform(s,s);const i=e.getScale(Gt),r=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*r;return oo(n)?(n.center=s,n.radius=o,n):new pt(s,o)}function ng(t){const e=ao(),{halfAxes:n}=t,s=new p(n.getColumn(0)),i=new p(n.getColumn(1)),r=new p(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)V.copy(t.center),V.add(s),V.add(i),V.add(r),co(e,V),r.negate();i.negate()}s.negate()}return e}function sg(t){const e=ao(),{center:n,radius:s}=t,i=O.WGS84.scaleToGeodeticSurface(n,V);let r;i?r=O.WGS84.geodeticSurfaceNormal(i):r=new p(0,0,1);let o=new p(r[2],-r[1],0);o.len()>0?o.normalize():o=new p(0,1,0);const a=o.clone().cross(r);for(const c of[o,a,r]){Gt.copy(c).scale(s);for(let l=0;l<2;l++)V.copy(n),V.add(Gt),co(e,V),Gt.negate()}return e}function ao(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function co(t,e){O.WGS84.cartesianToCartographic(e,V),t[0][0]=Math.min(t[0][0],V[0]),t[0][1]=Math.min(t[0][1],V[1]),t[0][2]=Math.min(t[0][2],V[2]),t[1][0]=Math.max(t[1][0],V[0]),t[1][1]=Math.max(t[1][1],V[1]),t[1][2]=Math.max(t[1][2],V[2])}new p;new p;new P;new p;new p;new p;function ig(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function rg(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,s=t.dynamicScreenSpaceErrorFactor;return ig(e,n)*s}return 0}function og(t,e,n){const s=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,r=n?i:t.lodMetricValue;if(r===0)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:l}=s.options;let u=r*a*(l||1)/(o*c);return u-=rg(s,o),u}const gn=new p,Ri=new p,Ce=new p,xi=new p,ag=new p,mn=new P,Pi=new P;function cg(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*lo(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function lo(t,e){const{topDownViewport:n}=e,s=t.header.mbs[1],i=t.header.mbs[0],r=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);O.WGS84.cartographicToCartesian(c,gn),Ri.copy(gn).subtract(a).normalize(),O.WGS84.eastNorthUpToFixedFrame(a,mn),Pi.copy(mn).invert(),Ce.copy(gn).transform(Pi);const l=Math.sqrt(Ce[0]*Ce[0]+Ce[1]*Ce[1]),u=l*l/Ce[2];xi.copy([Ce[0],Ce[1],u]);const d=xi.transform(mn).subtract(a).normalize(),m=Ri.cross(d).normalize().scale(o).add(a),A=O.WGS84.cartesianToCartographic(m),C=n.project([i,s,r]),y=n.project(A);return ag.copy(C).subtract(y).magnitude()}function lg(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class Fi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;f(this,"_map",new Map),f(this,"_array",void 0),f(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return D(e<this._array.length),this._array[e]}set(e,n){D(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){D(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){D(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const ug={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Qt{traversalFinished(e){return!0}constructor(e){f(this,"options",void 0),f(this,"root",null),f(this,"selectedTiles",{}),f(this,"requestedTiles",{}),f(this,"emptyTiles",{}),f(this,"lastUpdate",new Date().getTime()),f(this,"updateDebounceTime",1e3),f(this,"_traversalStack",new Fi),f(this,"_emptyTraversalStack",new Fi),f(this,"_frameNumber",null),this.options={...ug,...e}}traverse(e,n,s){this.root=e,this.options={...this.options,...s},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const s=this._traversalStack;for(e._selectionDepth=1,s.push(e);s.length>0;){const r=s.pop();let o=!1;this.canTraverse(r,n)&&(this.updateChildTiles(r,n),o=this.updateAndPushChildren(r,n,s,r.hasRenderContent?r._selectionDepth+1:r._selectionDepth));const a=r.parent,c=!!(!a||a._shouldRefine),l=!o;r.hasRenderContent?r.refine===pe.ADD?(this.loadTile(r,n),this.selectTile(r,n)):r.refine===pe.REPLACE&&(this.loadTile(r,n),l&&this.selectTile(r,n)):(this.emptyTiles[r.id]=r,this.loadTile(r,n),l&&this.selectTile(r,n)),this.touchTile(r,n),r._shouldRefine=o&&c}const i=new Date().getTime();(this.traversalFinished(n)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const s=e.children;for(const i of s)this.updateTile(i,n)}updateAndPushChildren(e,n,s,i){const{loadSiblings:r,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const c=e.refine===pe.REPLACE&&e.hasRenderContent&&!o;let l=!1,u=!0;for(const h of a)if(h._selectionDepth=i,h.isVisibleAndInRequestVolume?(s.find(h)&&s.delete(h),s.push(h),l=!0):(c||r)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let d;if(h._inRequestVolume?h.hasRenderContent?d=h.contentAvailable:d=this.executeEmptyTraversal(h,n):d=!1,u=u&&d,!u)return!1}return l||(u=!1),u}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,s):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return s&&(i=e.getScreenSpaceError(n,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const s=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===n.viewport.id&&s.push(i);else s.push(n.viewport.id);e.updateVisibility(n,s)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let s=!1;for(const i of e.children)i.updateVisibility(n),s=s||i.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(e,n){let s=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0&&s;){const r=i.pop();if(this.updateTile(r,n),r.isVisibleAndInRequestVolume||this.loadTile(r,n),this.touchTile(r,n),!r.hasRenderContent&&this.canTraverse(r,n,!1,!0)){const a=r.children;for(const c of a)i.find(c)&&i.delete(c),i.push(c)}else!r.contentAvailable&&!r.hasEmptyContent&&(s=!1)}return s}}const wi=new p;function hg(t){return t!=null}class Ln{constructor(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";f(this,"tileset",void 0),f(this,"header",void 0),f(this,"id",void 0),f(this,"url",void 0),f(this,"parent",void 0),f(this,"refine",void 0),f(this,"type",void 0),f(this,"contentUrl",void 0),f(this,"lodMetricType","geometricError"),f(this,"lodMetricValue",0),f(this,"boundingVolume",null),f(this,"content",null),f(this,"contentState",k.UNLOADED),f(this,"gpuMemoryUsageInBytes",0),f(this,"children",[]),f(this,"depth",0),f(this,"viewportIds",[]),f(this,"transform",new P),f(this,"extensions",null),f(this,"implicitTiling",null),f(this,"userData",{}),f(this,"computedTransform",void 0),f(this,"hasEmptyContent",!1),f(this,"hasTilesetContent",!1),f(this,"traverser",new Qt({})),f(this,"_cacheNode",null),f(this,"_frameNumber",null),f(this,"_expireDate",null),f(this,"_expiredContent",null),f(this,"_boundingBox",void 0),f(this,"_distanceToCamera",0),f(this,"_screenSpaceError",0),f(this,"_visibilityPlaneMask",void 0),f(this,"_visible",void 0),f(this,"_contentBoundingVolume",void 0),f(this,"_viewerRequestVolume",void 0),f(this,"_initialTransform",new P),f(this,"_priority",0),f(this,"_selectedFrame",0),f(this,"_requestedFrame",0),f(this,"_selectionDepth",0),f(this,"_touchedFrame",0),f(this,"_centerZDepth",0),f(this,"_shouldRefine",!1),f(this,"_stackLength",0),f(this,"_visitedFrame",0),f(this,"_inRequestVolume",!1),f(this,"_lodJudge",null),this.header=n,this.tileset=e,this.id=i||n.id,this.url=n.url,this.parent=s,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===k.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===k.UNLOADED}get contentExpired(){return this.contentState===k.EXPIRED}get contentFailed(){return this.contentState===k.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=eg(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case Y.I3S:return lo(this,e);case Y.TILES3D:return og(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,s=this.refine===pe.ADD||n;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===k.UNLOADED)return-1;const i=this.parent,o=i&&(!s||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=k.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=k.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,r={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await ft(s,i,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=k.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=k.FAILED,s}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=k.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const s=this.parent,i=s?s._visibilityPlaneMask:Z.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const r=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(r)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Z.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:s}=e,{boundingVolume:i}=this;return s.computeVisibilityWithPlaneMask(i,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:n}=e;const s=this.boundingVolume;return wi.subVectors(s.center,n.position),n.direction.dot(wi)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(hg(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=k.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new P(e.transform):new P;const n=this.parent,s=this.tileset,i=n&&n.computedTransform?n.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new P(i).multiplyRight(this.transform);const r=n&&n._initialTransform?n._initialTransform.clone():new P;this._initialTransform=new P(r).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=k.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Z.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||pe.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=fn(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=fn(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=fn(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new P).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return lg(this.tileset.tileset)}}}class dg extends Qt{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const s=e.children.length>0;if(e.hasTilesetContent&&s){const o=e.children[0];this.updateTileVisibility(o,n),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const i=e.refine===pe.REPLACE,r=e._optimChildrenWithinParent===Yf.USE_OPTIMIZATION;if(i&&r&&s&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:s}=e;return!s||s.hasTilesetContent||s.refine!==pe.ADD?!1:!this.shouldRefine(e,n,!0)}}class fg{constructor(){f(this,"frameNumberMap",new Map)}register(e,n){const s=this.frameNumberMap.get(e)||new Map,i=s.get(n)||0;s.set(n,i+1),this.frameNumberMap.set(e,s)}deregister(e,n){const s=this.frameNumberMap.get(e);if(!s)return;const i=s.get(n)||1;s.set(n,i-1)}isZero(e,n){var s;return(((s=this.frameNumberMap.get(e))===null||s===void 0?void 0:s.get(n))||0)===0}}const pn={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class gg{constructor(){f(this,"_statusMap",void 0),f(this,"pendingTilesRegister",new fg),this._statusMap={}}add(e,n,s,i){if(!this._statusMap[n]){const{frameNumber:r,viewport:{id:o}}=i;this._statusMap[n]={request:e,callback:s,key:n,frameState:i,status:pn.REQUESTED},this.pendingTilesRegister.register(o,r),e().then(a=>{this._statusMap[n].status=pn.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[n].callback(a,i)}).catch(a=>{this._statusMap[n].status=pn.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),s(a)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:s,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,s);const{frameNumber:r,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,r),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class mg extends Qt{constructor(e){super(e),f(this,"_tileManager",void 0),this._tileManager=new gg}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,n){return e._lodJudge=cg(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const s=e.header.children||[],i=e.children,r=e.tileset;for(const o of s){const a="".concat(o.id,"-").concat(n.viewport.id),c=i&&i.find(l=>l.id===a);if(c)c&&this.updateTile(c,n);else{let l=()=>this._loadTile(o.id,r);this._tileManager.find(a)?this._tileManager.update(a,n):(r.tileset.nodePages&&(l=()=>r.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(l,a,h=>this._onTileLoad(h,e,a),n))}}return!1}async _loadTile(e,n){const{loader:s}=n,i=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),r={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await ft(i,s,r)}_onTileLoad(e,n,s){const i=new Ln(n.tileset,e,n,s);n.children.push(i);const r=this._tileManager.find(i.id).frameState;this.updateTile(i,r),this._frameNumber===r.frameNumber&&(this.traversalFinished(r)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,r)}}const pg={description:"",ellipsoid:O.WGS84,modelMatrix:new P,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Pt="Tiles In Tileset(s)",An="Tiles In Memory",Di="Tiles In View",Oi="Tiles To Render",Li="Tiles Loaded",Cn="Tiles Loading",Gi="Tiles Unloaded",Ui="Failed Tile Loads",Ni="Points/Vertices",Bn="Tile Memory Use";class Ag{constructor(e,n){f(this,"options",void 0),f(this,"loadOptions",void 0),f(this,"type",void 0),f(this,"tileset",void 0),f(this,"loader",void 0),f(this,"url",void 0),f(this,"basePath",void 0),f(this,"modelMatrix",void 0),f(this,"ellipsoid",void 0),f(this,"lodMetricType",void 0),f(this,"lodMetricValue",void 0),f(this,"refine",void 0),f(this,"root",null),f(this,"roots",{}),f(this,"asset",{}),f(this,"description",""),f(this,"properties",void 0),f(this,"extras",null),f(this,"attributions",{}),f(this,"credits",{}),f(this,"stats",void 0),f(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),f(this,"cartographicCenter",null),f(this,"cartesianCenter",null),f(this,"zoom",1),f(this,"boundingVolume",null),f(this,"dynamicScreenSpaceErrorComputedDensity",0),f(this,"maximumMemoryUsage",32),f(this,"gpuMemoryUsageInBytes",0),f(this,"_frameNumber",0),f(this,"_queryParams",{}),f(this,"_extensionsUsed",[]),f(this,"_tiles",{}),f(this,"_pendingCount",0),f(this,"selectedTiles",[]),f(this,"traverseCounter",0),f(this,"geometricError",0),f(this,"lastUpdatedVieports",null),f(this,"_requestedTiles",[]),f(this,"_emptyTiles",[]),f(this,"frameStateData",{}),f(this,"_traverser",void 0),f(this,"_cache",new Vf),f(this,"_requestScheduler",void 0),f(this,"updatePromise",null),f(this,"tilesetInitializationPromise",void 0),this.options={...pg,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Cr(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Bc({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new fr({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const s=[];for(const i of n){const r=i.id;this._needTraverse(r)?s.push(r):this.traverseCounter--}for(const i of n){const r=i.id;if(this.roots[r]||(this.roots[r]=this._initializeTileHeaders(this.tileset,null)),!s.includes(r))continue;const o=zf(i,this._frameNumber);this._traverser.traverse(this.roots[r],o,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[n],i=Object.values(this._traverser.selectedTiles),[r,o]=jf(i,e,this.options.maximumTilesSelected);s.selectedTiles=r;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const s=new Set(e.map(o=>o.id)),i=new Set(n.map(o=>o.id));let r=e.filter(o=>!i.has(o.id)).length>0;return r=r||n.filter(o=>!s.has(o.id)).length>0,r}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(e++,s.content.pointCount?n+=s.content.pointCount:n+=s.content.vertexCount);this.stats.get(Di).count=this.selectedTiles.length,this.stats.get(Oi).count=e,this.stats.get(Ni).count=n}async _initializeTileSet(e){this.type===Y.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Y.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Y.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:i,xmax:r,ymin:o,ymax:a,zmin:c,zmax:l}=n;this.cartographicCenter=new p(i+(r-i)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=O.WGS84.cartographicToCartesian(this.cartographicCenter,new p),this.zoom=ro(n,this.cartographicCenter,this.cartesianCenter);return}const s=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(s){const[i,r,o,a]=s;this.cartographicCenter=new p(i+(o-i)/2,r+(a-r)/2,0),this.cartesianCenter=O.WGS84.cartographicToCartesian(this.cartographicCenter,new p),this.zoom=Qf(s,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new p,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new p,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=O.WGS84.cartesianToCartographic(n,new p):this.cartographicCenter=new p(0,0,-O.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=Wf(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Pt),this.stats.get(Cn),this.stats.get(An),this.stats.get(Di),this.stats.get(Oi),this.stats.get(Li),this.stats.get(Gi),this.stats.get(Ui),this.stats.get(Ni),this.stats.get(Bn,"memory")}_initializeTileHeaders(e,n){const s=new Ln(this,e.root,n);if(n&&(n.children.push(s),s.depth=n.depth+1),this.type===Y.TILES3D){const r=[];for(r.push(s);r.length>0;){const o=r.pop();this.stats.get(Pt).incrementCount();const a=o.header.children||[];for(const c of a){var i;const l=new Ln(this,c,o);if((i=l.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const h=new URL(l.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(l),l.depth=o.depth+1,r.push(l)}}}return s}_initializeTraverser(){let e;switch(this.type){case Y.TILES3D:e=dg;break;case Y.I3S:e=mg;break;default:e=Qt}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(s){this._onTileLoadError(e,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(Ui).incrementCount();const s=n.message||n.toString(),i=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(s)),this.options.onTileError(e,s,i)}_onTileLoad(e,n){if(n){if(this.type===Y.I3S){var s,i;const r=((s=this.tileset)===null||s===void 0||(i=s.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(Pt).reset(),this.stats.get(Pt).addCount(r)}e&&e.content&&Jf(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Y.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Y.TILES3D){var n;const{extensionsRemoved:s=[]}=((n=e.content)===null||n===void 0?void 0:n.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Cn).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Cn).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(Li).incrementCount(),this.stats.get(An).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Bn).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(An).decrementCount(),this.stats.get(Gi).incrementCount(),this.stats.get(Bn).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const s of n.children)e.push(s);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,s=[];for(s.push(n);s.length>0;){e=s.pop();for(const i of e.children)s.push(i);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),s=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const uo="3.4.15",et={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function ho(t,e,n){D(t instanceof ArrayBuffer);const s=new TextDecoder("utf8"),i=new Uint8Array(t,e,n);return s.decode(i)}function Cg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const Bg={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},U={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},v={...Bg,...U},yn={[U.DOUBLE]:Float64Array,[U.FLOAT]:Float32Array,[U.UNSIGNED_SHORT]:Uint16Array,[U.UNSIGNED_INT]:Uint32Array,[U.UNSIGNED_BYTE]:Uint8Array,[U.BYTE]:Int8Array,[U.SHORT]:Int16Array,[U.INT]:Int32Array},yg={DOUBLE:U.DOUBLE,FLOAT:U.FLOAT,UNSIGNED_SHORT:U.UNSIGNED_SHORT,UNSIGNED_INT:U.UNSIGNED_INT,UNSIGNED_BYTE:U.UNSIGNED_BYTE,BYTE:U.BYTE,SHORT:U.SHORT,INT:U.INT},_n="Failed to convert GL type";class ue{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in yn)if(yn[n]===e)return n;throw new Error(_n)}static fromName(e){const n=yg[e];if(!n)throw new Error(_n);return n}static getArrayType(e){switch(e){case U.UNSIGNED_SHORT_5_6_5:case U.UNSIGNED_SHORT_4_4_4_4:case U.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=yn[e];if(!n)throw new Error(_n);return n}}static getByteSize(e){return ue.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!ue.getArrayType(e)}static createTypedArray(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(n.byteLength-s)/ue.getByteSize(e));const r=ue.getArrayType(e);return new r(n,s,i)}}function _g(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function Tg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=t>>11&31,s=t>>5&63,i=t&31;return e[0]=n<<3,e[1]=s<<2,e[2]=i<<3,e}new ss;new p;new ss;new ss;function Hi(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Ta(t,0,e)/e*2-1}function Vi(t){return t<0?-1:1}function Eg(t,e,n,s){if(_g(s),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(s.x=Hi(t,n),s.y=Hi(e,n),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const i=s.x;s.x=(1-Math.abs(s.y))*Vi(i),s.y=(1-Math.abs(i))*Vi(s.y)}return s.normalize()}function bg(t,e,n){return Eg(t,e,255,n)}class _s{constructor(e,n){f(this,"json",void 0),f(this,"buffer",void 0),f(this,"featuresLength",0),f(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.UNSIGNED_INT,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,n,s,1,i.byteOffset):i}getPropertyArray(e,n,s){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(n=ue.fromName(i.componentType)),this._getTypedArrayFromBinary(e,n,s,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,n,i)}getProperty(e,n,s,i,r){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,n,s);if(s===1)return a[i];for(let c=0;c<s;++c)r[c]=a[s*i+c];return r}_getTypedArrayFromBinary(e,n,s,i,r){const o=this._cachedTypedArrays;let a=o[e];return a||(a=ue.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+r,i*s),o[e]=a),a}_getTypedArrayFromArray(e,n,s){const i=this._cachedTypedArrays;let r=i[e];return r||(r=ue.createTypedArray(n,s),i[e]=r),r}}const Sg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vg={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Mg={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function Ig(t,e,n,s){const{componentType:i}=t;D(t.componentType);const r=typeof i=="string"?ue.fromName(i):i,o=Sg[t.type],a=vg[t.type],c=Mg[t.type];return n+=t.byteOffset,{values:ue.createTypedArray(r,e,n,o*s),type:r,size:o,unpacker:a,packer:c}}const ce=t=>t!==void 0;function Rg(t,e,n){if(!e)return null;let s=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,s=i),s?xg(s,n):null}function xg(t,e){let n,s,i;const r=t.instancesLength,o=t.classes;let a=t.classIds,c=t.parentCounts,l=t.parentIds,u=r;ce(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,r));let h;if(ce(c))for(ce(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,r)),h=new Uint16Array(r),u=0,n=0;n<r;++n)h[n]=u,u+=c[n];ce(l)&&ce(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,u));const d=o.length;for(n=0;n<d;++n){const C=o[n].length,y=o[n].instances,_=getBinaryProperties(C,y,e);o[n].instances=combine(_,y)}const g=new Array(d).fill(0),m=new Uint16Array(r);for(n=0;n<r;++n)s=a[n],m[n]=g[s],++g[s];const A={classes:o,classIds:a,classIndexes:m,parentCounts:c,parentIndexes:h,parentIds:l};return wg(A),A}function tt(t,e,n){if(!t)return;const s=t.parentCounts;return t.parentIds?n(t,e):s>0?Pg(t,e,n):Fg(t,e,n)}function Pg(t,e,n){const s=t.classIds,i=t.parentCounts,r=t.parentIds,o=t.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(e=u.pop(),c[e]===l)continue;c[e]=l;const h=n(t,e);if(ce(h))return h;const d=i[e],g=o[e];for(let m=0;m<d;++m){const A=r[g+m];A!==e&&u.push(A)}}return null}function Fg(t,e,n){let s=!0;for(;s;){const i=n(t,e);if(ce(i))return i;const r=t.parentIds[e];s=r!==e,e=r}throw new Error("traverseHierarchySingleParent")}function wg(t){const n=t.classIds.length;for(let s=0;s<n;++s)fo(t,s,stack)}function fo(t,e,n){const s=t.parentCounts,i=t.parentIds,r=t.parentIndexes,a=t.classIds.length;if(!ce(i))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const c=ce(s)?s[e]:1,l=ce(s)?r[e]:e;for(let u=0;u<c;++u){const h=i[l+u];h!==e&&fo(t,h,n)}n.pop(e)}function z(t){return t!=null}const Ft=(t,e)=>t,Dg={HIERARCHY:!0,extensions:!0,extras:!0};class go{constructor(e,n,s){var i;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};f(this,"json",void 0),f(this,"binary",void 0),f(this,"featureCount",void 0),f(this,"_extensions",void 0),f(this,"_properties",void 0),f(this,"_binaryProperties",void 0),f(this,"_hierarchy",void 0),D(s>=0),this.json=e||{},this.binary=n,this.featureCount=s,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const o in this.json)Dg[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Rg(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),D(typeof n=="string",n),this._hierarchy){const s=tt(this._hierarchy,e,(i,r)=>{const o=i.classIds[r];return i.classes[o].name===n});return z(s)}return!1}isExactClass(e,n){return D(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),D(typeof n=="string",n),z(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=z(n)?n:[],n.length=0;const s=Object.keys(this._properties);return n.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),D(typeof n=="string",n),this._binaryProperties){const i=this._binaryProperties[n];if(z(i))return this._getBinaryProperty(i,e)}const s=this._properties[n];if(z(s))return Ft(s[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,n);if(z(i))return i}}setProperty(e,n,s){const i=this.featureCount;if(this._checkBatchId(e),D(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,e,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,s))return;let r=this._properties[n];z(r)||(this._properties[n]=new Array(i),r=this._properties[n]),r[e]=Ft(s)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,s){e.pack(s,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const s=this._properties[n],i=this._initializeBinaryProperty(n,s);i&&(e=e||{},e[n]=i)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const s=n;D(this.binary,"Property ".concat(e," requires a batch table binary.")),D(s.type,"Property ".concat(e," requires a type."));const i=Ig(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const s=tt(this._hierarchy,e,(i,r)=>{const o=i.classIds[r],a=i.classes[o].instances;return z(a[n])});return z(s)}_getPropertyNamesInHierarchy(e,n){tt(this._hierarchy,e,(s,i)=>{const r=s.classIds[i],o=s.classes[r].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(e,n){return tt(this._hierarchy,e,(s,i)=>{const r=s.classIds[i],o=s.classes[r],a=s.classIndexes[i],c=o.instances[n];return z(c)?z(c.typedArray)?this._getBinaryProperty(c,a):Ft(c[a]):null})}_setHierarchyProperty(e,n,s,i){const r=tt(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],h=l.instances[s];return z(h)?(D(a===n,'Inherited property "'.concat(s,'" is read-only.')),z(h.typedArray)?this._setBinaryProperty(h,u,i):h[u]=Ft(i),!0):!1});return z(r)}}const Tn=4;function qt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(e);if(t.magic=s.getUint32(n,!0),n+=Tn,t.version=s.getUint32(n,!0),n+=Tn,t.byteLength=s.getUint32(n,!0),n+=Tn,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const we=4,Ji="b3dm tile in legacy format.";function Ts(t,e,n){const s=new DataView(e);let i;t.header=t.header||{};let r=s.getUint32(n,!0);n+=we;let o=s.getUint32(n,!0);n+=we;let a=s.getUint32(n,!0);n+=we;let c=s.getUint32(n,!0);return n+=we,a>=570425344?(n-=we*2,i=r,a=o,c=0,r=0,o=0,console.warn(Ji)):c>=570425344&&(n-=we,i=a,a=r,c=o,r=0,o=0,console.warn(Ji)),t.header.featureTableJsonByteLength=r,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=i,n}function Es(t,e,n,s){return n=Og(t,e,n),n=Lg(t,e,n),n}function Og(t,e,n,s){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:r,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},i>0){const a=ho(e,n,i);t.featureTableJson=JSON.parse(a)}return n+=i,t.featureTableBinary=new Uint8Array(e,n,r),n+=r,n}function Lg(t,e,n,s){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:r}=t.header;if(i>0){const o=ho(e,n,i);t.batchTableJson=JSON.parse(o),n+=i,r>0&&(t.batchTableBinary=new Uint8Array(e,n,r),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=r)}return n}function mo(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:s,isRGB565:i,pointCount:r}=t;if(s&&n){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const c=s[a],u=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:v.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const c=Tg(e[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:v.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===r*3?{type:v.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:v.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const zi=new p;function Gg(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let s=0;s<t.pointsLength;s++)bg(e[s*2],e[s*2+1],zi),zi.toArray(n,s*3);return{type:v.FLOAT,size:2,value:n}}return{type:v.FLOAT,size:2,value:e}}function Ug(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,Ng(t,e)):{type:v.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Ng(t,e){const n=new p,s=new Float32Array(t.pointCount*3);for(let i=0;i<t.pointCount;i++)n.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(s,i*3);return s}async function Hg(t,e,n,s,i){n=qt(t,e,n),n=Ts(t,e,n),n=Es(t,e,n),Vg(t);const{featureTable:r,batchTable:o}=Jg(t);return await kg(t,r,o,s,i),zg(t,r,s),jg(t,r,o),Kg(t,r),n}function Vg(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Jg(t){const e=new _s(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",v.FLOAT,3);const s=Xg(t,e);return{featureTable:e,batchTable:s}}function zg(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",v.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const s=e.getPropertyArray("POSITION_QUANTIZED",v.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",v.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",v.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Ug(t,s,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function jg(t,e,n){if(!t.attributes.colors){let s=null;e.hasProperty("RGBA")?(s=e.getPropertyArray("RGBA",v.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?s=e.getPropertyArray("RGB",v.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(s=e.getPropertyArray("RGB565",v.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=mo(t,s,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",v.UNSIGNED_BYTE,4))}function Kg(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",v.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",v.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=Gg(t,n)}}function Xg(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",v.UNSIGNED_SHORT,1),t.batchIds)){const s=e.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:r}=t;n=new go(i,r,s)}return n}async function kg(t,e,n,s,i){let r,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=e.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const h=l.byteOffset,d=l.byteLength;if(!o||!Number.isFinite(h)||!d)throw new Error("Draco properties, byteOffset, and byteLength must be defined");r=t.featureTableBinary.slice(h,h+d),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!r)return!0;const u={buffer:r,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await Wg(t,u,s,i)}async function Wg(t,e,n,s){const{parse:i}=s,r={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const o=await i(e.buffer,$r,r),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,l=o.attributes.NORMAL&&o.attributes.NORMAL.value,u=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,h=a&&o.attributes.POSITION.value.quantization,d=l&&o.attributes.NORMAL.value.quantization;if(h){const m=o.POSITION.data.quantization,A=m.range;t.quantizedVolumeScale=new p(A,A,A),t.quantizedVolumeOffset=new p(m.minValues),t.quantizedRange=(1<<m.quantizationBits)-1,t.isQuantizedDraco=!0}d&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const g={};if(e.batchTableProperties)for(const m of Object.keys(e.batchTableProperties))o.attributes[m]&&o.attributes[m].value&&(g[m.toLowerCase()]=o.attributes[m].value);t.attributes={positions:a,colors:mo(t,c,void 0),normals:l,batchIds:u,...g}}const Gn={URI:0,EMBEDDED:1};function po(t,e,n,s){t.rotateYtoZ=!0;const i=t.byteOffset+t.byteLength-n;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=ns(e,n,i),t.gltfByteOffset=0,t.gltfByteLength=i,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function Ao(t,e,n,s){const i=n["3d-tiles"]||{};if(Qg(t,e),i.loadGLTF){const{parse:r,fetch:o}=s;t.gltfUrl&&(t.gltfArrayBuffer=await o(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await r(t.gltfArrayBuffer,Ke,n,s),t.gpuMemoryUsageInBytes=qr(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function Qg(t,e,n){switch(e){case Gn.URI:const s=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),r=new TextDecoder().decode(s);t.gltfUrl=r.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Gn.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function qg(t,e,n,s,i){var r;n=Yg(t,e,n,s),await Ao(t,Gn.EMBEDDED,s,i);const o=t==null||(r=t.gltf)===null||r===void 0?void 0:r.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}function Yg(t,e,n,s,i){n=qt(t,e,n),n=Ts(t,e,n),n=Es(t,e,n),n=po(t,e,n,s);const r=new _s(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=r.getGlobalProperty("RTC_CENTER",v.FLOAT,3),n}async function $g(t,e,n,s,i){return n=Zg(t,e,n,s),await Ao(t,t.gltfFormat,s,i),n}function Zg(t,e,n,s,i){if(n=qt(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=Ts(t,e,n);const r=new DataView(e);if(t.gltfFormat=r.getUint32(n,!0),n+=4,n=Es(t,e,n),n=po(t,e,n,s),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new _s(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",v.FLOAT,3);const c=new go(t.batchTableJson,t.batchTableBinary,a);return em(t,o,c,a),n}function em(t,e,n,s){const r={instances:new Array(s),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new p;new p,new p,new p;const a=new G,c=new at,l=new p,u={},h=new P,d=[],g=[],m=new p,A=new p;for(let C=0;C<s;C++){let y;if(e.hasProperty("POSITION"))y=e.getProperty("POSITION",v.FLOAT,3,C,o);else if(e.hasProperty("POSITION_QUANTIZED")){y=e.getProperty("POSITION_QUANTIZED",v.UNSIGNED_SHORT,3,C,o);const w=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",v.FLOAT,3,m);if(!w)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const R=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",v.FLOAT,3,A);if(!R)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const I=65535;for(let b=0;b<3;b++)y[b]=y[b]/I*R[b]+w[b]}if(!y)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(y),u.translation=o,t.normalUp=e.getProperty("NORMAL_UP",v.FLOAT,3,C,d),t.normalRight=e.getProperty("NORMAL_RIGHT",v.FLOAT,3,C,g),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",v.UNSIGNED_SHORT,2,d),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",v.UNSIGNED_SHORT,2,g),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(O.WGS84.eastNorthUpToFixedFrame(o,h),h.getRotationMatrix3(a)):a.identity()}c.fromMatrix3(a),u.rotation=c,l.set(1,1,1);const _=e.getProperty("SCALE",v.FLOAT,1,C);Number.isFinite(_)&&l.multiplyByScalar(_);const T=e.getProperty("SCALE_NON_UNIFORM",v.FLOAT,3,C,d);T&&l.scale(T),u.scale=l;let E=e.getProperty("BATCH_ID",v.UNSIGNED_SHORT,1,C);E===void 0&&(E=C);const S=new P().fromQuaternion(u.rotation);h.identity(),h.translate(u.translation),h.multiplyRight(S),h.scale(u.scale);const F=h.clone();r[C]={modelMatrix:F,batchId:E}}t.instances=r}async function tm(t,e,n,s,i,r){n=qt(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const a={};t.tiles.push(a),n=await r(e,n,s,i,a)}return n}async function nm(t,e,n,s){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=s;t.gltf=await i(e,Ke,n,s),t.gpuMemoryUsageInBytes=qr(t.gltf)}async function Co(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=e,i.type=Cg(t,e),i.type){case et.COMPOSITE:return await tm(i,t,e,n,s,Co);case et.BATCHED_3D_MODEL:return await qg(i,t,e,n,s);case et.GLTF:return await nm(i,t,n,s);case et.INSTANCED_3D_MODEL:return await $g(i,t,e,n,s);case et.POINT_CLOUD:return await Hg(i,t,e,n,s);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const sm=1952609651,im=1;async function rm(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==sm)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==im)throw new Error("Wrong subtree file verson, must be 1");const r=ji(t.slice(8,16)),o=new Uint8Array(t,24,r),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=ji(t.slice(16,24));let h=new ArrayBuffer(0);return u&&(h=t.slice(24+r)),"bufferView"in l.tileAvailability&&(l.tileAvailability.explicitBitstream=await En(l,"tileAvailability",h,n)),"bufferView"in l.contentAvailability&&(l.contentAvailability.explicitBitstream=await En(l,"contentAvailability",h,n)),"bufferView"in l.childSubtreeAvailability&&(l.childSubtreeAvailability.explicitBitstream=await En(l,"childSubtreeAvailability",h,n)),l}function om(t,e){if(e.startsWith("http")){const r=new URL(t,e);return decodeURI(r.toString())}const s="http://".concat(e),i=new URL(t,s);return"/".concat(i.host).concat(i.pathname)}async function En(t,e,n,s){const i=t[e].bufferView,r=t.bufferViews[i],o=t.buffers[r.buffer];if(!(s!=null&&s.url)||!s.fetch)throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const a=om(o.uri,s==null?void 0:s.url),l=await(await s.fetch(a)).arrayBuffer();return new Uint8Array(l,r.byteOffset,r.byteLength)}return new Uint8Array(n,r.byteOffset,r.byteLength)}function ji(t){const e=new DataView(t),n=e.getUint32(0,!0),s=e.getUint32(4,!0);return n+2**32*s}const Bo={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:uo,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:rm,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var ee=null;try{ee=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function x(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}x.prototype.__isLong__;Object.defineProperty(x.prototype,"__isLong__",{value:!0});function J(t){return(t&&t.__isLong__)===!0}function Ki(t){var e=Math.clz32(t&-t);return t?31-e:e}x.isLong=J;var Xi={},ki={};function Ie(t,e){var n,s,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(s=ki[t],s)?s:(n=M(t,0,!0),i&&(ki[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(s=Xi[t],s)?s:(n=M(t,t<0?-1:0,!1),i&&(Xi[t]=n),n))}x.fromInt=Ie;function te(t,e){if(isNaN(t))return e?me:re;if(e){if(t<0)return me;if(t>=yo)return Eo}else{if(t<=-Qi)return j;if(t+1>=Qi)return To}return t<0?te(-t,e).neg():M(t%Xe|0,t/Xe|0,e)}x.fromNumber=te;function M(t,e,n){return new x(t,e,n)}x.fromBits=M;var Jt=Math.pow;function bs(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?me:re;if(n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return bs(t.substring(1),e,n).neg();for(var i=te(Jt(n,8)),r=re,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+a),n);if(a<8){var l=te(Jt(n,a));r=r.mul(l).add(te(c))}else r=r.mul(i),r=r.add(te(c))}return r.unsigned=e,r}x.fromString=bs;function oe(t,e){return typeof t=="number"?te(t,e):typeof t=="string"?bs(t,e):M(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}x.fromValue=oe;var Wi=65536,am=1<<24,Xe=Wi*Wi,yo=Xe*Xe,Qi=yo/2,qi=Ie(am),re=Ie(0);x.ZERO=re;var me=Ie(0,!0);x.UZERO=me;var Ge=Ie(1);x.ONE=Ge;var _o=Ie(1,!0);x.UONE=_o;var Un=Ie(-1);x.NEG_ONE=Un;var To=M(-1,2147483647,!1);x.MAX_VALUE=To;var Eo=M(-1,-1,!0);x.MAX_UNSIGNED_VALUE=Eo;var j=M(0,-2147483648,!1);x.MIN_VALUE=j;var B=x.prototype;B.toInt=function(){return this.unsigned?this.low>>>0:this.low};B.toNumber=function(){return this.unsigned?(this.high>>>0)*Xe+(this.low>>>0):this.high*Xe+(this.low>>>0)};B.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(j)){var n=te(e),s=this.div(n),i=s.mul(n).sub(this);return s.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=te(Jt(e,6),this.unsigned),o=this,a="";;){var c=o.div(r),l=o.sub(c.mul(r)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};B.getHighBits=function(){return this.high};B.getHighBitsUnsigned=function(){return this.high>>>0};B.getLowBits=function(){return this.low};B.getLowBitsUnsigned=function(){return this.low>>>0};B.getNumBitsAbs=function(){if(this.isNegative())return this.eq(j)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};B.isZero=function(){return this.high===0&&this.low===0};B.eqz=B.isZero;B.isNegative=function(){return!this.unsigned&&this.high<0};B.isPositive=function(){return this.unsigned||this.high>=0};B.isOdd=function(){return(this.low&1)===1};B.isEven=function(){return(this.low&1)===0};B.equals=function(e){return J(e)||(e=oe(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};B.eq=B.equals;B.notEquals=function(e){return!this.eq(e)};B.neq=B.notEquals;B.ne=B.notEquals;B.lessThan=function(e){return this.comp(e)<0};B.lt=B.lessThan;B.lessThanOrEqual=function(e){return this.comp(e)<=0};B.lte=B.lessThanOrEqual;B.le=B.lessThanOrEqual;B.greaterThan=function(e){return this.comp(e)>0};B.gt=B.greaterThan;B.greaterThanOrEqual=function(e){return this.comp(e)>=0};B.gte=B.greaterThanOrEqual;B.ge=B.greaterThanOrEqual;B.compare=function(e){if(J(e)||(e=oe(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};B.comp=B.compare;B.negate=function(){return!this.unsigned&&this.eq(j)?j:this.not().add(Ge)};B.neg=B.negate;B.add=function(e){J(e)||(e=oe(e));var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,r=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,h=0,d=0,g=0;return g+=r+l,d+=g>>>16,g&=65535,d+=i+c,h+=d>>>16,d&=65535,h+=s+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,M(d<<16|g,u<<16|h,this.unsigned)};B.subtract=function(e){return J(e)||(e=oe(e)),this.add(e.neg())};B.sub=B.subtract;B.multiply=function(e){if(this.isZero())return this;if(J(e)||(e=oe(e)),ee){var n=ee.mul(this.low,this.high,e.low,e.high);return M(n,ee.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?me:re;if(this.eq(j))return e.isOdd()?j:re;if(e.eq(j))return this.isOdd()?j:re;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(qi)&&e.lt(qi))return te(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,h=0,d=0,g=0,m=0;return m+=o*u,g+=m>>>16,m&=65535,g+=r*u,d+=g>>>16,g&=65535,g+=o*l,d+=g>>>16,g&=65535,d+=i*u,h+=d>>>16,d&=65535,d+=r*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=s*u+i*l+r*c+o*a,h&=65535,M(g<<16|m,h<<16|d,this.unsigned)};B.mul=B.multiply;B.divide=function(e){if(J(e)||(e=oe(e)),e.isZero())throw Error("division by zero");if(ee){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?ee.div_u:ee.div_s)(this.low,this.high,e.low,e.high);return M(n,ee.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?me:re;var s,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return me;if(e.gt(this.shru(1)))return _o;r=me}else{if(this.eq(j)){if(e.eq(Ge)||e.eq(Un))return j;if(e.eq(j))return Ge;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(re)?e.isNegative()?Ge:Un:(i=this.sub(e.mul(s)),r=s.add(i.div(e)),r)}else if(e.eq(j))return this.unsigned?me:re;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=re}for(i=this;i.gte(e);){s=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:Jt(2,a-48),l=te(s),u=l.mul(e);u.isNegative()||u.gt(i);)s-=c,l=te(s,this.unsigned),u=l.mul(e);l.isZero()&&(l=Ge),r=r.add(l),i=i.sub(u)}return r};B.div=B.divide;B.modulo=function(e){if(J(e)||(e=oe(e)),ee){var n=(this.unsigned?ee.rem_u:ee.rem_s)(this.low,this.high,e.low,e.high);return M(n,ee.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};B.mod=B.modulo;B.rem=B.modulo;B.not=function(){return M(~this.low,~this.high,this.unsigned)};B.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};B.clz=B.countLeadingZeros;B.countTrailingZeros=function(){return this.low?Ki(this.low):Ki(this.high)+32};B.ctz=B.countTrailingZeros;B.and=function(e){return J(e)||(e=oe(e)),M(this.low&e.low,this.high&e.high,this.unsigned)};B.or=function(e){return J(e)||(e=oe(e)),M(this.low|e.low,this.high|e.high,this.unsigned)};B.xor=function(e){return J(e)||(e=oe(e)),M(this.low^e.low,this.high^e.high,this.unsigned)};B.shiftLeft=function(e){return J(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?M(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):M(0,this.low<<e-32,this.unsigned)};B.shl=B.shiftLeft;B.shiftRight=function(e){return J(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?M(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):M(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};B.shr=B.shiftRight;B.shiftRightUnsigned=function(e){return J(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?M(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?M(this.high,0,this.unsigned):M(this.high>>>e-32,0,this.unsigned)};B.shru=B.shiftRightUnsigned;B.shr_u=B.shiftRightUnsigned;B.rotateLeft=function(e){var n;return J(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?M(this.high,this.low,this.unsigned):e<32?(n=32-e,M(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,M(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};B.rotl=B.rotateLeft;B.rotateRight=function(e){var n;return J(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?M(this.high,this.low,this.unsigned):e<32?(n=32-e,M(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,M(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};B.rotr=B.rotateRight;B.toSigned=function(){return this.unsigned?M(this.low,this.high,!1):this};B.toUnsigned=function(){return this.unsigned?this:M(this.low,this.high,!0)};B.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};B.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};B.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};x.fromBytes=function(e,n,s){return s?x.fromBytesLE(e,n):x.fromBytesBE(e,n)};x.fromBytesLE=function(e,n){return new x(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};x.fromBytesBE=function(e,n){return new x(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const cm=16;function bo(t){t==="X"&&(t="");const e=t.padEnd(cm,"0");return x.fromString(e,!0,16)}function lm(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const s=e;e*=4;const r=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-s-r.length).join("0")+r}function um(t,e){const n=hm(t).shiftRightUnsigned(2);return t.add(x.fromNumber(2*e+1-4).multiply(n))}function hm(t){return t.and(t.not().add(1))}const dm=3,fm=30,gm=2*fm+1,Yi=180/Math.PI;function mm(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),s=e[1],i=s.length;let r=0;const o=[0,0];for(let a=i-1;a>=0;a--){r=i-a;const c=s[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const h=Math.pow(2,r-1);Am(h,o,l,u),o[0]+=h*l,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:r}}function pm(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<dm+gm;)e="0"+e;const n=e.lastIndexOf("1"),s=e.substring(0,3),i=e.substring(3,n),r=i.length/2,o=x.fromString(s,!0,2).toString(10);let a="";if(r!==0)for(a=x.fromString(i,!0,2).toString(4);a.length<r;)a="0"+a;return"".concat(o,"/").concat(a)}function So(t,e,n){const s=1<<e;return[(t[0]+n[0])/s,(t[1]+n[1])/s]}function $i(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function vo(t){return[$i(t[0]),$i(t[1])]}function Mo(t,e){let[n,s]=e;switch(t){case 0:return[1,n,s];case 1:return[-n,1,s];case 2:return[-n,-s,1];case 3:return[-1,-s,-n];case 4:return[s,-1,-n];case 5:return[s,n,-1];default:throw new Error("Invalid face")}}function Io(t){let[e,n,s]=t;const i=Math.atan2(s,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*Yi,i*Yi]}function Am(t,e,n,s){if(s===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Cm(t){const e=So(t.ij,t.level,[.5,.5]),n=vo(e),s=Mo(t.face,n);return Io(s)}const Bm=100;function Zi(t){const{face:e,ij:n,level:s}=t,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(Bm*Math.pow(2,-s))),o=new Float64Array(4*r*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=i[l].slice(0),h=i[l+1],d=(h[0]-u[0])/r,g=(h[1]-u[1])/r;for(let m=0;m<r;m++){u[0]+=d,u[1]+=g;const A=So(n,s,u),C=vo(A),y=Mo(e,C),_=Io(y);Math.abs(_[1])>89.999&&(_[0]=c);const T=_[0]-c;_[0]+=T>180?-360:T<-180?360:0,o[a++]=_[0],o[a++]=_[1],c=_[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Ss(t){const e=ym(t);return mm(e)}function ym(t){if(t.indexOf("/")>0)return t;const e=bo(t);return pm(e)}function _m(t){const e=Ss(t);return Cm(e)}function Tm(t){let e;if(t.face===2||t.face===5){let n=null,s=0;for(let i=0;i<4;i++){const r="".concat(t.face,"/").concat(i),o=Ss(r),a=Zi(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,s),s+=a.length}e=er(n)}else{const n=Zi(t);e=er(n)}return e}function er(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let s=0;s<t.length;s+=2)e.push(t[s]),n.push(t[s+1]);return e.sort((s,i)=>s-i),n.sort((s,i)=>s-i),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function Em(t,e){const n=(e==null?void 0:e.minimumHeight)||0,s=(e==null?void 0:e.maximumHeight)||0,i=Ss(t),r=Tm(i),o=r.west,a=r.south,c=r.east,l=r.north,u=[];return u.push(new p(o,l,n)),u.push(new p(c,l,n)),u.push(new p(c,a,n)),u.push(new p(o,a,n)),u.push(new p(o,l,s)),u.push(new p(c,l,s)),u.push(new p(c,a,s)),u.push(new p(o,a,s)),u}function Ro(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},s=Em(e,n),i=_m(e),r=i[0],o=i[1],a=O.WGS84.cartographicToCartesian([r,o,n.maximumHeight]),c=new p(a[0],a[1],a[2]);s.push(c);const l=Af(s);return[...l.center,...l.halfAxes]}const bm=4,Sm=8,vm={QUADTREE:bm,OCTREE:Sm};function Mm(t,e,n){if(t!=null&&t.box){const s=bo(t.s2VolumeInfo.token),i=um(s,e),r=lm(i),o={...t.s2VolumeInfo};switch(o.token=r,n){case"OCTREE":const l=t.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,h=u/2,d=l.minimumHeight+u/2;l.minimumHeight=d-h,l.maximumHeight=d+h;break}return{box:Ro(o),s2VolumeInfo:o}}}async function xo(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:r}=t;let{subtree:o,level:a=0}=t;const{subdivisionScheme:c,subtreeLevels:l,maximumLevel:u,contentUrlTemplate:h,subtreesUriTemplate:d,basePath:g}=e,m={children:[],lodMetricValue:0,contentUrl:""},A=vm[c],C=s&1,y=s>>1&1,_=s>>2&1,T=(A**a-1)/(A-1);let E=Te(n.mortonIndex,s),S=T+E,F=Te(n.x,C),w=Te(n.y,y),R=Te(n.z,_),I=!1;a+1>l&&(I=bn(o.childSubtreeAvailability,E));const b=Te(i.x,F),q=Te(i.y,w),ne=Te(i.z,R),Re=a+i.level;if(I){const _e="".concat(g,"/").concat(d),Qe=Nn(_e,Re,b,q,ne);o=await ft(Qe,Bo),i.mortonIndex=E,i.x=F,i.y=w,i.z=R,i.level=a,E=0,S=0,F=0,w=0,R=0,a=0}if(!bn(o.tileAvailability,S)||a>u)return m;bn(o.contentAvailability,S)&&(m.contentUrl=Nn(h,Re,b,q,ne));const $t=a+1,Zt={mortonIndex:E,x:F,y:w,z:R};for(let _e=0;_e<A;_e++){const Qe=Mm(r,_e,c),Ct=await xo({subtree:o,options:e,parentData:Zt,childIndex:_e,level:$t,globalData:i,s2VolumeBox:Qe});if(Ct.contentUrl||Ct.children.length){const Fo=Re+1,wo=Im(Ct,Fo,{childTileX:F,childTileY:w,childTileZ:R},e,r);m.children.push(wo)}}return m}function bn(t,e){return"constant"in t?!!t.constant:t.explicitBitstream?Pm(e,t.explicitBitstream):!1}function Im(t,e,n,s,i){const{basePath:r,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:h}=s,d=t.contentUrl&&t.contentUrl.replace("".concat(r,"/"),""),g=u/2**e,m=i!=null&&i.box?{box:i.box}:h,A=Rm(e,m,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:d},id:t.contentUrl,refine:a(o),type:l(t),lodMetricType:c,lodMetricValue:g,geometricError:g,transform:t.transform,boundingVolume:A}}function Rm(t,e,n){if(e.region){const{childTileX:s,childTileY:i,childTileZ:r}=n,[o,a,c,l,u,h]=e.region,d=2**t,g=(c-o)/d,m=(l-a)/d,A=(h-u)/d,[C,y]=[o+g*s,o+g*(s+1)],[_,T]=[a+m*i,a+m*(i+1)],[E,S]=[u+A*r,u+A*(r+1)];return{region:[C,_,y,T,E,S]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Te(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function Nn(t,e,n,s,i){const r=xm({level:e,x:n,y:s,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>r[o])}function xm(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function Pm(t,e){const n=Math.floor(t/8),s=t%8;return(e[n]>>s&1)===1}function vs(t){if(!t.contentUrl)return Ve.EMPTY;const n=t.contentUrl.split("?")[0].split(".").pop();switch(n){case"pnts":return Ve.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ve.SCENEGRAPH;default:return n}}function Ms(t){switch(t){case"REPLACE":case"replace":return pe.REPLACE;case"ADD":case"add":return pe.ADD;default:return t}}function Hn(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const s=new URL(t,"".concat(e,"/"));return decodeURI(s.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function tr(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=Hn(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=Wt.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=vs(t),t.refine=Ms(t.refine),t}async function Fm(t,e){const n=t.basePath;let s;const i=sr(t==null?void 0:t.root);i&&t.root?s=await nr(t.root,t,i,e):s=tr(t.root,t);const r=[];for(r.push(s);r.length>0;){const a=(r.pop()||{}).children||[];for(let c of a){const l=sr(c);l?c=await nr(c,t,l,e):tr(c,{basePath:n}),r.push(c)}}return s}async function nr(t,e,n,s){var i,r;const o=e.basePath,{subdivisionScheme:a,maximumLevel:c,subtreeLevels:l,subtrees:{uri:u}}=n,h=Nn(u,0,0,0,0),d=Hn(h,o),g=await ft(d,Bo,s),m=Hn(t.content.uri,o),A=e==null||(i=e.root)===null||i===void 0?void 0:i.refine,C=t.geometricError,y=(r=t.boundingVolume.extensions)===null||r===void 0?void 0:r["3DTILES_bounding_volume_S2"];if(y){const S={box:Ro(y),s2VolumeInfo:y};t.boundingVolume=S}const _=t.boundingVolume,T={contentUrlTemplate:m,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:l,maximumLevel:c,refine:A,basePath:o,lodMetricType:Wt.GEOMETRIC_ERROR,rootLodMetricValue:C,rootBoundingVolume:_,getTileType:vs,getRefine:Ms};return await wm(t,g,T)}async function wm(t,e,n){if(!t)return null;t.lodMetricType=Wt.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:s,contentUrl:i}=await xo({subtree:e,options:n,s2VolumeBox:t});return i&&(t.contentUrl=i,t.content={uri:i.replace("".concat(n.basePath,"/"),"")}),t.refine=Ms(t.refine),t.type=vs(t),t.children=s,t.id=t.contentUrl,t}function sr(t){var e;return(t==null||(e=t.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const Po={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:uo,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Gm,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Dm(t){return Cr(t.url)}async function Om(t,e,n){const s={content:{featureIds:null}};return await Co(t,0,e,n,s.content),s.content}async function Lm(t,e,n){var s;const i=JSON.parse(new TextDecoder().decode(t));return i.loader=e.loader||Po,i.url=n.url,i.queryString=n.queryString,i.basePath=Dm(i),i.root=await Fm(i,e),i.type=Y.TILES3D,i.lodMetricType=Wt.GEOMETRIC_ERROR,i.lodMetricValue=((s=i.root)===null||s===void 0?void 0:s.lodMetricValue)||0,i}async function Gm(t,e,n){const s=e["3d-tiles"]||{};let i;return s.isTileset==="auto"?i=n.url&&n.url.indexOf(".json")!==-1:i=s.isTileset,i?t=await Lm(t,e,n):t=await Om(t,e,n),t}const ir=[0],Um={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Po,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Is extends os{constructor(...e){super(...e),f(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&le.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,n;return!!(!((e=this.state)===null||e===void 0||(n=e.tileset3d)===null||n===void 0)&&n.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:s}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),s.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(s.propsChanged){const{layerMap:i}=this.state;for(const r in i)i[r].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:s}=this.state;this.internalState.viewport=e,n[e.id]=e;const i=s==null?void 0:s[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const s=n&&n.props.tile;return e.picked&&(e.object=s),e.sourceTile=s,e}filterSubLayer({layer:e,viewport:n}){const{tile:s}=e.props,{id:i}=n;return s.selected&&s.viewportIds.includes(i)}_updateAutoHighlight(e){const n=e.sourceTile,s=this.state.layerMap[n==null?void 0:n.id];s&&s.layer&&s.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let s=this.props.loader||this.props.loaders;Array.isArray(s)&&(s=s[0]);const i={loadOptions:{...n}};let r=e;if(s.preload){const c=await s.preload(e,n);c.url&&(r=c.url),c.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:c.headers}),Object.assign(i,c)}const o=await ft(r,s,i.loadOptions),a=new Ag(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:s}=this.context,i=Object.keys(e).length;!s||!i||!n||n.selectTiles(Object.values(e)).then(r=>{this.state.frameNumber!==r&&this.setState({frameNumber:r})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case Ve.POINTCLOUD:return this._makePointCloudLayer(e,n);case Ve.SCENEGRAPH:return this._make3DModelLayer(e);case Ve.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:s,pointCount:i,constantRGBA:r,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:c,normals:l,colors:u}=s;if(!c)return null;const h=n&&n.props.data||{header:{vertexCount:i},attributes:{POSITION:c,NORMAL:l,COLOR_0:u}},{pointSize:d,getPointColor:g}=this.props,m=this.getSubLayerClass("pointcloud",cs);return new m({pointSize:d},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:h,coordinateSystem:Ue.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:r||g,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:s,cartographicOrigin:i,modelMatrix:r}=e.content,o=this.getSubLayerClass("scenegraph",Xt);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:s||ir,scenegraph:n,coordinateSystem:Ue.METER_OFFSETS,coordinateOrigin:i,modelMatrix:r,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const s=e.content,{attributes:i,indices:r,modelMatrix:o,cartographicOrigin:a,coordinateSystem:c=Ue.METER_OFFSETS,material:l,featureIds:u}=s,{_getMeshColor:h}=this.props,d=n&&n.props.mesh||new ye({drawMode:4,attributes:Nm(i),indices:r}),g=this.getSubLayerClass("mesh",ys);return new g(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:d,data:ir,getColor:h(e),pbrMaterial:l,modelMatrix:o,coordinateOrigin:a,coordinateSystem:c,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(s=>{const i=n[s.id]=n[s.id]||{tile:s};let{layer:r}=i;return s.selected&&(r?i.needsUpdate&&(r=this._getSubLayer(s,r),i.needsUpdate=!1):r=this._getSubLayer(s)),i.layer=r,r}).filter(Boolean):null}}f(Is,"defaultProps",Um);f(Is,"layerName","Tile3DLayer");function Nm(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}var Sn,Hm=new Uint8Array(16);function Vm(){if(!Sn&&!(Sn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sn(Hm)}var Jm=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var H=[],vn=0;vn<256;++vn)H.push((vn+256).toString(16).substr(1));function zm(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(H[t[e+0]]+H[t[e+1]]+H[t[e+2]]+H[t[e+3]]+"-"+H[t[e+4]]+H[t[e+5]]+"-"+H[t[e+6]]+H[t[e+7]]+"-"+H[t[e+8]]+H[t[e+9]]+"-"+H[t[e+10]]+H[t[e+11]]+H[t[e+12]]+H[t[e+13]]+H[t[e+14]]+H[t[e+15]]).toLowerCase();if(!function(s){return typeof s=="string"&&Jm.test(s)}(n))throw TypeError("Stringified UUID is invalid");return n}function jm(t,e,n){var s=(t=t||{}).random||(t.rng||Vm)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=s[i];return e}return zm(s)}function wt(t,e,n){return(e=function(s){var i=function(r,o){if(typeof r!="object"||r===null)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var c=a.call(r,o||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}(s,"string");return typeof i=="symbol"?i:String(i)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var rr,Mn,Km=(rr=function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(c){return(c=Math.round(c))<0?0:c>255?255:c}function i(c){return c<0?0:c>1?1:c}function r(c){return c[c.length-1]==="%"?s(parseFloat(c)/100*255):s(parseInt(c))}function o(c){return c[c.length-1]==="%"?i(parseFloat(c)/100):i(parseFloat(c))}function a(c,l,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?c+(l-c)*u*6:2*u<1?l:3*u<2?c+(l-c)*(2/3-u)*6:c}try{e.parseCSSColor=function(c){var l,u=c.replace(/ /g,"").toLowerCase();if(u in n)return n[u].slice();if(u[0]==="#")return u.length===4?(l=parseInt(u.substr(1),16))>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null:u.length===7&&(l=parseInt(u.substr(1),16))>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null;var h=u.indexOf("("),d=u.indexOf(")");if(h!==-1&&d+1===u.length){var g=u.substr(0,h),m=u.substr(h+1,d-(h+1)).split(","),A=1;switch(g){case"rgba":if(m.length!==4)return null;A=o(m.pop());case"rgb":return m.length!==3?null:[r(m[0]),r(m[1]),r(m[2]),A];case"hsla":if(m.length!==4)return null;A=o(m.pop());case"hsl":if(m.length!==3)return null;var C=(parseFloat(m[0])%360+360)%360/360,y=o(m[1]),_=o(m[2]),T=_<=.5?_*(y+1):_+y-_*y,E=2*_-T;return[s(255*a(E,T,C+1/3)),s(255*a(E,T,C)),s(255*a(E,T,C-1/3)),A];default:return null}}return null}}catch{}},rr(Mn={exports:{}},Mn.exports),Mn.exports);class Je{constructor(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;wt(this,"r",void 0),wt(this,"g",void 0),wt(this,"b",void 0),wt(this,"a",void 0),this.r=e,this.g=n,this.b=s,this.a=i}static parse(e){if(e){if(e instanceof Je)return e;if(Array.isArray(e))return new Je(...e);if(typeof e=="string"){const n=Km.parseCSSColor(e);return n?new Je(...n):void 0}}}toArray(){const{r:e,g:n,b:s,a:i}=this;return i===0?[0,0,0,0]:[e,n,s,i]}toString(){const[e,n,s,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${i})`}toArrayForDeck(){const{r:e,g:n,b:s,a:i}=this;return i===0?[0,0,0,0]:[e,n,s,255*i]}}const de={mixins:[{mixins:[{render(){const t=this.$options&&this.$options.stubVNode?this.$options.stubVNode:{};if(t.empty){const s=Ps();return typeof t.empty=="string"?s.text=t.empty:typeof t.empty=="function"&&(s.text=t.empty.call(this)),s}let e;e=t.slots===!1?void 0:function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Object.keys(s).reduce((r,o)=>(i.length&&!i.includes(o)||(r=r.concat(s[o])),r),[])}(this.$slots.default?this.$slots.default():[],t.slots);const n={attrs:typeof t.attrs=="function"?t.attrs.call(this):t.attrs,style:{display:"none !important"}};return Ps(t.tag||"i",n,e)}}],inject:["getMap"],emits:["created"],mounted(){this.$options.inject&&this.getMap&&this.getMap.then(t=>{this.$mapVm=t,this.$map=t.$map,this.init(t),this.$emit("created",this)})},data:()=>({rev:0}),methods:{init(){throw new Error("")}}}],emits:["mousemove","mouseleave","click"],props:{id:{type:String,default:()=>jm()},data:{type:[Array,Object,Promise,String],default:()=>[]},show:{type:Boolean,default:!0},opacity:{type:Number,default:1},pickable:{type:Boolean,default:!1},autoHighlight:{type:Boolean,default:!1},highlightColor:{type:[String,Array],default:()=>[255,255,128,1]},highlightedObjectIndex:{type:Number,default:-1},onDataLoad:{type:Function},dataTransform:{type:Function},transitions:{type:Object,default:()=>{}}},watch:{data(t){this.$layer&&this.$layer.setProps({data:t})},show(t){this.$layer&&this.$layer.setProps({visible:t})},opacity(t){this.$layer&&this.$layer.setProps({opacity:t})},pickable(t){this.$layer&&this.$layer.setProps({pickable:t})},autoHighlight(t){this.$layer&&this.$layer.setProps({autoHighlight:t})},highlightedObjectIndex(t){this.$layer&&this.$layer.setProps({highlightedObjectIndex:t})},highlightColor(t){this.setColorProps("highlightColor",t)}},created(){const t={id:this.id,data:this.data,visible:this.show,opacity:this.opacity,pickable:this.pickable,autoHighlight:this.autoHighlight,highlightedObjectIndex:this.highlightedObjectIndex,highlightColor:this.parseColorVal(this.highlightColor),onDataLoad:this.onDataLoad,dataTransform:this.dataTransform,transitions:this.transitions,onMouseover:e=>{e.object&&this.$emit("mousemove",{object:e.object,coordinates:this._getCoordinateFromInfo(e),pixel:e.pixel})},onMouseleave:()=>{this.$emit("mouseleave")},onClick:e=>{e.object&&this.$emit("click",{object:e.object,coordinates:this._getCoordinateFromInfo(e),pixel:e.pixel})}};this.$layer=this.createLayer(t)},beforeUnmount(){this.$map&&this.$map.style&&this.$map.removeLayer(this.id)},methods:{init(t){const{__deck:e}=this.$map;if(this.$map.addLayer(this.$layer),e)return;let n;this.$layer.deck.setProps({onHover:(s,i)=>{s.layer?(n&&n.id!==s.layer.id&&n.props.onMouseleave(),s.layer.props.onMouseover(s,i),n=s.layer):(n&&n.props.onMouseleave(),n=void 0)}})},createLayer(t){throw new Error("")},setColorProps(t,e){this.$layer&&this.$layer.setProps(t,this.parseColorVal(e))},parseColorVal(t){return typeof t=="function"?(e=t,n=>{let s=e(n);return Je.parse(s).toArrayForDeck()}):Je.parse(t).toArrayForDeck();var e},_getCoordinateFromInfo(t){if(this.$map)return this.$map.unproject(t.pixel)}}},Vn={mixins:[de],props:{widthUnits:{type:String,default:"meters"},widthScale:{type:Number,default:1},widthMinPixels:{type:Number,default:0},widthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},capRounded:{type:Boolean,default:!1},jointRounded:{type:Boolean,default:!1},miterLimit:{type:Number,default:4},getPath:{type:Function,default:t=>t.path},getColor:{type:[String,Function,Array],default:"black"},getWidth:{type:[Number,Function],default:100}},watch:{widthUnits(t){this.$layer&&this.$layer.setProps({widthUnits:t})},widthScale(t){this.$layer&&this.$layer.setProps({widthScale:t})},widthMinPixels(t){this.$layer&&this.$layer.setProps({widthMinPixels:t})},widthMaxPixels(t){this.$layer&&this.$layer.setProps({widthMaxPixels:t})},capRounded(t){this.$layer&&this.$layer.setProps({capRounded:t})},jointRounded(t){this.$layer&&this.$layer.setProps({jointRounded:t})},miterLimit(t){this.$layer&&this.$layer.setProps({miterLimit:t})},getColor(t){this.setColorProps("getColor",t)},getWidth(t){this.$layer&&this.$layer.setProps({getWidth:t})},getPath(t){this.$layer&&this.$layer.setProps({getPath:t})}},methods:{createLayer(t){return new he(Object.assign({},t,{type:Ar,widthUnits:this.widthUnits,widthScale:this.widthScale,widthMinPixels:this.widthMinPixels,widthMaxPixels:this.widthMaxPixels,capRounded:this.capRounded,jointRounded:this.jointRounded,miterLimit:this.miterLimit,getPath:this.getPath,getWidth:this.getWidth,getColor:this.parseColorVal(this.getColor),_pathType:this._pathType}))}}};var Jn={name:"x-arc-layer",mixins:[de],props:{width:{type:[Number,Function],default:1},sourcePosition:{type:[Array,Function],required:!0},targetPosition:{type:[Array,Function],required:!0},sourceColor:{type:[String,Function],default:"black"},targetColor:{type:[String,Function],default:"black"},height:{type:[Number,Function],default:1}},watch:{width(t){this.$layer&&this.$layer.setProps({width:t})},height(t){this.$layer&&this.$layer.setProps({getHeight:t})},sourcePosition(t){this.$layer&&this.$layer.setProps({getSourcePosition:t})},targetPosition(t){this.$layer&&this.$layer.setProps({getTargetPosition:t})},sourceColor(t){this.setColorProp("getSourceColor",t)},targetColor(t){this.setColorProp("getTargetColor",t)}},methods:{createLayer(t){return new he(Object.assign({},t,{type:Ea,getWidth:this.width,getHeight:this.height,getSourcePosition:this.sourcePosition,getTargetPosition:this.targetPosition,getSourceColor:this.parseColorVal(this.sourceColor),getTargetColor:this.parseColorVal(this.targetColor)}))}},__file:"src/arc-layer/arc-layer.vue",install:function(t){t.component(Jn.name,Jn)}},zn={name:"x-column-layer",mixins:[de],props:{radius:{type:Number,default:1e3},filled:{type:Boolean,default:!0},stroked:{type:Boolean,default:!1},extruded:{type:Boolean,default:!0},lineWidthUnits:{type:String,default:"meters"},lineWidthScale:{type:Number,default:1},lineWidthMinPixels:{type:Number,default:0},lineWidthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},position:{type:Function,required:!0},elevation:{type:[Number,Function],default:1e3},fillColor:{type:[String,Function],default:"black"},lineColor:{type:[String,Function],default:"black"},lineWidth:{type:[Number,Function],default:1}},watch:{radius(t){this.$layer&&this.$layer.setProps({radius:t})},filled(t){this.$layer&&this.$layer.setProps({filled:t})},stroked(t){this.$layer&&this.$layer.setProps({stroked:t})},extruded(t){this.$layer&&this.$layer.setProps({extruded:t})},lineWidth(t){this.$layer&&this.$layer.setProps({getLineWidth:t})},lineWidthUnits(t){this.$layer&&this.$layer.setProps({lineWidthUnits:t})},lineWidthScale(t){this.$layer&&this.$layer.setProps({lineWidthScale:t})},lineWidthMinPixels(t){this.$layer&&this.$layer.setProps({lineWidthMinPixels:t})},lineWidthMaxPixels(t){this.$layer&&this.$layer.setProps({lineWidthMaxPixels:t})},fillColor(t){this.setColorProps("getFillColor",t)},lineColor(t){this.setColorProps("getLineColor",t)},position(t){this.$layer&&this.$layer.setProps({getPosition:t})},elevation(t){this.$layer&&this.$layer.setProps({getElevation:t})}},methods:{createLayer(t){return new he(Object.assign({},t,{type:mt,radius:this.radius,filled:this.filled,stroked:this.stroked,extruded:this.extruded,lineWidthUnits:this.lineWidthUnits,lineWidthScale:this.lineWidthScale,lineWidthMinPixels:this.lineWidthMinPixels,lineWidthMaxPixels:this.lineWidthMaxPixels,getPosition:this.position,getFillColor:this.parseColorVal(this.fillColor),getLineColor:this.parseColorVal(this.lineColor),getElevation:this.elevation,getLineWidth:this.lineWidth}))}},__file:"src/column-layer/column-layer.vue",install:function(t){t.component(zn.name,zn)}},jn={name:"XGridCellLayer",mixins:[de],props:{cellSize:{type:Number,default:1e3},filled:{type:Boolean,default:!0},stroked:{type:Boolean,default:!1},extruded:{type:Boolean,default:!0},lineWidthUnits:{type:String,default:"meters"},lineWidthScale:{type:Number,default:1},lineWidthMinPixels:{type:Number,default:0},lineWidthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},position:{type:Function,required:!0},elevation:{type:[Number,Function],default:1e3},fillColor:{type:[String,Function],default:"black"},lineColor:{type:[String,Function],default:"black"},lineWidth:{type:[Number,Function],default:1}},watch:{cellSize(t){this.$layer&&this.$layer.setProps({cellSize:t})},filled(t){this.$layer&&this.$layer.setProps({filled:t})},stroked(t){this.$layer&&this.$layer.setProps({stroked:t})},extruded(t){this.$layer&&this.$layer.setProps({extruded:t})},lineWidth(t){this.$layer&&this.$layer.setProps({getLineWidth:t})},lineWidthUnits(t){this.$layer&&this.$layer.setProps({lineWidthUnits:t})},lineWidthScale(t){this.$layer&&this.$layer.setProps({lineWidthScale:t})},lineWidthMinPixels(t){this.$layer&&this.$layer.setProps({lineWidthMinPixels:t})},lineWidthMaxPixels(t){this.$layer&&this.$layer.setProps({lineWidthMaxPixels:t})},fillColor(t){this.setColorProps("getFillColor",t)},lineColor(t){this.setColorProps("getLineColor",t)},position(t){this.$layer&&this.$layer.setProps({getPosition:t})},elevation(t){this.$layer&&this.$layer.setProps({getElevation:t})}},methods:{createLayer(t){return new he(Object.assign({},t,{type:jt,cellSize:this.cellSize,filled:this.filled,stroked:this.stroked,extruded:this.extruded,lineWidthUnits:this.lineWidthUnits,lineWidthScale:this.lineWidthScale,lineWidthMinPixels:this.lineWidthMinPixels,lineWidthMaxPixels:this.lineWidthMaxPixels,getPosition:this.position,getFillColor:this.parseColorVal(this.fillColor),getLineColor:this.parseColorVal(this.lineColor),getElevation:this.elevation,getLineWidth:this.lineWidth}))}},__file:"src/grid-cell-layer/grid-cell-layer.vue",install:function(t){t.component(jn.name,jn)}},Kn={name:"XGridLayer",mixins:[de],props:{cellSize:{type:Number,default:1e3},coverage:{type:Number,default:1},colorRange:{type:Array,default:()=>["rgb(255, 255, 178)","rgb(254, 217, 118)","rgb(254, 178, 76)","rgb(253, 141, 60)","rgb(240, 59, 32)","rgb(189, 0, 38)"]},extruded:{type:Boolean,default:!0},position:{type:Function,required:!0},colorValue:{type:Function},colorWeight:{type:Function,default:t=>1},colorAggregation:{type:String,default:"SUM"},elevationValue:{type:Function},elevationWeight:{type:Function,default:t=>1},elevationAggregation:{type:String,default:"SUM"},material:{type:Boolean,default:!0},elevationScale:{type:Number,default:1}},watch:{cellSize(t){this.$layer&&this.$layer.setProps({cellSize:t})},coverage(t){this.$layer&&this.$layer.setProps({coverage:t})},colorRange(t){const e=colorRange.map(n=>this.parseColorVal(n));this.$layer&&this.$layer.setProps({colorRange:e})},extruded(t){this.$layer&&this.$layer.setProps({extruded:t})},position(t){this.$layer&&this.$layer.setProps({getPosition:t})},colorValue(t){this.$layer&&this.$layer.setProps({getColorValue:t})},colorWeight(t){this.$layer&&this.$layer.setProps({getColorWeight:t})},colorAggregation(t){this.$layer&&this.$layer.setProps({colorAggregation:t})},elevationValue(t){this.$layer&&this.$layer.setProps({getElevationValue:t})},elevationWeight(t){this.$layer&&this.$layer.setProps({getElevationWeight:t})},elevationAggregation(t){this.$layer&&this.$layer.setProps({elevationAggregation:t})},material(t){this.$layer,this.$layer.setProps({material:t})},elevationScale(t){this.$layer,this.$layer.setProps({elevationScale:t})}},methods:{createLayer(t){const e=this.colorValue?{getColorValue:this.colorValue}:{getColorWeight:this.colorWeight,colorAggregation:this.colorAggregation},n=this.elevationValue?{getElevationValue:this.elevationValue}:{getElevationWeight:this.elevationWeight,elevationAggregation:this.elevationAggregation};return new he(Object.assign({},t,{type:us,cellSize:this.cellSize,coverage:this.coverage,colorRange:this.colorRange.map(s=>this.parseColorVal(s)),extruded:this.extruded,elevationScale:this.elevationScale,material:this.material,getPosition:this.position,...e,...n}))}},__file:"src/grid-layer/grid-layer.vue",install:function(t){t.component(Kn.name,Kn)}},Xn={name:"x-line-layer",mixins:[de],props:{widthUnits:{type:String,default:"pixels"},widthScale:{type:Number,default:1},widthMinPixels:{type:Number,default:0},widthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},sourcePosition:{type:[Array,Function],required:!0},targetPosition:{type:[Array,Function],required:!0},color:{type:[String,Function],default:"black"},width:{type:[Number,Function],default:1}},watch:{width(t){this.$layer&&this.$layer.setProps({getWidth:t})},widthUnits(t){this.$layer&&this.$layer.setProps({widthUnits:t})},widthMinPixels(t){this.$layer&&this.$layer.setProps({widthMinPixels:t})},widthMaxPixels(t){this.$layer&&this.$layer.setProps({widthMaxPixels:t})},color(t){this.setColorProp("getColor",t)},sourcePosition(t){this.$layer&&this.$layer.setProps({getSourcePosition:t})},targetPosition(t){this.$layer&&this.$layer.setProps({getTargetPosition:t})}},methods:{createLayer(t){return new he(Object.assign({},t,{type:as,widthMinPixels:this.widthMinPixels,widthMaxPixels:this.widthMaxPixels,widthUnits:this.widthUnits,getWidth:this.width,getColor:this.parseColorVal(this.color),getSourcePosition:this.sourcePosition,getTargetPosition:this.targetPosition}))}},__file:"src/line-layer/line-layer.vue",install:function(t){t.component(Xn.name,Xn)}},it={name:"x-hexagon-layer",mixins:[de],props:{radius:{type:Number,default:1e3},colorRange:{type:Array,default:()=>["rgb(255, 255, 178)","rgb(254, 217, 118)","rgb(254, 178, 76)","rgb(253, 141, 60)","rgb(240, 59, 32)","rgb(189, 0, 38)"]},extruded:{type:Boolean,default:!0},position:{type:Function,required:!0},coverage:{type:Number,default:1},colorValue:{type:Function},colorWeight:{type:Function,default:t=>1},colorAggregation:{type:String,default:"SUM"},elevationValue:{type:Function},elevationWeight:{type:Function,default:t=>1},elevationAggregation:{type:String,default:"SUM"},material:{type:Boolean,default:!0},elevationScale:{type:Number,default:1}},watch:{radius(t){this.$layer&&this.$layer.setProps({radius:t})},coverage(t){this.$layer&&this.$layer.setProps({coverage:t})},colorRange(t){const e=colorRange.map(n=>this.parseColorVal(n));this.$layer&&this.$layer.setProps({colorRange:e})},extruded(t){this.$layer&&this.$layer.setProps({extruded:t})},position(t){this.$layer&&this.$layer.setProps({getPosition:t})},colorValue(t){this.$layer&&this.$layer.setProps({getColorValue:t})},colorWeight(t){this.$layer&&this.$layer.setProps({getColorWeight:t})},colorAggregation(t){this.$layer&&this.$layer.setProps({colorAggregation:t})},elevationValue(t){this.$layer&&this.$layer.setProps({getElevationValue:t})},elevationWeight(t){this.$layer&&this.$layer.setProps({getElevationWeight:t})},elevationAggregation(t){this.$layer&&this.$layer.setProps({elevationAggregation:t})},material(t){this.$layer,this.$layer.setProps({material:t})},elevationScale(t){this.$layer,this.$layer.setProps({elevationScale:t})}},methods:{createLayer(t){const e=this.colorValue?{getColorValue:this.colorValue}:{getColorWeight:this.colorWeight,colorAggregation:this.colorAggregation},n=this.elevationValue?{getElevationValue:this.elevationValue}:{getElevationWeight:this.elevationWeight,elevationAggregation:this.elevationAggregation};return new he(Object.assign({},t,{type:hs,radius:this.radius,coverage:this.coverage,colorRange:this.colorRange.map(s=>this.parseColorVal(s)),extruded:this.extruded,elevationScale:this.elevationScale,material:this.material,getPosition:this.position,...e,...n}))}}};function or(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function Xm(t){var e,n;let s;return or(t,"null loader"),or(function(i){var r;return!!i&&(Array.isArray(i)&&(i=i[0]),Array.isArray((r=i)===null||r===void 0?void 0:r.extensions))}(t),"invalid loader"),Array.isArray(t)&&(s=t[1],t=t[0],t={...t,options:{...t.options,...s}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}it.__file="src/hexagon-layer/hexagon-layer.vue",it.install=function(t){t.component(it.name,it)};const km=()=>{const t=function(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};(function(t){const e=km();t=Array.isArray(t)?t:[t];for(const n of t){const s=Xm(n);e.find(i=>s===i)||e.unshift(s)}})(Ke);var kn={name:"x-gltf-layer",mixins:[de],props:{gltfUrl:{type:String,required:!0},sizeScale:{type:Number,default:1},_animations:{type:Object},getPosition:{type:Function,default:t=>t.position},getOrientation:{type:[Function,Array],default:()=>[0,0,90]},getScale:{type:[Function,Array],default:()=>[1,1,1]},getTranslation:{type:[Function,Array],default:()=>[0,0,0]},sizeMinPixels:{type:Number,default:0}},watch:{gltfUrl(t){this.$layer&&this.$layer.setProps({scenegraph:t})},sizeScale(t){this.$layer&&this.$layer.setProps({sizeScale:t})},getPosition(t){this.$layer&&this.$layer.setProps({getPosition:t})},getOrientation(t){this.$layer&&this.$layer.setProps({getOrientation:t})},getScale(t){this.$layer&&this.$layer.setProps({getScale:t})},getTranslation(t){this.$layer&&this.$layer.setProps({getTranslation:t})},sizeMinPixels(t){this.$layer&&this.$layer.setProps({sizeMinPixels:t})}},methods:{createLayer(t){return new he(Object.assign({},t,{type:Xt,scenegraph:this.gltfUrl,sizeScale:this.sizeScale,getPosition:this.getPosition,getOrientation:this.getOrientation,getScale:this.getScale,getTranslation:this.getTranslation,sizeMinPixels:this.sizeMinPixels,_lighting:"pbr",_animations:{"*":{speed:5}}}))}},__file:"src/model-layer/model-layer.vue",install:function(t){t.component(kn.name,kn)}},Wn={name:"XPathLayer",mixins:[Vn],__file:"src/path-layer/path-layer.vue",install:function(t){t.component(Wn.name,Wn)}},Qn={name:"x-tile-3d-layer",mixins:[de],emits:["loaded"],props:{data:{type:String,required:!0},pointSize:{type:Number,default:1}},watch:{pointSize(t){this.$layer&&this.$layer.setProps({pointSize:t})}},methods:{createLayer(t){return new he(Object.assign({},t,{type:Is,pointSize:this.pointSize,onTilesetLoad:e=>{this.$emit("loaded",e)}}))}},__file:"src/tile-3d-layer/tile-3d-layer.vue",install:function(t){t.component(Qn.name,Qn)}},qn={name:"XTripsLayer",mixins:[de],props:{currentTime:{type:Number,default:0},trailLength:{type:Number,default:120},getPath:{type:Function},getTimestamps:{type:Function},...Vn.props},watch:{currentTime(t){this.$layer&&this.$layer.setProps({currentTime:t})},trailLength(t){this.$layer&&this.$layer.setProps({trailLength:t})},getPath(t){this.$layer&&this.$layer.setProps({getPath:t})},getTimestamps(t){this.$layer&&this.$layer.setProps({getTimestamps:t})},...Vn.watch},methods:{createLayer(t){return new he(Object.assign({},t,{type:Bs,currentTime:this.currentTime,trailLength:this.trailLength,getPath:this.getPath,getTimestamps:this.getTimestamps,widthUnits:this.widthUnits,widthScale:this.widthScale,widthMinPixels:this.widthMinPixels,widthMaxPixels:this.widthMaxPixels,rounded:this.rounded,miterLimit:this.miterLimit,getPath:this.getPath,getWidth:this.getWidth,getColor:this.parseColorVal(this.getColor)}))}},__file:"src/trips-layer/trips-layer.vue",install:function(t){t.component(qn.name,qn)}};const Wm=[Jn,zn,jn,Kn,it,kn,Xn,Wn,Qn,qn];var Zm={version:"2.1.0",install:function(t){Wm.forEach(e=>{t.component(e.name,e)})}};export{Jn as XArcLayer,zn as XColumnLayer,jn as XGridCellLayer,Kn as XGridLayer,it as XHexagonLayer,Xn as XLineLayer,kn as XModelLayer,Wn as XPathLayer,Qn as XTile3dLayer,qn as XTripsLayer,Zm as default};

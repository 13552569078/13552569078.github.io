var Gn=function(n,r){var o={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},i={on:function(s,c,h){if(o[s]===void 0)throw new Error("Invalid event type: "+s);o[s].push({selector:c,fn:h})},render:function(s){r.store.featureChanged(s)}},a=function(s,c){for(var h=o[s],u=h.length;u--;){var f=h[u];if(f.selector(c)){f.fn.call(i,c)||r.store.render(),r.ui.updateMapClasses();break}}};return n.start.call(i),{render:n.render,stop:function(){n.stop&&n.stop()},trash:function(){n.trash&&(n.trash(),r.store.render())},combineFeatures:function(){n.combineFeatures&&n.combineFeatures()},uncombineFeatures:function(){n.uncombineFeatures&&n.uncombineFeatures()},drag:function(s){a("drag",s)},click:function(s){a("click",s)},mousemove:function(s){a("mousemove",s)},mousedown:function(s){a("mousedown",s)},mouseup:function(s){a("mouseup",s)},mouseout:function(s){a("mouseout",s)},keydown:function(s){a("keydown",s)},keyup:function(s){a("keyup",s)},touchstart:function(s){a("touchstart",s)},touchmove:function(s){a("touchmove",s)},touchend:function(s){a("touchend",s)},tap:function(s){a("tap",s)}}},Wn=6378137;function qn(n){var r=0;if(n&&n.length>0){r+=Math.abs(fn(n[0]));for(var o=1;o<n.length;o++)r-=Math.abs(fn(n[o]))}return r}function fn(n){var r,o,i,a,s,c,h=0,u=n.length;if(u>2){for(c=0;c<u;c++)c===u-2?(i=u-2,a=u-1,s=0):c===u-1?(i=u-1,a=0,s=1):(i=c,a=c+1,s=c+2),r=n[i],o=n[a],h+=(an(n[s][0])-an(r[0]))*Math.sin(an(o[1]));h=h*Wn*Wn/2}return h}function an(n){return n*Math.PI/180}var Br={geometry:function n(r){var o,i=0;switch(r.type){case"Polygon":return qn(r.coordinates);case"MultiPolygon":for(o=0;o<r.coordinates.length;o++)i+=qn(r.coordinates[o]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(o=0;o<r.geometries.length;o++)i+=n(r.geometries[o]);return i}},ring:fn},Jr="mapboxgl-ctrl",zr="mapbox-gl-draw_ctrl-draw-btn",Gr="mapbox-gl-draw_line",Wr="mapbox-gl-draw_polygon",qr="mapbox-gl-draw_point",Zr="mapbox-gl-draw_trash",Kr="mapbox-gl-draw_combine",Yr="mapbox-gl-draw_uncombine",Xr="mapboxgl-ctrl-group",Zn="active",Hr="mapbox-gl-draw_boxselect",lt="mapbox-gl-draw-hot",Mt="mapbox-gl-draw-cold",pe="add",Ze="move",Qr="drag",Xt="pointer",Ct="none",ht="polygon",Zt="line_string",Ye="point",z="Feature",Ie="Polygon",Re="LineString",H="Point",Ue="FeatureCollection",Kn="Multi",eo="MultiPoint",to="MultiLineString",no="MultiPolygon",L={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Et="draw.create",ro="draw.delete",pr="draw.update",oo="draw.selectionchange",io="draw.modechange",ao="draw.actionable",so="draw.render",co="draw.combine",uo="draw.uncombine",lo="move",ho="change_coordinates",Be="feature",Sn="midpoint",It="vertex",ye="true",_e="false",po=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Yn={Point:0,LineString:1,Polygon:2};function fo(n,r){var o=Yn[n.geometry.type]-Yn[r.geometry.type];return o===0&&n.geometry.type===Ie?n.area-r.area:o}function fe(n){if(this._items={},this._nums={},this._length=n?n.length:0,n)for(var r=0,o=n.length;r<o;r++)this.add(n[r]),n[r]!==void 0&&(typeof n[r]=="string"?this._items[n[r]]=r:this._nums[n[r]]=r)}fe.prototype.add=function(n){return this.has(n)||(this._length++,typeof n=="string"?this._items[n]=this._length:this._nums[n]=this._length),this},fe.prototype.delete=function(n){return this.has(n)===!1||(this._length--,delete this._items[n],delete this._nums[n]),this},fe.prototype.has=function(n){return(typeof n=="string"||typeof n=="number")&&(this._items[n]!==void 0||this._nums[n]!==void 0)},fe.prototype.values=function(){var n=this,r=[];return Object.keys(this._items).forEach(function(o){r.push({k:o,v:n._items[o]})}),Object.keys(this._nums).forEach(function(o){r.push({k:JSON.parse(o),v:n._nums[o]})}),r.sort(function(o,i){return o.v-i.v}).map(function(o){return o.k})},fe.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var yo=[Be,Sn,It],wt={click:function(n,r,o){return Xn(n,r,o,o.options.clickBuffer)},touch:function(n,r,o){return Xn(n,r,o,o.options.touchBuffer)}};function Xn(n,r,o,i){if(o.map===null)return[];var a=n?function(f,l){return l===void 0&&(l=0),[[f.point.x-l,f.point.y-l],[f.point.x+l,f.point.y+l]]}(n,i):r,s={};o.options.styles&&(s.layers=o.options.styles.map(function(f){return f.id}));var c=o.map.queryRenderedFeatures(a,s).filter(function(f){return yo.indexOf(f.properties.meta)!==-1}),h=new fe,u=[];return c.forEach(function(f){var l=f.properties.id;h.has(l)||(h.add(l),u.push(f))}),function(f){return f.map(function(l){return l.geometry.type===Ie&&(l.area=Br.geometry({type:z,property:{},geometry:l.geometry})),l}).sort(fo).map(function(l){return delete l.area,l})}(u)}function sn(n,r){var o=wt.click(n,null,r),i={mouse:Ct};return o[0]&&(i.mouse=o[0].properties.active===ye?Ze:Xt,i.feature=o[0].properties.meta),r.events.currentModeName().indexOf("draw")!==-1&&(i.mouse=pe),r.ui.queueMapClasses(i),r.ui.updateMapClasses(),o[0]}function dr(n,r){var o=n.x-r.x,i=n.y-r.y;return Math.sqrt(o*o+i*i)}function Hn(n,r,o){o===void 0&&(o={});var i=o.fineTolerance!=null?o.fineTolerance:4,a=o.grossTolerance!=null?o.grossTolerance:12,s=o.interval!=null?o.interval:500;n.point=n.point||r.point,n.time=n.time||r.time;var c=dr(n.point,r.point);return c<i||c<a&&r.time-n.time<s}function Qn(n,r,o){o===void 0&&(o={});var i=o.tolerance!=null?o.tolerance:25,a=o.interval!=null?o.interval:250;return n.point=n.point||r.point,n.time=n.time||r.time,dr(n.point,r.point)<i&&r.time-n.time<a}function go(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function Ht(n,r){return n(r={exports:{}},r.exports),r.exports}var Mn=Ht(function(n){var r=n.exports=function(o,i){if(i||(i=16),o===void 0&&(o=128),o<=0)return"0";for(var a=Math.log(Math.pow(2,o))/Math.log(i),s=2;a===1/0;s*=2)a=Math.log(Math.pow(2,o/s))/Math.log(i)*s;var c=a-Math.floor(a),h="";for(s=0;s<Math.floor(a);s++)h=Math.floor(Math.random()*i).toString(i)+h;if(c){var u=Math.pow(i,c);h=Math.floor(Math.random()*u).toString(i)+h}var f=parseInt(h,i);return f!==1/0&&f>=Math.pow(2,o)?r(o,i):h};r.rack=function(o,i,a){var s=function(h){var u=0;do{if(u++>10){if(!a)throw new Error("too many ID collisions, use more bits");o+=a}var f=r(o,i)}while(Object.hasOwnProperty.call(c,f));return c[f]=h,f},c=s.hats={};return s.get=function(h){return s.hats[h]},s.set=function(h,u){return s.hats[h]=u,s},s.bits=o||128,s.base=i||16,s}}),fr={centimeters:637100880,centimetres:637100880,degrees:63710088e-1/111325,feet:20902260511392e-6,inches:63710088e-1*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:63710088e-1,metres:63710088e-1,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:63710088e-1/1852,radians:1,yards:63710088e-1*1.0936};function yr(n,r,o){o===void 0&&(o={});var i={type:"Feature"};return(o.id===0||o.id)&&(i.id=o.id),o.bbox&&(i.bbox=o.bbox),i.properties=r||{},i.geometry=n,i}function yn(n,r,o){if(o===void 0&&(o={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tr(n[0])||!tr(n[1]))throw new Error("coordinates must contain numbers");return yr({type:"Point",coordinates:n},r,o)}function er(n){return 180*(n%(2*Math.PI))/Math.PI}function Ke(n){return n%360*Math.PI/180}function tr(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function gn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function mo(n,r,o,i){i===void 0&&(i={});var a=gn(n),s=Ke(a[0]),c=Ke(a[1]),h=Ke(o),u=function(l,y){y===void 0&&(y="kilometers");var m=fr[y];if(!m)throw new Error(y+" units is invalid");return l/m}(r,i.units),f=Math.asin(Math.sin(c)*Math.cos(u)+Math.cos(c)*Math.sin(u)*Math.cos(h));return yn([er(s+Math.atan2(Math.sin(h)*Math.sin(u)*Math.cos(c),Math.cos(u)-Math.sin(c)*Math.sin(f))),er(f)],i.properties)}function vo(n,r,o){o===void 0&&(o={});for(var i=o.steps||64,a=o.properties?o.properties:!Array.isArray(n)&&n.type==="Feature"&&n.properties?n.properties:{},s=[],c=0;c<i;c++)s.push(mo(n,r,-360*c/i,o).geometry.coordinates);return s.push(s[0]),function(h,u,f){f===void 0&&(f={});for(var l=0,y=h;l<y.length;l++){var m=y[l];if(m.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var _=0;_<m[m.length-1].length;_++)if(m[m.length-1][_]!==m[0][_])throw new Error("First and last Position are not equivalent.")}return yr({type:"Polygon",coordinates:h},u,f)}([s],a)}function _o(n,r,o){o===void 0&&(o={});var i=gn(n),a=gn(r),s=Ke(a[1]-i[1]),c=Ke(a[0]-i[0]),h=Ke(i[1]),u=Ke(a[1]),f=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(h)*Math.cos(u);return function(l,y){y===void 0&&(y="kilometers");var m=fr[y];if(!m)throw new Error(y+" units is invalid");return l*m}(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),o.units)}var wn=2*Math.PI,te=function(n){var r=n[0],o=n[1],i=2003750834e-2*r/180,a=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return[i,a=2003750834e-2*a/180]},Kt=function(n){var r=n[0],o=n[1]/2003750834e-2*180;return[r/2003750834e-2*180,o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2)]},Z=function(n,r){return Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2))},Cn=function(n){for(var r=0,o=0;o<n.length-1;o++)r+=Z(n[o],n[o+1]);return r},Pe=function(n){return Math.pow(Cn(n),.99)},De=function(n,r){return[(n[0]+r[0])/2,(n[1]+r[1])/2]},nr=function(n,r,o){var i=[(n[0]+r[0])/2,(n[1]+r[1])/2],a=[i[0]-n[1]+r[1],i[1]+n[0]-r[0]],s=[(n[0]+o[0])/2,(n[1]+o[1])/2],c=[s[0]-n[1]+o[1],s[1]+n[0]-o[0]];return bo(i,a,s,c)},bo=function(n,r,o,i){var a,s,c;return n[1]==r[1]?[(s=(i[0]-o[0])/(i[1]-o[1]))*(n[1]-o[1])+o[0],c=n[1]]:o[1]==i[1]?[(a=(r[0]-n[0])/(r[1]-n[1]))*(o[1]-n[1])+n[0],c=o[1]]:(a=(r[0]-n[0])/(r[1]-n[1]),s=(i[0]-o[0])/(i[1]-o[1]),[a*(c=(a*n[1]-n[0]-s*o[1]+o[0])/(a-s))-a*n[1]+n[0],c])},Ce=function(n,r){var o,i=Math.asin(Math.abs(r[1]-n[1])/Z(n,r));return r[1]>=n[1]&&r[0]>=n[0]?o=i+Math.PI:r[1]>=n[1]&&r[0]<n[0]?o=wn-i:r[1]<n[1]&&r[0]<n[0]?o=i:r[1]<n[1]&&r[0]>=n[0]&&(o=Math.PI-i),o},En=function(n,r,o){var i=Ce(r,n)-Ce(r,o);return i<0?i+wn:i},at=function(n,r,o){return(o[1]-n[1])*(r[0]-n[0])>(r[1]-n[1])*(o[0]-n[0])},rr=function(n,r,o,i,a){var s=1-(n=Math.max(Math.min(n,1),0)),c=n*n,h=c*n,u=s*s,f=u*s;return[f*r[0]+3*u*n*o[0]+3*s*c*i[0]+h*a[0],f*r[1]+3*u*n*o[1]+3*s*c*i[1]+h*a[1]]},A=function(n,r,o,i,a){var s=Ce(n,r),c=a?s+o:s-o,h=i*Math.cos(c),u=i*Math.sin(c);return[r[0]+h,r[1]+u]},cn=function(n,r,o,i){var a,s,c=[],h=i-o;h=h<0?h+wn:h;for(var u=0;u<=100;u++){var f=o+h*u/100;a=n[0]+r*Math.cos(f),s=n[1]+r*Math.sin(f),c.push([Kt([a,s])[0],Kt([a,s])[1]])}return c},Yt=function(n,r,o,i){var a,s,c,h=In(r,o,i),u=Math.sqrt(h[0]*h[0]+h[1]*h[1]),f=h[0]/u,l=h[1]/u,y=Z(r,o),m=Z(o,i);return u>1e-4?at(r,o,i)?(c=n*y,s=[o[0]-c*l,o[1]+c*f],c=n*m,a=[o[0]+c*l,o[1]-c*f]):(c=n*y,s=[o[0]+c*l,o[1]-c*f],c=n*m,a=[o[0]-c*l,o[1]+c*f]):(s=[o[0]+n*(r[0]-o[0]),o[1]+n*(r[1]-o[1])],a=[o[0]+n*(i[0]-o[0]),o[1]+n*(i[1]-o[1])]),[s,a]},In=function(n,r,o){var i=n[0]-r[0],a=n[1]-r[1],s=Math.sqrt(i*i+a*a);i/=s,a/=s;var c=o[0]-r[0],h=o[1]-r[1],u=Math.sqrt(c*c+h*h);return[i+(c/=u),a+(h/=u)]},xo=function(n){var r,o,i=n[0],a=n[1],s=n[2],c=Yt(0,i,a,s)[0],h=In(i,a,s);if(Math.sqrt(h[0]*h[0]+h[1]*h[1])>1e-4){var u=De(i,a),f=i[0]-u[0],l=i[1]-u[1],y=2/Z(i,a),m=-y*l,_=y*f,d=m*m-_*_,x=2*m*_,I=_*_-m*m,b=c[0]-u[0],M=c[1]-u[1];r=u[0]+d*b+x*M,o=u[1]+x*b+I*M}else r=i[0]+.3*(a[0]-i[0]),o=i[1]+.3*(a[1]-i[1]);return[r,o]},So=function(n){var r,o,i=n.length,a=n[i-3],s=n[i-2],c=n[i-1],h=Yt(0,a,s,c)[1],u=In(a,s,c);if(Math.sqrt(u[0]*u[0]+u[1]*u[1])>1e-4){var f=De(s,c),l=c[0]-f[0],y=c[1]-f[1],m=2/Z(s,c),_=-m*y,d=m*l,x=_*_-d*d,I=2*_*d,b=d*d-_*_,M=h[0]-f[0],w=h[1]-f[1];r=f[0]+x*M+I*w,o=f[1]+I*M+b*w}else r=c[0]+.3*(s[0]-c[0]),o=c[1]+.3*(s[1]-c[1]);return[r,o]},un=function(n){if(n.length<=2)return n;for(var r=[],o=n.length-1,i=0;i<=1;i+=.01){for(var a=0,s=0,c=0;c<=o;c++){var h=Mo(o,c),u=Math.pow(i,c),f=Math.pow(1-i,o-c);a+=h*u*f*n[c][0],s+=h*u*f*n[c][1]}r.push([a,s])}return r.push(n[o]),r},Mo=function(n,r){return ln(n)/(ln(r)*ln(n-r))},ln=function(n){if(n<=1)return 1;if(n==2)return 2;if(n==3)return 6;if(n==4)return 24;if(n==5)return 120;for(var r=1,o=1;o<=n;o++)r*=o;return r},it=function(n){if(n.length<=2)return n;var r=[],o=n.length-2-1;r.push(n[0]);for(var i=0;i<=o;i++)for(var a=0;a<=1;a+=.05){for(var s=0,c=0,h=0;h<=2;h++){var u=wo(h,a);s+=u*n[i+h][0],c+=u*n[i+h][1]}r.push([s,c])}return r.push(n[n.length-1]),r},wo=function(n,r){return n==0?Math.pow(r-1,2)/2:n==1?(-2*Math.pow(r,2)+2*r+1)/2:n==2?Math.pow(r,2)/2:0};function Co(n,r,o){for(var i,a,s,c=[],h=0;h<=100;h++)s=2*Math.PI*h/100,i=n[0]+r*Math.cos(s),a=n[1]+o*Math.sin(s),c.push([Kt([i,a])[0],Kt([i,a])[1]]);return c}var or=Math.PI/2,Eo={tailWidthFactor:.15,neckWidthFactor:.2,headWidthFactor:.25,headAngle:Math.PI/8.5,neckAngle:Math.PI/13},ir=function(n,r){if(n.length<2)return[];var o=n[0],i=n[1],a=Pe(n),s=r.neckWidthFactor,c=r.tailWidthFactor,h=r.headWidthFactor,u=r.headAngle,f=r.neckAngle,l=a*c,y=a*s,m=a*h,_=A(i,o,or,l,!0),d=A(i,o,or,l,!1),x=A(o,i,u,m,!1),I=A(o,i,u,m,!0);return[[_,A(o,i,f,y,!1),x,i,I,A(o,i,f,y,!0),d]]},Io={tailWidthFactor:.2,neckWidthFactor:.25,headWidthFactor:.3,headAngle:Math.PI/4,neckAngle:.17741*Math.PI},Po=.18,ko=.3,Fo=.85,Lo=.15,Jt=Math.PI/2,hn=function(n){var r=Pe(n)*Po,o=n[n.length-1],i=r*ko,a=r*Lo,s=r*Fo,c=A(n[n.length-2],o,0,r,!0),h=A(n[n.length-2],o,0,s,!0),u=A(o,c,Jt,i,!1),f=A(o,c,Jt,i,!0);return[A(o,h,Jt,a,!1),u,o,f,A(o,h,Jt,a,!0)]},pn=function(n,r,o,i){for(var a=Cn(n),s=Pe(n)*i,c=(s-Z(r,o))/2,h=0,u=[],f=[],l=1;l<n.length-1;l++){var y=En(n[l-1],n[l],n[l+1])/2,m=(s/2-(h+=Z(n[l-1],n[l]))/a*c)/Math.sin(y),_=A(n[l-1],n[l],Math.PI-y,m,!0),d=A(n[l-1],n[l],y,m,!1);u.push(_),f.push(d)}return u.concat(f)},Ao=.1,Oo=1,ar=Math.PI/2,sr=.1,gr=.25,mr=.3,To=.85,jo=.15,X=Math.PI/2,zt=function(n,r,o,i){var a=De(n,r),s=Z(a,o),c=A(o,a,0,.3*s,!0),h=A(o,a,0,.5*s,!0),u=[a,c=A(a,c,X,s/5,i),h=A(a,h,X,s/4,i),o],f=No(u,gr,mr),l=f[0],y=f[4],m=Z(n,r)/Pe(u)/2,_=Do(u,l,y,m),d=_.length,x=_.slice(0,d/2),I=_.slice(d/2,d);return x.push(l),I.push(y),(x=x.reverse()).push(r),(I=I.reverse()).push(n),x.reverse().concat(f,I)},No=function(n,r,o){var i=Pe(n)*gr,a=n[n.length-1],s=(Z(r,o),i*mr),c=i*jo,h=i*To,u=A(n[n.length-2],a,0,i,!0),f=A(n[n.length-2],a,0,h,!0),l=A(a,u,X,s,!1),y=A(a,u,X,s,!0);return[A(a,f,X,c,!1),l,a,y,A(a,f,X,c,!0)]},Do=function(n,r,o,i){for(var a=Cn(n),s=Pe(n)*i,c=(s-Z(r,o))/2,h=0,u=[],f=[],l=1;l<n.length-1;l++){var y=En(n[l-1],n[l],n[l+1])/2,m=(s/2-(h+=Z(n[l-1],n[l]))/a*c)/Math.sin(y),_=A(n[l-1],n[l],Math.PI-y,m,!0),d=A(n[l-1],n[l],y,m,!1);u.push(_),f.push(d)}return u.concat(f)},dt=Object.freeze({__proto__:null,circle_algorithm:function(n,r){if(n.length<2)return[];var o=n[0],i=n[1];return vo(o,r||_o(yn(o),yn(i)),{steps:128}).geometry.coordinates},ellipse_algorithm:function(n){if(n.length<2)return[];var r=te(n[0]),o=te(n[1]);return[Co(De(r,o),Math.abs((r[0]-o[0])/2),Math.abs((r[1]-o[1])/2))]},fine_arrow_algorithm:function(n){return ir(n,Eo)},assault_direction_algorithm:function(n){return ir(n,Io)},attack_arrow_algorithm:function(n){if(n.length<3)return[n];var r=n[0],o=n[1];at(n[0],n[1],n[2])&&(r=n[1],o=n[0]);var i=[De(r,o)].concat(n.slice(2)),a=hn(i),s=a[0],c=a[4],h=Z(r,o)/Pe(i),u=pn(i,s,c,h),f=u.length,l=[r].concat(u.slice(0,f/2));l.push(s);var y=[o].concat(u.slice(f/2,f));return y.push(c),l=it(l),y=it(y),[l.concat(a,y.reverse())]},tailed_attack_arrow_algorithm:function(n){if(n.length<3)return[n];var r=n[0],o=n[1];at(n[0],n[1],n[2])&&(r=n[1],o=n[0]);var i=[De(r,o)].concat(n.slice(2)),a=hn(i),s=a[0],c=a[4],h=Z(r,o),u=Pe(i),f=u*Ao*Oo,l=A(i[1],i[0],0,f,!0),y=pn(i,s,c,h/u),m=y.length,_=[r].concat(y.slice(0,m/2));_.push(s);var d=[o].concat(y.slice(m/2,m));return d.push(c),_=it(_),d=it(d),[_.concat(a,d.reverse(),[l])]},squad_combat_algorithm:function(n){if(n.length<2)return[];var r,o,i=(o=Pe(r=n)*sr,[A(r[1],r[0],ar,o,!1),A(r[1],r[0],ar,o,!0)]),a=hn(n),s=a[0],c=a[4],h=pn(n,s,c,sr),u=h.length,f=[i[0]].concat(h.slice(0,u/2));f.push(s);var l=[i[1]].concat(h.slice(u/2,u));return l.push(c),f=it(f),l=it(l),[f.concat(a,l.reverse())]},rectangle_algorithm:function(n){if(n.length<2)return[];var r=n[0],o=n[1],i=Math.min(r[0],o[0]),a=Math.max(r[0],o[0]),s=Math.min(r[1],o[1]),c=Math.max(r[1],o[1]),h=[i,c];return[[h,[a,c],[a,s],[i,s],h]]},double_arrow_algorithm:function(n){if(n.length<3)return[n];var r,o,i,a,s=n[0],c=n[1],h=n[2],u=n.length;r=u==3?function(M,w,k){var v,P,J,C,D=De(M,w),U=Z(D,k),V=En(M,D,k);return V<X?(P=U*Math.sin(V),J=U*Math.cos(V),C=A(M,D,X,P,!1),v=A(D,C,X,J,!0)):V>=X&&V<Math.PI?(P=U*Math.sin(Math.PI-V),J=U*Math.cos(Math.PI-V),C=A(M,D,X,P,!1),v=A(D,C,X,J,!1)):V>=Math.PI&&V<1.5*Math.PI?(P=U*Math.sin(V-Math.PI),J=U*Math.cos(V-Math.PI),C=A(M,D,X,P,!0),v=A(D,C,X,J,!0)):(P=U*Math.sin(2*Math.PI-V),J=U*Math.cos(2*Math.PI-V),C=A(M,D,X,P,!0),v=A(D,C,X,J,!1)),v}(s,c,h):n[3],o=u==3||u==4?De(s,c):dcoordinate[4],at(s,c,h)?(i=zt(s,o,r,!1),a=zt(o,c,h,!0)):(i=zt(c,o,h,!1),a=zt(o,s,r,!0));var f=i.length,l=(f-5)/2,y=i.slice(0,l),m=i.slice(l,l+5),_=i.slice(l+5,f),d=a.slice(0,l),x=a.slice(l,l+5),I=a.slice(l+5,f);d=un(d);var b=un(I.concat(y.slice(1)));return _=un(_),[d.concat(x,b,m,_)]},sector_algorithm:function(n){if(n.length<3)return[n];var r=n[0],o=n[1],i=n[2],a=Z(te(o),te(r)),s=Ce(te(o),te(r)),c=Ce(te(i),te(r)),h=cn(te(r),a,s,c);return h.push(r),[h]},lune_algorithm:function(n){if(n.length<3)return[n];var r,o,i=te(n[0]),a=te(n[1]),s=te(n[2]),c=nr(i,a,s),h=Z(i,c),u=Ce(i,c),f=Ce(a,c);return at(i,a,s)?(r=f,o=u):(r=u,o=f),[cn(c,h,r,o)]},closed_curve_algorithm:function(n){if(n.length<3)return[n];var r=n.slice();r.push(r[0],r[1]);for(var o=[],i=0;i<r.length-2;i++){var a=Yt(.3,r[i],r[i+1],r[i+2]);o=o.concat(a)}var s=o.length;o=[o[s-1]].concat(o.slice(0,s-1));for(var c=[],h=0;h<r.length-2;h++){var u=r[h],f=r[h+1];c.push(u);for(var l=0;l<=100;l++){var y=rr(l/100,u,o[2*h],o[2*h+1],f);c.push(y)}c.push(f)}return[c]},curve_algorithm:function(n){return n.length<3?n:function(r,o){for(var i,a,s,c=[xo(o)],h=0;h<o.length-2;h++){i=o[h],a=o[h+1],s=o[h+2];var u=Yt(r,i,a,s);c=c.concat(u)}var f=So(o);c.push(f);for(var l=[],y=0;y<o.length-1;y++){i=o[y],a=o[y+1],l.push(i);for(var m=0;m<100;m++){var _=rr(m/100,i,c[2*y],c[2*y+1],a);l.push(_)}l.push(a)}return l}(.3,n)},arc_algorithm:function(n){if(n.length<3)return n;var r,o,i=te(n[0]),a=te(n[1]),s=te(n[2]),c=nr(i,a,s),h=Z(i,c),u=Ce(i,c),f=Ce(a,c);return at(i,a,s)?(r=f,o=u):(r=u,o=f),cn(c,h,r,o)}}),re=function(n,r){this.ctx=n,this.properties=r.properties||{};var o=r.properties;o.isCustom&&o.coordinates&&o.coordinates.length>0?this.coordinates=dt[r.properties.type+"_algorithm"](r.properties.coordinates):this.coordinates=r.geometry.coordinates,this.id=r.id||Mn(),this.type=r.geometry.type};re.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},re.prototype.incomingCoords=function(n){this.setCoordinates(n)},re.prototype.setCoordinates=function(n){this.coordinates=n,this.changed()},re.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},re.prototype.setProperty=function(n,r){this.properties[n]=r},re.prototype.toGeoJSON=function(n){return JSON.parse(JSON.stringify({id:this.id,type:z,properties:this.properties,geometry:{coordinates:n?[]:this.getCoordinates(),type:this.type}}))},re.prototype.internal=function(n){var r={id:this.id,meta:Be,"meta:type":this.type,active:_e,mode:n};if(this.ctx.options.userProperties)for(var o in this.properties)r["user_"+o]=this.properties[o];return{type:z,properties:r,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Xe=function(n,r){var o,i,a,s=r.properties;s["image-id"]&&s["image-url"]&&(o=n.map,i=s["image-id"],a=s["image-url"],new Promise(function(c){o.hasImage(i)?c():o.loadImage(a,function(h,u){o.addImage(i,u),c()})})),re.call(this,n,r)};(Xe.prototype=Object.create(re.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Xe.prototype.updateCoordinate=function(n,r,o){this.coordinates=arguments.length===3?[r,o]:[n,r],this.changed()},Xe.prototype.getCoordinate=function(){return this.getCoordinates()};var Ee=function(n,r){re.call(this,n,r)};(Ee.prototype=Object.create(re.prototype)).isValid=function(){return this.coordinates.length>1},Ee.prototype.addCoordinate=function(n,r,o){this.changed();var i=parseInt(n,10);this.coordinates.splice(i,0,[r,o])},Ee.prototype.getCoordinate=function(n){var r=parseInt(n,10);return JSON.parse(JSON.stringify(this.coordinates[r]))},Ee.prototype.removeCoordinate=function(n){this.changed(),this.coordinates.splice(parseInt(n,10),1)},Ee.prototype.updateCoordinate=function(n,r,o){var i=parseInt(n,10);this.coordinates[i]=[r,o],this.changed()};var he=function(n,r){re.call(this,n,r),r.properties.isCustom||(this.coordinates=this.coordinates.map(function(o){return o.slice(0,-1)}))};(he.prototype=Object.create(re.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(n){return n.length>2})},he.prototype.incomingCoords=function(n){this.coordinates=n.map(function(r){return r.slice(0,-1)}),this.changed()},he.prototype.setCoordinates=function(n){this.coordinates=n,this.changed()},he.prototype.addCoordinate=function(n,r,o){this.changed();var i=n.split(".").map(function(a){return parseInt(a,10)});this.coordinates[i[0]].splice(i[1],0,[r,o])},he.prototype.removeCoordinate=function(n){this.changed();var r=n.split(".").map(function(i){return parseInt(i,10)}),o=this.coordinates[r[0]];o&&(o.splice(r[1],1),o.length<3&&this.coordinates.splice(r[0],1))},he.prototype.getCoordinate=function(n){var r=n.split(".").map(function(i){return parseInt(i,10)}),o=this.coordinates[r[0]];return JSON.parse(JSON.stringify(o[r[1]]))},he.prototype.getCoordinates=function(){return this.coordinates.map(function(n){return n.concat([n[0]])})},he.prototype.updateCoordinate=function(n,r,o){this.changed();var i=n.split("."),a=parseInt(i[0],10),s=parseInt(i[1],10);this.coordinates[a]===void 0&&(this.coordinates[a]=[]),this.coordinates[a][s]=[r,o]};var Uo={MultiPoint:Xe,MultiLineString:Ee,MultiPolygon:he},Gt=function(n,r,o,i,a){var s=o.split("."),c=parseInt(s[0],10),h=s[1]?s.slice(1).join("."):null;return n[c][r](h,i,a)},oe=function(n,r){if(re.call(this,n,r),delete this.coordinates,this.model=Uo[r.geometry.type],this.model===void 0)throw new TypeError(r.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(r.geometry.coordinates)};function F(n){this.map=n.map,this.drawConfig=JSON.parse(JSON.stringify(n.options||{})),this._ctx=n}(oe.prototype=Object.create(re.prototype))._coordinatesToFeatures=function(n){var r=this,o=this.model.bind(this);return n.map(function(i){return new o(r.ctx,{id:Mn(),type:z,properties:{},geometry:{coordinates:i,type:r.type.replace("Multi","")}})})},oe.prototype.isValid=function(){return this.features.every(function(n){return n.isValid()})},oe.prototype.setCoordinates=function(n){this.features=this._coordinatesToFeatures(n),this.changed()},oe.prototype.getCoordinate=function(n){return Gt(this.features,"getCoordinate",n)},oe.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(n){return n.type===Ie?n.getCoordinates():n.coordinates})))},oe.prototype.updateCoordinate=function(n,r,o){Gt(this.features,"updateCoordinate",n,r,o),this.changed()},oe.prototype.addCoordinate=function(n,r,o){Gt(this.features,"addCoordinate",n,r,o),this.changed()},oe.prototype.removeCoordinate=function(n){Gt(this.features,"removeCoordinate",n),this.changed()},oe.prototype.getFeatures=function(){return this.features},F.prototype.setSelected=function(n){return this._ctx.store.setSelected(n)},F.prototype.setSelectedCoordinates=function(n){var r=this;this._ctx.store.setSelectedCoordinates(n),n.reduce(function(o,i){return o[i.feature_id]===void 0&&(o[i.feature_id]=!0,r._ctx.store.get(i.feature_id).changed()),o},{})},F.prototype.getSelected=function(){return this._ctx.store.getSelected()},F.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},F.prototype.isSelected=function(n){return this._ctx.store.isSelected(n)},F.prototype.getFeature=function(n){return this._ctx.store.get(n)},F.prototype.select=function(n){return this._ctx.store.select(n)},F.prototype.deselect=function(n){return this._ctx.store.deselect(n)},F.prototype.deleteFeature=function(n,r){return r===void 0&&(r={}),this._ctx.store.delete(n,r)},F.prototype.addFeature=function(n){return this._ctx.store.add(n)},F.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},F.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},F.prototype.setActionableState=function(n){n===void 0&&(n={});var r={trash:n.trash||!1,combineFeatures:n.combineFeatures||!1,uncombineFeatures:n.uncombineFeatures||!1};return this._ctx.events.actionable(r)},F.prototype.changeMode=function(n,r,o){return r===void 0&&(r={}),o===void 0&&(o={}),this._ctx.events.changeMode(n,r,o)},F.prototype.updateUIClasses=function(n){return this._ctx.ui.queueMapClasses(n)},F.prototype.activateUIButton=function(n){return this._ctx.ui.setActiveButton(n)},F.prototype.featuresAt=function(n,r,o){if(o===void 0&&(o="click"),o!=="click"&&o!=="touch")throw new Error("invalid buffer type");return wt[o](n,r,this._ctx)},F.prototype.newFeature=function(n){var r=n.geometry.type;return r===H?new Xe(this._ctx,n):r===Re?new Ee(this._ctx,n):r===Ie?new he(this._ctx,n):new oe(this._ctx,n)},F.prototype.isInstanceOf=function(n,r){if(n===H)return r instanceof Xe;if(n===Re)return r instanceof Ee;if(n===Ie)return r instanceof he;if(n==="MultiFeature")return r instanceof oe;throw new Error("Unknown feature class: "+n)},F.prototype.doRender=function(n){return this._ctx.store.featureChanged(n)},F.prototype.onSetup=function(){},F.prototype.onDrag=function(){},F.prototype.onClick=function(){},F.prototype.onMouseMove=function(){},F.prototype.onMouseDown=function(){},F.prototype.onMouseUp=function(){},F.prototype.onMouseOut=function(){},F.prototype.onKeyUp=function(){},F.prototype.onKeyDown=function(){},F.prototype.onTouchStart=function(){},F.prototype.onTouchMove=function(){},F.prototype.onTouchEnd=function(){},F.prototype.onTap=function(){},F.prototype.onStop=function(){},F.prototype.onTrash=function(){},F.prototype.onCombineFeature=function(){},F.prototype.onUncombineFeature=function(){},F.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var vr={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},$o=Object.keys(vr);function Ro(n){var r=Object.keys(n);return function(o,i){i===void 0&&(i={});var a={},s=r.reduce(function(c,h){return c[h]=n[h],c},new F(o));return{start:function(){var c=this;a=s.onSetup(i),$o.forEach(function(h){var u,f=vr[h],l=function(){return!1};n[f]&&(l=function(){return!0}),c.on(h,l,(u=f,function(y){return s[u](a,y)}))})},stop:function(){s.onStop(a)},trash:function(){s.onTrash(a)},combineFeatures:function(){s.onCombineFeatures(a)},uncombineFeatures:function(){s.onUncombineFeatures(a)},render:function(c,h){s.toDisplayFeatures(a,c,h)}}}}function Wt(n){return[].concat(n).filter(function(r){return r!==void 0})}function Vo(){var n=this;if(!(n.ctx.map&&n.ctx.map.getSource(lt)!==void 0))return u();var r=n.ctx.events.currentModeName();n.ctx.ui.queueMapClasses({mode:r});var o=[],i=[];n.isDirty?i=n.getAllIds():(o=n.getChangedIds().filter(function(f){return n.get(f)!==void 0}),i=n.sources.hot.filter(function(f){return f.properties.id&&o.indexOf(f.properties.id)===-1&&n.get(f.properties.id)!==void 0}).map(function(f){return f.properties.id})),n.sources.hot=[];var a=n.sources.cold.length;n.sources.cold=n.isDirty?[]:n.sources.cold.filter(function(f){var l=f.properties.id||f.properties.parent;return o.indexOf(l)===-1});var s=a!==n.sources.cold.length||i.length>0;function c(f,l){var y=n.get(f).internal(r);n.ctx.events.currentModeRender(y,function(m){n.sources[l].push(m)})}if(o.forEach(function(f){return c(f,"hot")}),i.forEach(function(f){return c(f,"cold")}),s&&n.ctx.map.getSource(Mt).setData({type:Ue,features:n.sources.cold}),n.ctx.map.getSource(lt).setData({type:Ue,features:n.sources.hot}),n._emitSelectionChange&&(n.ctx.map.fire(oo,{features:n.getSelected().map(function(f){return f.toGeoJSON()}),points:n.getSelectedCoordinates().map(function(f){return{type:z,properties:{},geometry:{type:H,coordinates:f.coordinates}}})}),n._emitSelectionChange=!1),n._deletedFeaturesToEmit.length){var h=n._deletedFeaturesToEmit.map(function(f){return f.toGeoJSON()});n._deletedFeaturesToEmit=[],n.ctx.map.fire(ro,{features:h})}function u(){n.isDirty=!1,n.clearChangedIds()}u(),n.ctx.map.fire(so,{})}function R(n){var r,o=this;this._features={},this._featureIds=new fe,this._selectedFeatureIds=new fe,this._selectedCoordinates=[],this._changedFeatureIds=new fe,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=n,this.sources={hot:[],cold:[]},this.render=function(){r||(r=requestAnimationFrame(function(){r=null,Vo.call(o)}))},this.isDirty=!1}function cr(n,r){var o=n._selectedCoordinates.filter(function(i){return n._selectedFeatureIds.has(i.feature_id)});n._selectedCoordinates.length===o.length||r.silent||(n._emitSelectionChange=!0),n._selectedCoordinates=o}R.prototype.createRenderBatch=function(){var n=this,r=this.render,o=0;return this.render=function(){o++},function(){n.render=r,o>0&&n.render()}},R.prototype.setDirty=function(){return this.isDirty=!0,this},R.prototype.featureChanged=function(n){return this._changedFeatureIds.add(n),this},R.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},R.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},R.prototype.getAllIds=function(){return this._featureIds.values()},R.prototype.add=function(n){return this.featureChanged(n.id),this._features[n.id]=n,this._featureIds.add(n.id),this},R.prototype.delete=function(n,r){var o=this;return r===void 0&&(r={}),Wt(n).forEach(function(i){o._featureIds.has(i)&&(o._featureIds.delete(i),o._selectedFeatureIds.delete(i),r.silent||o._deletedFeaturesToEmit.indexOf(o._features[i])===-1&&o._deletedFeaturesToEmit.push(o._features[i]),delete o._features[i],o.isDirty=!0)}),cr(this,r),this},R.prototype.get=function(n){return this._features[n]},R.prototype.getAll=function(){var n=this;return Object.keys(this._features).map(function(r){return n._features[r]})},R.prototype.select=function(n,r){var o=this;return r===void 0&&(r={}),Wt(n).forEach(function(i){o._selectedFeatureIds.has(i)||(o._selectedFeatureIds.add(i),o._changedFeatureIds.add(i),r.silent||(o._emitSelectionChange=!0))}),this},R.prototype.deselect=function(n,r){var o=this;return r===void 0&&(r={}),Wt(n).forEach(function(i){o._selectedFeatureIds.has(i)&&(o._selectedFeatureIds.delete(i),o._changedFeatureIds.add(i),r.silent||(o._emitSelectionChange=!0))}),cr(this,r),this},R.prototype.clearSelected=function(n){return n===void 0&&(n={}),this.deselect(this._selectedFeatureIds.values(),{silent:n.silent}),this},R.prototype.setSelected=function(n,r){var o=this;return r===void 0&&(r={}),n=Wt(n),this.deselect(this._selectedFeatureIds.values().filter(function(i){return n.indexOf(i)===-1}),{silent:r.silent}),this.select(n.filter(function(i){return!o._selectedFeatureIds.has(i)}),{silent:r.silent}),this},R.prototype.setSelectedCoordinates=function(n){return this._selectedCoordinates=n,this._emitSelectionChange=!0,this},R.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},R.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},R.prototype.getSelected=function(){var n=this;return this._selectedFeatureIds.values().map(function(r){return n.get(r)})},R.prototype.getSelectedCoordinates=function(){var n=this;return this._selectedCoordinates.map(function(r){var o=n.get(r.feature_id);return o.properties.isCustom?{coordinates:o.properties.coordinates[parseInt(r.coord_path)]}:{coordinates:o.getCoordinate(r.coord_path)}})},R.prototype.isSelected=function(n){return this._selectedFeatureIds.has(n)},R.prototype.setFeatureProperty=function(n,r,o){this.get(n).setProperty(r,o),this.featureChanged(n)},R.prototype.storeMapConfig=function(){var n=this;po.forEach(function(r){n.ctx.map[r]&&(n._mapInitialConfig[r]=n.ctx.map[r].isEnabled())})},R.prototype.restoreMapConfig=function(){var n=this;Object.keys(this._mapInitialConfig).forEach(function(r){n._mapInitialConfig[r]?n.ctx.map[r].enable():n.ctx.map[r].disable()})},R.prototype.getInitialConfigValue=function(n){return this._mapInitialConfig[n]===void 0||this._mapInitialConfig[n]};var qe=function(){for(var n=arguments,r={},o=0;o<arguments.length;o++){var i=n[o];for(var a in i)Bo.call(i,a)&&(r[a]=i[a])}return r},Bo=Object.prototype.hasOwnProperty;function Pn(n){return function(r){var o=r.featureTarget;return!!o&&!!o.properties&&o.properties.meta===n}}function pt(n){return!!n.featureTarget&&!!n.featureTarget.properties&&n.featureTarget.properties.active===ye&&n.featureTarget.properties.meta===Be}function ur(n){return!!n.featureTarget&&!!n.featureTarget.properties&&n.featureTarget.properties.active===_e&&n.featureTarget.properties.meta===Be}function mn(n){return n.featureTarget===void 0}function Qt(n){var r=n.featureTarget;return!!r&&!!r.properties&&r.properties.meta===It}function vn(n){return!!n.originalEvent&&n.originalEvent.shiftKey===!0}function kn(n){return n.keyCode===27}function Fn(n){return n.keyCode===13}var Jo=st;function st(n,r){this.x=n,this.y=r}function dn(n,r){var o=r.getBoundingClientRect();return new Jo(n.clientX-o.left-(r.clientLeft||0),n.clientY-o.top-(r.clientTop||0))}function $e(n,r,o,i){return{type:z,properties:{meta:It,parent:n,coord_path:o,active:i?ye:_e},geometry:{type:H,coordinates:r}}}function Ln(n,r,o){r===void 0&&(r={}),o===void 0&&(o=null);var i,a=n.geometry,s=a.type,c=a.coordinates,h=n.properties&&n.properties.id,u=[];if(n.properties&&n.properties.user_isCustom&&n.properties.user_coordinates.length>0)return n.properties.user_coordinates.forEach(function(y,m){u.push($e(h,y,m,l(m)))}),u;function f(y,m){var _="",d=null;y.forEach(function(x,I){var b=m!=null?m+"."+I:String(I),M=$e(h,x,b,l(b));if(r.midpoints&&d){var w=function(v,P,J,C){var D=P.geometry.coordinates,U=J.geometry.coordinates;if(D[1]>85||D[1]<-85||U[1]>85||U[1]<-85)return null;var V=C.project([D[0],D[1]]),Je=C.project([U[0],U[1]]),T=C.unproject([(V.x+Je.x)/2,(V.y+Je.y)/2]);return{type:z,properties:{meta:Sn,parent:v,lng:T.lng,lat:T.lat,coord_path:J.properties.coord_path},geometry:{type:H,coordinates:[T.lng,T.lat]}}}(h,d,M,r.map);w&&u.push(w)}d=M;var k=JSON.stringify(x);_!==k&&u.push(M),I===0&&(_=k)})}function l(y){return!!r.selectedPaths&&r.selectedPaths.indexOf(y)!==-1}return s===H?u.push($e(h,c,o,l(o))):s===Ie?c.forEach(function(y,m){f(y,o!==null?o+"."+m:String(m))}):s===Re?f(c,o):s.indexOf(Kn)===0&&(i=s.replace(Kn,""),c.forEach(function(y,m){var _={type:z,properties:n.properties,geometry:{type:i,coordinates:y}};u=u.concat(Ln(_,r,m))})),u}st.prototype={clone:function(){return new st(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,r){return this.clone()._rotateAround(n,r)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var r=n.x-this.x,o=n.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,r){return Math.atan2(this.x*r-this.y*n,this.x*n+this.y*r)},_matMult:function(n){var r=n[0]*this.x+n[1]*this.y,o=n[2]*this.x+n[3]*this.y;return this.x=r,this.y=o,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var r=Math.cos(n),o=Math.sin(n),i=r*this.x-o*this.y,a=o*this.x+r*this.y;return this.x=i,this.y=a,this},_rotateAround:function(n,r){var o=Math.cos(n),i=Math.sin(n),a=r.x+o*(this.x-r.x)-i*(this.y-r.y),s=r.y+i*(this.x-r.x)+o*(this.y-r.y);return this.x=a,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},st.convert=function(n){return n instanceof st?n:Array.isArray(n)?new st(n[0],n[1]):n};var Ve=function(n){setTimeout(function(){n.map&&n.map.doubleClickZoom&&n._ctx&&n._ctx.store&&n._ctx.store.getInitialConfigValue&&n._ctx.store.getInitialConfigValue("doubleClickZoom")&&n.map.doubleClickZoom.enable()},0)},ft=function(n){setTimeout(function(){n.map&&n.map.doubleClickZoom&&n.map.doubleClickZoom.disable()},0)},_r=function(n){if(!n||!n.type)return null;var r=zo[n.type];if(!r)return null;if(r==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:n}]};if(r==="feature")return{type:"FeatureCollection",features:[n]};if(r==="featurecollection")return n},zo={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Go=function(n){if(!n)return[];var r=function i(a){switch(a&&a.type||null){case"FeatureCollection":return a.features=a.features.reduce(function(s,c){return s.concat(i(c))},[]),a;case"Feature":return a.geometry?i(a.geometry).map(function(s){var c={type:"Feature",properties:JSON.parse(JSON.stringify(a.properties)),geometry:s};return a.id!==void 0&&(c.id=a.id),c}):a;case"MultiPoint":return a.coordinates.map(function(s){return{type:"Point",coordinates:s}});case"MultiPolygon":return a.coordinates.map(function(s){return{type:"Polygon",coordinates:s}});case"MultiLineString":return a.coordinates.map(function(s){return{type:"LineString",coordinates:s}});case"GeometryCollection":return a.geometries.map(i).reduce(function(s,c){return s.concat(c)},[]);case"Point":case"Polygon":case"LineString":return[a]}}(_r(n)),o=[];return r.features.forEach(function(i){i.geometry&&(o=o.concat(function a(s){return Array.isArray(s)&&s.length&&typeof s[0]=="number"?[s]:s.reduce(function(c,h){return Array.isArray(h)&&Array.isArray(h[0])?c.concat(a(h)):(c.push(h),c)},[])}(i.geometry.coordinates)))}),o},Wo=Ht(function(n){var r=n.exports=function(l){return new o(l)};function o(l){this.value=l}function i(l,y,m){var _=[],d=[],x=!0;return function I(b){var M=m?a(b):b,w={},k=!0,v={node:M,node_:b,path:[].concat(_),parent:d[d.length-1],parents:d,key:_.slice(-1)[0],isRoot:_.length===0,level:_.length,circular:null,update:function(C,D){v.isRoot||(v.parent.node[v.key]=C),v.node=C,D&&(k=!1)},delete:function(C){delete v.parent.node[v.key],C&&(k=!1)},remove:function(C){h(v.parent.node)?v.parent.node.splice(v.key,1):delete v.parent.node[v.key],C&&(k=!1)},keys:null,before:function(C){w.before=C},after:function(C){w.after=C},pre:function(C){w.pre=C},post:function(C){w.post=C},stop:function(){x=!1},block:function(){k=!1}};if(!x)return v;function P(){if(typeof v.node=="object"&&v.node!==null){v.keys&&v.node_===v.node||(v.keys=s(v.node)),v.isLeaf=v.keys.length==0;for(var C=0;C<d.length;C++)if(d[C].node_===b){v.circular=d[C];break}}else v.isLeaf=!0,v.keys=null;v.notLeaf=!v.isLeaf,v.notRoot=!v.isRoot}P();var J=y.call(v,v.node);return J!==void 0&&v.update&&v.update(J),w.before&&w.before.call(v,v.node),k&&(typeof v.node!="object"||v.node===null||v.circular||(d.push(v),P(),u(v.keys,function(C,D){_.push(C),w.pre&&w.pre.call(v,v.node[C],C);var U=I(v.node[C]);m&&f.call(v.node,C)&&(v.node[C]=U.node),U.isLast=D==v.keys.length-1,U.isFirst=D==0,w.post&&w.post.call(v,U),_.pop()}),d.pop()),w.after&&w.after.call(v,v.node)),v}(l).node}function a(l){if(typeof l=="object"&&l!==null){var y;if(h(l))y=[];else if(c(l)==="[object Date]")y=new Date(l.getTime?l.getTime():l);else if(function(d){return c(d)==="[object RegExp]"}(l))y=new RegExp(l);else if(function(d){return c(d)==="[object Error]"}(l))y={message:l.message};else if(function(d){return c(d)==="[object Boolean]"}(l))y=new Boolean(l);else if(function(d){return c(d)==="[object Number]"}(l))y=new Number(l);else if(function(d){return c(d)==="[object String]"}(l))y=new String(l);else if(Object.create&&Object.getPrototypeOf)y=Object.create(Object.getPrototypeOf(l));else if(l.constructor===Object)y={};else{var m=l.constructor&&l.constructor.prototype||l.__proto__||{},_=function(){};_.prototype=m,y=new _}return u(s(l),function(d){y[d]=l[d]}),y}return l}o.prototype.get=function(l){for(var y=this.value,m=0;m<l.length;m++){var _=l[m];if(!y||!f.call(y,_)){y=void 0;break}y=y[_]}return y},o.prototype.has=function(l){for(var y=this.value,m=0;m<l.length;m++){var _=l[m];if(!y||!f.call(y,_))return!1;y=y[_]}return!0},o.prototype.set=function(l,y){for(var m=this.value,_=0;_<l.length-1;_++){var d=l[_];f.call(m,d)||(m[d]={}),m=m[d]}return m[l[_]]=y,y},o.prototype.map=function(l){return i(this.value,l,!0)},o.prototype.forEach=function(l){return this.value=i(this.value,l,!1),this.value},o.prototype.reduce=function(l,y){var m=arguments.length===1,_=m?this.value:y;return this.forEach(function(d){this.isRoot&&m||(_=l.call(this,_,d))}),_},o.prototype.paths=function(){var l=[];return this.forEach(function(y){l.push(this.path)}),l},o.prototype.nodes=function(){var l=[];return this.forEach(function(y){l.push(this.node)}),l},o.prototype.clone=function(){var l=[],y=[];return function m(_){for(var d=0;d<l.length;d++)if(l[d]===_)return y[d];if(typeof _=="object"&&_!==null){var x=a(_);return l.push(_),y.push(x),u(s(_),function(I){x[I]=m(_[I])}),l.pop(),y.pop(),x}return _}(this.value)};var s=Object.keys||function(l){var y=[];for(var m in l)y.push(m);return y};function c(l){return Object.prototype.toString.call(l)}var h=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"},u=function(l,y){if(l.forEach)return l.forEach(y);for(var m=0;m<l.length;m++)y(l[m],m,l)};u(s(o.prototype),function(l){r[l]=function(y){var m=[].slice.call(arguments,1),_=new o(y);return _[l].apply(_,m)}});var f=Object.hasOwnProperty||function(l,y){return y in l}}),qo=ne;function ne(n){if(!(this instanceof ne))return new ne(n);this._bbox=n||[1/0,1/0,-1/0,-1/0],this._valid=!!n}ne.prototype.include=function(n){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],n[0]),this._bbox[1]=Math.min(this._bbox[1],n[1]),this._bbox[2]=Math.max(this._bbox[2],n[0]),this._bbox[3]=Math.max(this._bbox[3],n[1]),this},ne.prototype.equals=function(n){var r;return r=n instanceof ne?n.bbox():n,this._bbox[0]==r[0]&&this._bbox[1]==r[1]&&this._bbox[2]==r[2]&&this._bbox[3]==r[3]},ne.prototype.center=function(n){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},ne.prototype.union=function(n){var r;return this._valid=!0,r=n instanceof ne?n.bbox():n,this._bbox[0]=Math.min(this._bbox[0],r[0]),this._bbox[1]=Math.min(this._bbox[1],r[1]),this._bbox[2]=Math.max(this._bbox[2],r[2]),this._bbox[3]=Math.max(this._bbox[3],r[3]),this},ne.prototype.bbox=function(){return this._valid?this._bbox:null},ne.prototype.contains=function(n){if(!n)return this._fastContains();if(!this._valid)return null;var r=n[0],o=n[1];return this._bbox[0]<=r&&this._bbox[1]<=o&&this._bbox[2]>=r&&this._bbox[3]>=o},ne.prototype.intersect=function(n){return this._valid?(r=n instanceof ne?n.bbox():n,!(this._bbox[0]>r[2]||this._bbox[2]<r[0]||this._bbox[3]<r[1]||this._bbox[1]>r[3])):null;var r},ne.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var n="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",n)},ne.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var br={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Zo=Object.keys(br),_n=function(n){return bn(n).bbox()};function bn(n){for(var r=qo(),o=Go(n),i=0;i<o.length;i++)r.include(o[i]);return r}_n.polygon=function(n){return bn(n).polygon()},_n.bboxify=function(n){return Wo(n).map(function(r){r&&Zo.some(function(o){return!!r[o]&&br[o].indexOf(r.type)!==-1})&&(r.bbox=bn(r).bbox(),this.update(r))})};function xr(n,r){var o=-90,i=90,a=-90,s=90,c=270,h=-270;n.forEach(function(f){var l=_n(f),y=l[1],m=l[3],_=l[0],d=l[2];y>o&&(o=y),m<i&&(i=m),m>a&&(a=m),y<s&&(s=y),_<c&&(c=_),d>h&&(h=d)});var u=r;return o+u.lat>85&&(u.lat=85-o),a+u.lat>90&&(u.lat=90-a),i+u.lat<-85&&(u.lat=-85-i),s+u.lat<-90&&(u.lat=-90-s),c+u.lng<=-270&&(u.lng+=360*Math.ceil(Math.abs(u.lng)/360)),h+u.lng>=270&&(u.lng-=360*Math.ceil(Math.abs(u.lng)/360)),u}function Sr(n,r){var o=xr(n.map(function(i){return i.toGeoJSON()}),r);n.forEach(function(i){var a,s=i.getCoordinates(),c=function(u){var f={lng:u[0]+o.lng,lat:u[1]+o.lat};return[f.lng,f.lat]},h=function(u){return u.map(function(f){return c(f)})};i.type===H?a=c(s):i.type===Re||i.type===eo?a=s.map(c):i.type===Ie||i.type===to?a=s.map(h):i.type===no&&(a=s.map(function(u){return u.map(function(f){return h(f)})})),i.incomingCoords(a),i.properties&&i.properties.isCustom&&i.properties.coordinates.forEach(function(u){u[0]+=o.lng,u[1]+=o.lat})})}var Y={onSetup:function(n){var r=this,o={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:n.featureIds||[]};return this.setSelected(o.initiallySelectedFeatureIds.filter(function(i){return r.getFeature(i)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),o},fireUpdate:function(){this.map.fire(pr,{action:lo,features:this.getSelected().map(function(n){return n.toGeoJSON()})})},fireActionable:function(){var n=this,r=this.getSelected(),o=r.filter(function(h){return n.isInstanceOf("MultiFeature",h)}),i=!1;if(r.length>1){i=!0;var a=r[0].type.replace("Multi","");r.forEach(function(h){h.type.replace("Multi","")!==a&&(i=!1)})}var s=o.length>0,c=r.length>0;this.setActionableState({combineFeatures:i,uncombineFeatures:s,trash:c})},getUniqueIds:function(n){return n.length?n.map(function(r){return r.properties.id}).filter(function(r){return r!==void 0}).reduce(function(r,o){return r.add(o),r},new fe).values():[]},stopExtendedInteractions:function(n){n.boxSelectElement&&(n.boxSelectElement.parentNode&&n.boxSelectElement.parentNode.removeChild(n.boxSelectElement),n.boxSelectElement=null),this.map.dragPan.enable(),n.boxSelecting=!1,n.canBoxSelect=!1,n.dragMoving=!1,n.canDragMove=!1},onStop:function(){Ve(this)},onMouseMove:function(n){return this.stopExtendedInteractions(n),!0},onMouseOut:function(n){return!n.dragMoving||this.fireUpdate()}};Y.onTap=Y.onClick=function(n,r){return mn(r)?this.clickAnywhere(n,r):Pn(It)(r)?this.clickOnVertex(n,r):function(o){return!!o.featureTarget&&!!o.featureTarget.properties&&o.featureTarget.properties.meta===Be}(r)?this.clickOnFeature(n,r):void 0},Y.clickAnywhere=function(n){var r=this,o=this.getSelectedIds();o.length&&(this.clearSelectedFeatures(),o.forEach(function(i){return r.doRender(i)})),Ve(this),this.stopExtendedInteractions(n)},Y.clickOnVertex=function(n,r){this.changeMode(L.DIRECT_SELECT,{featureId:r.featureTarget.properties.parent,coordPath:r.featureTarget.properties.coord_path,startPos:r.lngLat}),this.updateUIClasses({mouse:Ze})},Y.startOnActiveFeature=function(n,r){this.stopExtendedInteractions(n),this.map.dragPan.disable(),this.doRender(r.featureTarget.properties.id),n.canDragMove=!0,n.dragMoveLocation=r.lngLat},Y.clickOnFeature=function(n,r){var o=this;if(r.featureTarget.properties.user_editable!==!1){ft(this),this.stopExtendedInteractions(n);var i=vn(r),a=this.getSelectedIds(),s=r.featureTarget.properties.id,c=this.isSelected(s);if(!i&&c&&this.getFeature(s).type!==H)return this.changeMode(L.DIRECT_SELECT,{featureId:s});c&&i?(this.deselect(s),this.updateUIClasses({mouse:Xt}),a.length===1&&Ve(this)):!c&&i?(this.select(s),this.updateUIClasses({mouse:Ze})):c||i||(a.forEach(function(h){return o.doRender(h)}),this.setSelected(s),this.updateUIClasses({mouse:Ze})),this.doRender(s)}else this.map.fire("draw.unEditable",{id:r.featureTarget.properties.id})},Y.onMouseDown=function(n,r){return pt(r)?this.startOnActiveFeature(n,r):this.drawConfig.boxSelect&&function(o){return!!o.originalEvent&&!!o.originalEvent.shiftKey&&o.originalEvent.button===0}(r)?this.startBoxSelect(n,r):void 0},Y.startBoxSelect=function(n,r){this.stopExtendedInteractions(n),this.map.dragPan.disable(),n.boxSelectStartLocation=dn(r.originalEvent,this.map.getContainer()),n.canBoxSelect=!0},Y.onTouchStart=function(n,r){if(pt(r))return this.startOnActiveFeature(n,r)},Y.onDrag=function(n,r){return n.canDragMove?this.dragMove(n,r):this.drawConfig.boxSelect&&n.canBoxSelect?this.whileBoxSelect(n,r):void 0},Y.whileBoxSelect=function(n,r){n.boxSelecting=!0,this.updateUIClasses({mouse:pe}),n.boxSelectElement||(n.boxSelectElement=document.createElement("div"),n.boxSelectElement.classList.add(Hr),this.map.getContainer().appendChild(n.boxSelectElement));var o=dn(r.originalEvent,this.map.getContainer()),i=Math.min(n.boxSelectStartLocation.x,o.x),a=Math.max(n.boxSelectStartLocation.x,o.x),s=Math.min(n.boxSelectStartLocation.y,o.y),c=Math.max(n.boxSelectStartLocation.y,o.y),h="translate("+i+"px, "+s+"px)";n.boxSelectElement.style.transform=h,n.boxSelectElement.style.WebkitTransform=h,n.boxSelectElement.style.width=a-i+"px",n.boxSelectElement.style.height=c-s+"px"},Y.dragMove=function(n,r){n.dragMoving=!0,r.originalEvent.stopPropagation();var o={lng:r.lngLat.lng-n.dragMoveLocation.lng,lat:r.lngLat.lat-n.dragMoveLocation.lat};Sr(this.getSelected(),o),n.dragMoveLocation=r.lngLat},Y.onMouseUp=function(n,r){var o=this;if(n.dragMoving)this.fireUpdate();else if(n.boxSelecting){var i=[n.boxSelectStartLocation,dn(r.originalEvent,this.map.getContainer())],a=this.featuresAt(null,i,"click"),s=this.getUniqueIds(a).filter(function(c){return!o.isSelected(c)});s.length&&(this.select(s),s.forEach(function(c){return o.doRender(c)}),this.updateUIClasses({mouse:Ze}))}this.stopExtendedInteractions(n)},Y.toDisplayFeatures=function(n,r,o){r.properties.active=this.isSelected(r.properties.id)?ye:_e,o(r),this.fireActionable(),r.properties.active===ye&&r.geometry.type!==H&&Ln(r).forEach(o)},Y.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Y.onCombineFeatures=function(){var n=this.getSelected();if(!(n.length===0||n.length<2)){for(var r=[],o=[],i=n[0].type.replace("Multi",""),a=0;a<n.length;a++){var s=n[a];if(s.type.replace("Multi","")!==i)return;s.type.includes("Multi")?s.getCoordinates().forEach(function(h){r.push(h)}):r.push(s.getCoordinates()),o.push(s.toGeoJSON())}if(o.length>1){var c=this.newFeature({type:z,properties:o[0].properties,geometry:{type:"Multi"+i,coordinates:r}});this.addFeature(c),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([c.id]),this.map.fire(co,{createdFeatures:[c.toGeoJSON()],deletedFeatures:o})}this.fireActionable()}},Y.onUncombineFeatures=function(){var n=this,r=this.getSelected();if(r.length!==0){for(var o=[],i=[],a=function(c){var h=r[c];n.isInstanceOf("MultiFeature",h)&&(h.getFeatures().forEach(function(u){n.addFeature(u),u.properties=h.properties,o.push(u.toGeoJSON()),n.select([u.id])}),n.deleteFeature(h.id,{silent:!0}),i.push(h.toGeoJSON()))},s=0;s<r.length;s++)a(s);o.length>1&&this.map.fire(uo,{createdFeatures:o,deletedFeatures:i}),this.fireActionable()}};var Mr=Pn(It),Ko=Pn(Sn),Te={fireUpdate:function(){this.map.fire(pr,{action:ho,features:this.getSelected().map(function(n){return n.toGeoJSON()})})},fireActionable:function(n){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:n.selectedCoordPaths.length>0})},startDragging:function(n,r){this.map.dragPan.disable(),n.canDragMove=!0,n.dragMoveLocation=r.lngLat},stopDragging:function(n){this.map.dragPan.enable(),n.dragMoving=!1,n.canDragMove=!1,n.dragMoveLocation=null},onVertex:function(n,r){this.startDragging(n,r);var o=r.featureTarget.properties,i=n.selectedCoordPaths.indexOf(o.coord_path);vn(r)||i!==-1?vn(r)&&i===-1&&n.selectedCoordPaths.push(o.coord_path):n.selectedCoordPaths=[o.coord_path];var a=this.pathsToCoordinates(n.featureId,n.selectedCoordPaths);this.setSelectedCoordinates(a)},onMidpoint:function(n,r){this.startDragging(n,r);var o=r.featureTarget.properties;n.feature.addCoordinate(o.coord_path,o.lng,o.lat),this.fireUpdate(),n.selectedCoordPaths=[o.coord_path]},pathsToCoordinates:function(n,r){return r.map(function(o){return{feature_id:n,coord_path:o}})},onFeature:function(n,r){n.selectedCoordPaths.length===0?this.startDragging(n,r):this.stopDragging(n)},dragFeature:function(n,r,o){Sr(this.getSelected(),o),n.dragMoveLocation=r.lngLat},dragVertex:function(n,r,o){if(n.feature.properties.isCustom){var i=n.feature.properties,a=i.coordinates,s=i.type;return a[n.selectedCoordPaths[0]]=[r.lngLat.lng,r.lngLat.lat],void n.feature.setCoordinates(dt[s+"_algorithm"](a))}for(var c=n.selectedCoordPaths.map(function(l){return n.feature.getCoordinate(l)}),h=xr(c.map(function(l){return{type:z,properties:{},geometry:{type:H,coordinates:l}}}),o),u=0;u<c.length;u++){var f=c[u];n.feature.updateCoordinate(n.selectedCoordPaths[u],f[0]+h.lng,f[1]+h.lat)}},clickNoTarget:function(){this.changeMode(L.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(L.SIMPLE_SELECT)},clickActiveFeature:function(n){n.selectedCoordPaths=[],this.clearSelectedCoordinates(),n.feature.changed()},onSetup:function(n){var r=n.featureId,o=this.getFeature(r);if(!o)throw new Error("You must provide a featureId to enter direct_select mode");if(o.type===H)throw new TypeError("direct_select mode doesn't handle point features");var i={featureId:r,feature:o,dragMoveLocation:n.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:n.coordPath?[n.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(r,i.selectedCoordPaths)),this.setSelected(r),ft(this),this.setActionableState({trash:!0}),i},onStop:function(){Ve(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(n,r,o){n.featureId===r.properties.id?(r.properties.active=ye,o(r),Ln(r,{map:this.map,midpoints:!0,selectedPaths:n.selectedCoordPaths}).forEach(o)):(r.properties.active=_e,o(r)),this.fireActionable(n)},onTrash:function(n){n.selectedCoordPaths.sort(function(r,o){return o.localeCompare(r,"en",{numeric:!0})}).forEach(function(r){return n.feature.removeCoordinate(r)}),this.fireUpdate(),n.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(n),n.feature.isValid()===!1&&(this.deleteFeature([n.featureId]),this.changeMode(L.SIMPLE_SELECT,{}))},onMouseMove:function(n,r){var o=pt(r),i=Mr(r),a=n.selectedCoordPaths.length===0;return o&&a||i&&!a?this.updateUIClasses({mouse:Ze}):this.updateUIClasses({mouse:Ct}),this.stopDragging(n),!0},onMouseOut:function(n){return n.dragMoving&&this.fireUpdate(),!0}};Te.onTouchStart=Te.onMouseDown=function(n,r){return Mr(r)?this.onVertex(n,r):pt(r)?this.onFeature(n,r):Ko(r)?this.onMidpoint(n,r):void 0},Te.onDrag=function(n,r){if(n.canDragMove===!0){n.dragMoving=!0,r.originalEvent.stopPropagation();var o={lng:r.lngLat.lng-n.dragMoveLocation.lng,lat:r.lngLat.lat-n.dragMoveLocation.lat};n.selectedCoordPaths.length>0?this.dragVertex(n,r,o):this.dragFeature(n,r,o),n.dragMoveLocation=r.lngLat}},Te.onClick=function(n,r){return mn(r)?this.clickNoTarget(n,r):pt(r)?this.clickActiveFeature(n,r):ur(r)?this.clickInactive(n,r):void this.stopDragging(n)},Te.onTap=function(n,r){return mn(r)?this.clickNoTarget(n,r):pt(r)?this.clickActiveFeature(n,r):ur(r)?this.clickInactive(n,r):void 0},Te.onTouchEnd=Te.onMouseUp=function(n){n.dragMoving&&this.fireUpdate(),this.stopDragging(n)};var ie={};function xn(n,r){return!!n.lngLat&&n.lngLat.lng===r[0]&&n.lngLat.lat===r[1]}ie.onSetup=function(){var n=this.newFeature({type:z,properties:{},geometry:{type:H,coordinates:[]}});return this.addFeature(n),this.clearSelectedFeatures(),this.updateUIClasses({mouse:pe}),this.activateUIButton(Ye),this.setActionableState({trash:!0}),{point:n}},ie.stopDrawingAndRemove=function(n){this.deleteFeature([n.point.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT)},ie.onTap=ie.onClick=function(n,r){this.updateUIClasses({mouse:Ze}),n.point.updateCoordinate("",r.lngLat.lng,r.lngLat.lat),this.map.fire(Et,{features:[n.point.toGeoJSON()]}),this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.point.id]})},ie.onStop=function(n){this.activateUIButton(),n.point.getCoordinate().length||this.deleteFeature([n.point.id],{silent:!0})},ie.toDisplayFeatures=function(n,r,o){var i=r.properties.id===n.point.id;if(r.properties.active=i?ye:_e,!i)return o(r)},ie.onTrash=ie.stopDrawingAndRemove,ie.onKeyUp=function(n,r){if(kn(r)||Fn(r))return this.stopDrawingAndRemove(n,r)};var je={onSetup:function(){var n=this.newFeature({type:z,properties:{name:"多边形","fill-color":"#54A6F2","line-color":"#54A6F2",opacity:.1,visible:!0,description:"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"fill-color",label:"填充色",type:"color"},{key:"line-color",label:"边框色",type:"color"},{key:"opacity",label:"透明度",type:"number",step:.1,min:0,max:1},{key:"description",label:"说明",type:"textArea"}]},geometry:{type:Ie,coordinates:[[]]}});return this.addFeature(n),this.clearSelectedFeatures(),ft(this),this.updateUIClasses({mouse:pe}),this.activateUIButton(ht),this.setActionableState({trash:!0}),{polygon:n,currentVertexPosition:0}},clickAnywhere:function(n,r){if(n.currentVertexPosition>0&&xn(r,n.polygon.coordinates[0][n.currentVertexPosition-1]))return this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.polygon.id]});this.updateUIClasses({mouse:pe}),n.polygon.updateCoordinate("0."+n.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),n.currentVertexPosition++,n.polygon.updateCoordinate("0."+n.currentVertexPosition,r.lngLat.lng,r.lngLat.lat)},clickOnVertex:function(n){return this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.polygon.id]})},onMouseMove:function(n,r){n.polygon.updateCoordinate("0."+n.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),Qt(r)&&this.updateUIClasses({mouse:Xt})}};je.onTap=je.onClick=function(n,r){return Qt(r)?this.clickOnVertex(n,r):this.clickAnywhere(n,r)},je.onKeyUp=function(n,r){kn(r)?(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT)):Fn(r)&&this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.polygon.id]})},je.onStop=function(n){this.updateUIClasses({mouse:Ct}),Ve(this),this.activateUIButton(),this.getFeature(n.polygon.id)!==void 0&&(n.polygon.removeCoordinate("0."+n.currentVertexPosition),n.polygon.isValid()?this.map.fire(Et,{features:[n.polygon.toGeoJSON()]}):(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT,{},{silent:!0})))},je.toDisplayFeatures=function(n,r,o){var i=r.properties.id===n.polygon.id;if(r.properties.active=i?ye:_e,!i)return o(r);if(r.geometry.coordinates.length!==0){var a=r.geometry.coordinates[0].length;if(!(a<3)){if(r.properties.meta=Be,o($e(n.polygon.id,r.geometry.coordinates[0][0],"0.0",!1)),a>3){var s=r.geometry.coordinates[0].length-3;o($e(n.polygon.id,r.geometry.coordinates[0][s],"0."+s,!1))}if(a<=4){var c=[[r.geometry.coordinates[0][0][0],r.geometry.coordinates[0][0][1]],[r.geometry.coordinates[0][1][0],r.geometry.coordinates[0][1][1]]];if(o({type:z,properties:r.properties,geometry:{coordinates:c,type:Re}}),a===3)return}return o(r)}}},je.onTrash=function(n){this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT)};var Ne={onSetup:function(n){var r,o,i=(n=n||{}).featureId,a="forward";if(i){if(!(r=this.getFeature(i)))throw new Error("Could not find a feature with the provided featureId");var s=n.from;if(s&&s.type==="Feature"&&s.geometry&&s.geometry.type==="Point"&&(s=s.geometry),s&&s.type==="Point"&&s.coordinates&&s.coordinates.length===2&&(s=s.coordinates),!s||!Array.isArray(s))throw new Error("Please use the `from` property to indicate which point to continue the line from");var c=r.coordinates.length-1;if(r.coordinates[c][0]===s[0]&&r.coordinates[c][1]===s[1])o=c+1,r.addCoordinate.apply(r,[o].concat(r.coordinates[c]));else{if(r.coordinates[0][0]!==s[0]||r.coordinates[0][1]!==s[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");a="backwards",o=0,r.addCoordinate.apply(r,[o].concat(r.coordinates[0]))}}else r=this.newFeature({type:z,properties:{name:"折线","line-color":n.lineColor||"#54A6F2","line-width":n.lineWidth||2,opacity:n.opacity||1,visible:!0,description:"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"line-color",label:"颜色",type:"color"},{key:"line-width",label:"宽度",type:"number",step:.1,min:0},{key:"opacity",label:"透明度",type:"number",step:.1,min:0,max:1},{key:"description",label:"说明",type:"textArea"}]},geometry:{type:Re,coordinates:[]}}),o=0,this.addFeature(r);return this.clearSelectedFeatures(),ft(this),this.updateUIClasses({mouse:pe}),this.activateUIButton(Zt),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:o,direction:a}},clickAnywhere:function(n,r){if(n.currentVertexPosition>0&&xn(r,n.line.coordinates[n.currentVertexPosition-1])||n.direction==="backwards"&&xn(r,n.line.coordinates[n.currentVertexPosition+1]))return this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.line.id]});this.updateUIClasses({mouse:pe}),n.line.updateCoordinate(n.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),n.direction==="forward"?(n.currentVertexPosition++,n.line.updateCoordinate(n.currentVertexPosition,r.lngLat.lng,r.lngLat.lat)):n.line.addCoordinate(0,r.lngLat.lng,r.lngLat.lat)},clickOnVertex:function(n){return this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.line.id]})},onMouseMove:function(n,r){n.line.updateCoordinate(n.currentVertexPosition,r.lngLat.lng,r.lngLat.lat),Qt(r)&&this.updateUIClasses({mouse:Xt})}};Ne.onTap=Ne.onClick=function(n,r){if(Qt(r))return this.clickOnVertex(n,r);this.clickAnywhere(n,r)},Ne.onKeyUp=function(n,r){Fn(r)?this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.line.id]}):kn(r)&&(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT))},Ne.onStop=function(n){Ve(this),this.activateUIButton(),this.getFeature(n.line.id)!==void 0&&(n.line.removeCoordinate(""+n.currentVertexPosition),n.line.isValid()?this.map.fire(Et,{features:[n.line.toGeoJSON()]}):(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT,{},{silent:!0})))},Ne.onTrash=function(n){this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT)},Ne.toDisplayFeatures=function(n,r,o){var i=r.properties.id===n.line.id;if(r.properties.active=i?ye:_e,!i)return o(r);r.geometry.coordinates.length<2||(r.properties.meta=Be,o($e(n.line.id,r.geometry.coordinates[n.direction==="forward"?r.geometry.coordinates.length-2:1],""+(n.direction==="forward"?r.geometry.coordinates.length-2:1),!1)),o(r))};var Yo={onSetup:function(){return this.setActionableState(),{}},toDisplayFeatures:function(n,r,o){o(r)}},ct=Object.assign({},je);ct.onSetup=function(){var n=this.newFeature({type:z,properties:{name:this.name,isCustom:!0,type:this.type,coordinates:[],"fill-color":"#54A6F2","line-color":"#54A6F2",opacity:.1,visible:!0,description:"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"fill-color",label:"填充色",type:"color"},{key:"line-color",label:"边框色",type:"color"},{key:"opacity",label:"透明度",type:"number",step:.1,min:0,max:1},{key:"description",label:"说明",type:"textArea"}]},geometry:{type:Ie,coordinates:[]}});return this.addFeature(n),this.clearSelectedFeatures(),ft(this),this.updateUIClasses({mouse:pe}),this.activateUIButton(ht),this.setActionableState({trash:!0}),{polygon:n,algorithmName:this.algorithmName,fixedPointCount:this.fixedPointCount,currentVertexPosition:0}},ct.clickAnywhere=function(n,r){n.currentVertexPosition++,n.polygon.properties.coordinates.push([r.lngLat.lng,r.lngLat.lat]),n.polygon.setCoordinates(dt[n.algorithmName](n.polygon.properties.coordinates)),n.currentVertexPosition>=n.fixedPointCount&&this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.polygon.id]},{silent:!1})},ct.onMouseMove=function(n,r){n.currentVertexPosition>0&&n.polygon.setCoordinates(dt[n.algorithmName]([].concat(n.polygon.properties.coordinates,[[r.lngLat.lng,r.lngLat.lat]])))},ct.toDisplayFeatures=function(n,r,o){var i=r.properties.id===n.polygon.id;if(r.properties.active=i?ye:_e,!i)return o(r);if(r.geometry.coordinates.length!==0){if(n.fixedPointCount>2&&r.geometry.coordinates[0].length<4){var a=r.geometry.coordinates[0].slice(0,2);o({type:z,properties:r.properties,geometry:{coordinates:a,type:Re}})}return r.properties.user_coordinates.forEach(function(s,c){o($e(n.polygon.id,s,"0."+c,!1))}),o(r)}},ct.onStop=function(n){this.updateUIClasses({mouse:Ct}),Ve(this),this.activateUIButton(),this.getFeature(n.polygon.id)!==void 0&&(n.polygon.isValid()?this.map.fire(Et,{features:[n.polygon.toGeoJSON(!0)]}):(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT,{},{silent:!0})))};var le=function(n){var r=Object.assign({},ct);return r.name=n.name,r.type=n.type,r.algorithmName=n.type+"_algorithm",r.fixedPointCount=n.fixedPointCount,r},ut=Object.assign({},Ne);ut.onSetup=function(){var n=this.newFeature({type:z,properties:{name:this.name,isCustom:!0,type:this.type,coordinates:[],"line-color":"#54A6F2","line-width":2,opacity:1,visible:!0,description:"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"line-color",label:"颜色",type:"color"},{key:"line-width",label:"宽度",type:"number",step:.1,min:0},{key:"opacity",label:"透明度",type:"number",step:.1,min:0,max:1},{key:"description",label:"说明",type:"textArea"}]},geometry:{type:Re,coordinates:[]}});return this.addFeature(n),this.clearSelectedFeatures(),ft(this),this.updateUIClasses({mouse:pe}),this.activateUIButton(ht),this.setActionableState({trash:!0}),{line:n,algorithmName:this.algorithmName,fixedPointCount:this.fixedPointCount,currentVertexPosition:0}},ut.clickAnywhere=function(n,r){n.currentVertexPosition++,n.line.properties.coordinates.push([r.lngLat.lng,r.lngLat.lat]),n.line.setCoordinates(dt[n.algorithmName](n.line.properties.coordinates)),n.currentVertexPosition>=n.fixedPointCount&&this.changeMode(L.SIMPLE_SELECT,{featureIds:[n.line.id]},{silent:!1})},ut.onMouseMove=function(n,r){n.currentVertexPosition>0&&n.line.setCoordinates(dt[n.algorithmName]([].concat(n.line.properties.coordinates,[[r.lngLat.lng,r.lngLat.lat]])))},ut.toDisplayFeatures=function(n,r,o){var i=r.properties.id===n.line.id;return r.properties.active=i?ye:_e,i?r.geometry.coordinates.length<2?void 0:(r.properties.meta=Be,r.properties.user_coordinates.forEach(function(a,s){o($e(n.line.id,a,"0."+s,!1))}),o(r)):o(r)},ut.onStop=function(n){this.updateUIClasses({mouse:Ct}),Ve(this),this.activateUIButton(),this.getFeature(n.line.id)!==void 0&&(n.line.isValid()?this.map.fire(Et,{features:[n.line.toGeoJSON(!0)]}):(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(L.SIMPLE_SELECT,{},{silent:!0})))};var lr=function(n){var r=Object.assign({},ut);return r.name=n.name,r.type=n.type,r.algorithmName=n.type+"_algorithm",r.fixedPointCount=n.fixedPointCount,r},wr=Object.assign({},ie);function Cr(n,r,o){return new Promise(function(i){n.hasImage(r)?i():n.loadImage(o,function(a,s){n.addImage(r,s),i()})})}wr.onSetup=function(n){n===void 0&&(n={});var r=this.newFeature({type:z,properties:Object.assign({},{name:"文字注记","display-type":"symbol","text-size":16,"text-color":"#000000",text:"文字注记",visible:!0,description:"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"text",label:"文字内容",type:"string"},{key:"text-size",label:"文字大小",type:"number",min:0},{key:"text-color",label:"文字颜色",type:"color"},{key:"description",label:"说明",type:"textArea"}]},n),geometry:{type:H,coordinates:[]}});return this.addFeature(r),this.clearSelectedFeatures(),this.updateUIClasses({mouse:pe}),this.activateUIButton(Ye),this.setActionableState({trash:!0}),{point:r}};var Er=Object.assign({},ie);Er.onSetup=function(n){var r=n.imageId,o=n.imageUrl;if(!r||!o)throw new Error("必须传入图标信息");var i={},a=[];n.appendDictionary&&(a=n.appendDictionary).forEach(function(h){i[h.key]=h.default});var s=n.iconSize?n.iconSize:1,c=this.newFeature({type:z,properties:Object.assign({},{name:"符号标绘","display-type":"symbol","icon-size":s,description:"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"icon-size",label:"图标放大倍数",type:"number",min:0,step:.01},{key:"description",label:"说明",type:"textArea"}].concat(a)},i),geometry:{type:H,coordinates:[]}});return this.addFeature(c),Cr(this.map,r,o).then(function(){c.properties["image-id"]=r,c.properties["image-url"]=o}),this.clearSelectedFeatures(),this.updateUIClasses({mouse:pe}),this.activateUIButton(Ye),this.setActionableState({trash:!0}),{point:c}};var Ir=Object.assign({},ie);Ir.onSetup=function(n){var r=n.imageId,o=n.imageUrl;if(!r||!o)throw new Error("必须传入图标信息");var i={},a=[];n.appendDictionary&&(a=n.appendDictionary).forEach(function(h){i[h.key]=h.default});var s=n.iconSize?n.iconSize:1,c=this.newFeature({type:z,properties:Object.assign({},{name:"视频点标绘","display-type":"symbol","icon-size":s,"camera-url":"","properties-dictionary":[{key:"name",label:"名称",type:"string"},{key:"icon-size",label:"图标放大倍数",type:"number",min:0,step:.01},{key:"camera-url",label:"视频地址",type:"textArea"}].concat(a)},i),geometry:{type:H,coordinates:[]}});return this.addFeature(c),Cr(this.map,r,o).then(function(){c.properties["image-id"]=r,c.properties["image-url"]=o}),this.clearSelectedFeatures(),this.updateUIClasses({mouse:pe}),this.activateUIButton(Ye),this.setActionableState({trash:!0}),{point:c}};var Xo={draw_circle:le({name:"圆",type:"circle",fixedPointCount:2}),draw_fine_arrow:le({name:"细直箭头",type:"fine_arrow",fixedPointCount:2}),draw_ellipse:le({name:"椭圆",type:"ellipse",fixedPointCount:2}),draw_rectangle:le({name:"矩形",type:"rectangle",fixedPointCount:2}),draw_assault_direction:le({name:"突击方向",type:"assault_direction",fixedPointCount:2}),draw_double_arrow:le({name:"钳击",type:"double_arrow",fixedPointCount:4}),draw_sector:le({name:"扇形",type:"sector",fixedPointCount:3}),draw_lune:le({name:"弓形",type:"lune",fixedPointCount:3}),draw_attack_arrow:le({name:"进攻箭头",type:"attack_arrow",fixedPointCount:1/0}),draw_tailed_attack_arrow:le({name:"燕尾进攻箭头",type:"tailed_attack_arrow",fixedPointCount:1/0}),draw_squad_combat:le({name:"战斗小队",type:"squad_combat",fixedPointCount:1/0}),draw_closed_curve:le({name:"闭合曲面",type:"closed_curve",fixedPointCount:1/0}),draw_curve:lr({name:"曲线",type:"curve",fixedPointCount:1/0}),draw_arc:lr({name:"弧线",type:"arc",fixedPointCount:3}),draw_text:wr,draw_image:Er,draw_camera:Ir},Ho=Object.assign({},{simple_select:Y,direct_select:Te,draw_point:ie,draw_polygon:je,draw_line_string:Ne,static:Yo},Xo),Qo={defaultMode:L.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-symbol-inactive",type:"symbol",filter:["all",["!=","user_visible",!1],["==","user_display-type","symbol"],["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"text-color":["get","user_text-color"]},layout:{"text-allow-overlap":!0,"icon-allow-overlap":!0,"text-size":["get","user_text-size"],"icon-image":["get","user_image-id"],"icon-size":["get","user_icon-size"],"text-field":["get","user_text"],"text-font":["Open Sans Regular"]}},{id:"gl-draw-symbol-active",type:"symbol",filter:["all",["!=","user_visible",!1],["==","user_display-type","symbol"],["==","$type","Point"],["==","active","true"],["==","meta","feature"]],paint:{"text-color":["get","user_text-color"]},layout:{"text-allow-overlap":!0,"icon-allow-overlap":!0,"text-size":["get","user_text-size"],"icon-image":["get","user_image-id"],"icon-size":["get","user_icon-size"],"text-field":["get","user_text"],"text-font":["Open Sans Regular"]}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["!=","user_visible",!1],["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":["get","user_fill-color"],"fill-outline-color":["get","user_line-color"],"fill-opacity":["get","user_opacity"]}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["!=","user_visible",!1],["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":["get","user_fill-color"],"fill-outline-color":["get","user_line-color"],"fill-opacity":["get","user_opacity"]}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["!=","user_visible",!1],["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["!=","user_visible",!1],["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","user_line-color"],"line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["!=","user_visible",!1],["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","user_line-color"],"line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["!=","user_visible",!1],["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","user_line-color"],"line-width":["get","user_line-width"],"line-opacity":["get","user_opacity"]}},{id:"gl-draw-line-active",type:"line",filter:["all",["!=","user_visible",!1],["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[.2,2],"line-color":["get","user_line-color"],"line-width":2,"line-opacity":1}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["!=","user_visible",!1],["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["!=","user_visible",!1],["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["!=","user_visible",!1],["!has","user_display-type"],["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["!=","user_visible",!1],["!has","user_display-type"],["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["!=","user_visible",!1],["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["!=","user_visible",!1],["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["!=","user_visible",!1],["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["!=","user_visible",!1],["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["!=","user_visible",!1],["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["!=","user_visible",!1],["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:Ho,controls:{},userProperties:!1},ei={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!1,uncombine_features:!1},ti={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!0,uncombine_features:!0};function hr(n,r){return n.map(function(o){return o.source?o:qe(o,{id:o.id+"."+r,source:r==="hot"?lt:Mt})})}var ni=Ht(function(n,r){var o="[object Arguments]",i="[object Map]",a="[object Object]",s="[object Set]",c=/^\[object .+?Constructor\]$/,h=/^(?:0|[1-9]\d*)$/,u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u[o]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u[i]=u["[object Number]"]=u[a]=u["[object RegExp]"]=u[s]=u["[object String]"]=u["[object WeakMap]"]=!1;var f=typeof global=="object"&&global&&global.Object===Object&&global,l=typeof self=="object"&&self&&self.Object===Object&&self,y=f||l||Function("return this")(),m=r&&!r.nodeType&&r,_=m&&n&&!n.nodeType&&n,d=_&&_.exports===m,x=d&&f.process,I=function(){try{return x&&x.binding&&x.binding("util")}catch{}}(),b=I&&I.isTypedArray;function M(p,g){for(var S=-1,E=p==null?0:p.length;++S<E;)if(g(p[S],S,p))return!0;return!1}function w(p){var g=-1,S=Array(p.size);return p.forEach(function(E,$){S[++g]=[$,E]}),S}function k(p){var g=-1,S=Array(p.size);return p.forEach(function(E){S[++g]=E}),S}var v,P,J,C=Array.prototype,D=Function.prototype,U=Object.prototype,V=y["__core-js_shared__"],Je=D.toString,T=U.hasOwnProperty,ge=(v=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"",He=U.toString,yt=RegExp("^"+Je.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pt=d?y.Buffer:void 0,K=y.Symbol,me=y.Uint8Array,Q=U.propertyIsEnumerable,kt=C.splice,ae=K?K.toStringTag:void 0,se=Object.getOwnPropertySymbols,Ft=Pt?Pt.isBuffer:void 0,Qe=(P=Object.keys,J=Object,function(p){return P(J(p))}),gt=tt(y,"DataView"),ce=tt(y,"Map"),et=tt(y,"Promise"),be=tt(y,"Set"),en=tt(y,"WeakMap"),mt=tt(Object,"create"),Pr=We(gt),kr=We(ce),Fr=We(et),Lr=We(be),Ar=We(en),An=K?K.prototype:void 0,tn=An?An.valueOf:void 0;function ze(p){var g=-1,S=p==null?0:p.length;for(this.clear();++g<S;){var E=p[g];this.set(E[0],E[1])}}function xe(p){var g=-1,S=p==null?0:p.length;for(this.clear();++g<S;){var E=p[g];this.set(E[0],E[1])}}function Ge(p){var g=-1,S=p==null?0:p.length;for(this.clear();++g<S;){var E=p[g];this.set(E[0],E[1])}}function Lt(p){var g=-1,S=p==null?0:p.length;for(this.__data__=new Ge;++g<S;)this.add(p[g])}function ke(p){var g=this.__data__=new xe(p);this.size=g.size}function Or(p,g){var S=Tt(p),E=!S&&Ur(p),$=!S&&!E&&nn(p),O=!S&&!E&&!$&&Vn(p),B=S||E||$||O,G=B?function(q,ve){for(var Se=-1,ee=Array(q);++Se<q;)ee[Se]=ve(Se);return ee}(p.length,String):[],de=G.length;for(var W in p)!g&&!T.call(p,W)||B&&(W=="length"||$&&(W=="offset"||W=="parent")||O&&(W=="buffer"||W=="byteLength"||W=="byteOffset")||Dr(W,de))||G.push(W);return G}function At(p,g){for(var S=p.length;S--;)if(Dn(p[S][0],g))return S;return-1}function vt(p){return p==null?p===void 0?"[object Undefined]":"[object Null]":ae&&ae in Object(p)?function(g){var S=T.call(g,ae),E=g[ae];try{g[ae]=void 0;var $=!0}catch{}var O=He.call(g);return $&&(S?g[ae]=E:delete g[ae]),O}(p):function(g){return He.call(g)}(p)}function On(p){return _t(p)&&vt(p)==o}function Tn(p,g,S,E,$){return p===g||(p==null||g==null||!_t(p)&&!_t(g)?p!=p&&g!=g:function(O,B,G,de,W,q){var ve=Tt(O),Se=Tt(B),ee=ve?"[object Array]":Fe(O),Me=Se?"[object Array]":Fe(B),nt=(ee=ee==o?a:ee)==a,jt=(Me=Me==o?a:Me)==a,rt=ee==Me;if(rt&&nn(O)){if(!nn(B))return!1;ve=!0,nt=!1}if(rt&&!nt)return q||(q=new ke),ve||Vn(O)?jn(O,B,G,de,W,q):function(N,j,Nt,Le,rn,ue,we){switch(Nt){case"[object DataView]":if(N.byteLength!=j.byteLength||N.byteOffset!=j.byteOffset)return!1;N=N.buffer,j=j.buffer;case"[object ArrayBuffer]":return!(N.byteLength!=j.byteLength||!ue(new me(N),new me(j)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Dn(+N,+j);case"[object Error]":return N.name==j.name&&N.message==j.message;case"[object RegExp]":case"[object String]":return N==j+"";case i:var Ae=w;case s:var xt=1&Le;if(Ae||(Ae=k),N.size!=j.size&&!xt)return!1;var Dt=we.get(N);if(Dt)return Dt==j;Le|=2,we.set(N,j);var ot=jn(Ae(N),Ae(j),Le,rn,ue,we);return we.delete(N),ot;case"[object Symbol]":if(tn)return tn.call(N)==tn.call(j)}return!1}(O,B,ee,G,de,W,q);if(!(1&G)){var bt=nt&&T.call(O,"__wrapped__"),Bn=jt&&T.call(B,"__wrapped__");if(bt||Bn){var Rr=bt?O.value():O,Vr=Bn?B.value():B;return q||(q=new ke),W(Rr,Vr,G,de,q)}}return rt?(q||(q=new ke),function(N,j,Nt,Le,rn,ue){var we=1&Nt,Ae=Nn(N),xt=Ae.length,Dt=Nn(j).length;if(xt!=Dt&&!we)return!1;for(var ot=xt;ot--;){var Oe=Ae[ot];if(!(we?Oe in j:T.call(j,Oe)))return!1}var Jn=ue.get(N);if(Jn&&ue.get(j))return Jn==j;var Ut=!0;ue.set(N,j),ue.set(j,N);for(var on=we;++ot<xt;){Oe=Ae[ot];var $t=N[Oe],Rt=j[Oe];if(Le)var zn=we?Le(Rt,$t,Oe,j,N,ue):Le($t,Rt,Oe,N,j,ue);if(!(zn===void 0?$t===Rt||rn($t,Rt,Nt,Le,ue):zn)){Ut=!1;break}on||(on=Oe=="constructor")}if(Ut&&!on){var Vt=N.constructor,Bt=j.constructor;Vt==Bt||!("constructor"in N)||!("constructor"in j)||typeof Vt=="function"&&Vt instanceof Vt&&typeof Bt=="function"&&Bt instanceof Bt||(Ut=!1)}return ue.delete(N),ue.delete(j),Ut}(O,B,G,de,W,q)):!1}(p,g,S,E,Tn,$))}function Tr(p){return!(!Rn(p)||function(g){return!!ge&&ge in g}(p))&&(Un(p)?yt:c).test(We(p))}function jr(p){if(S=(g=p)&&g.constructor,E=typeof S=="function"&&S.prototype||U,g!==E)return Qe(p);var g,S,E,$=[];for(var O in Object(p))T.call(p,O)&&O!="constructor"&&$.push(O);return $}function jn(p,g,S,E,$,O){var B=1&S,G=p.length,de=g.length;if(G!=de&&!(B&&de>G))return!1;var W=O.get(p);if(W&&O.get(g))return W==g;var q=-1,ve=!0,Se=2&S?new Lt:void 0;for(O.set(p,g),O.set(g,p);++q<G;){var ee=p[q],Me=g[q];if(E)var nt=B?E(Me,ee,q,g,p,O):E(ee,Me,q,p,g,O);if(nt!==void 0){if(nt)continue;ve=!1;break}if(Se){if(!M(g,function(jt,rt){if(bt=rt,!Se.has(bt)&&(ee===jt||$(ee,jt,S,E,O)))return Se.push(rt);var bt})){ve=!1;break}}else if(ee!==Me&&!$(ee,Me,S,E,O)){ve=!1;break}}return O.delete(p),O.delete(g),ve}function Nn(p){return function(g,S,E){var $=S(g);return Tt(g)?$:function(O,B){for(var G=-1,de=B.length,W=O.length;++G<de;)O[W+G]=B[G];return O}($,E(g))}(p,$r,Nr)}function Ot(p,g){var S,E,$=p.__data__;return((E=typeof(S=g))=="string"||E=="number"||E=="symbol"||E=="boolean"?S!=="__proto__":S===null)?$[typeof g=="string"?"string":"hash"]:$.map}function tt(p,g){var S=function(E,$){return E==null?void 0:E[$]}(p,g);return Tr(S)?S:void 0}ze.prototype.clear=function(){this.__data__=mt?mt(null):{},this.size=0},ze.prototype.delete=function(p){var g=this.has(p)&&delete this.__data__[p];return this.size-=g?1:0,g},ze.prototype.get=function(p){var g=this.__data__;if(mt){var S=g[p];return S==="__lodash_hash_undefined__"?void 0:S}return T.call(g,p)?g[p]:void 0},ze.prototype.has=function(p){var g=this.__data__;return mt?g[p]!==void 0:T.call(g,p)},ze.prototype.set=function(p,g){var S=this.__data__;return this.size+=this.has(p)?0:1,S[p]=mt&&g===void 0?"__lodash_hash_undefined__":g,this},xe.prototype.clear=function(){this.__data__=[],this.size=0},xe.prototype.delete=function(p){var g=this.__data__,S=At(g,p);return!(S<0)&&(S==g.length-1?g.pop():kt.call(g,S,1),--this.size,!0)},xe.prototype.get=function(p){var g=this.__data__,S=At(g,p);return S<0?void 0:g[S][1]},xe.prototype.has=function(p){return At(this.__data__,p)>-1},xe.prototype.set=function(p,g){var S=this.__data__,E=At(S,p);return E<0?(++this.size,S.push([p,g])):S[E][1]=g,this},Ge.prototype.clear=function(){this.size=0,this.__data__={hash:new ze,map:new(ce||xe),string:new ze}},Ge.prototype.delete=function(p){var g=Ot(this,p).delete(p);return this.size-=g?1:0,g},Ge.prototype.get=function(p){return Ot(this,p).get(p)},Ge.prototype.has=function(p){return Ot(this,p).has(p)},Ge.prototype.set=function(p,g){var S=Ot(this,p),E=S.size;return S.set(p,g),this.size+=S.size==E?0:1,this},Lt.prototype.add=Lt.prototype.push=function(p){return this.__data__.set(p,"__lodash_hash_undefined__"),this},Lt.prototype.has=function(p){return this.__data__.has(p)},ke.prototype.clear=function(){this.__data__=new xe,this.size=0},ke.prototype.delete=function(p){var g=this.__data__,S=g.delete(p);return this.size=g.size,S},ke.prototype.get=function(p){return this.__data__.get(p)},ke.prototype.has=function(p){return this.__data__.has(p)},ke.prototype.set=function(p,g){var S=this.__data__;if(S instanceof xe){var E=S.__data__;if(!ce||E.length<199)return E.push([p,g]),this.size=++S.size,this;S=this.__data__=new Ge(E)}return S.set(p,g),this.size=S.size,this};var Nr=se?function(p){return p==null?[]:(p=Object(p),function(g,S){for(var E=-1,$=g==null?0:g.length,O=0,B=[];++E<$;){var G=g[E];S(G,E,g)&&(B[O++]=G)}return B}(se(p),function(g){return Q.call(p,g)}))}:function(){return[]},Fe=vt;function Dr(p,g){return!!(g=g??9007199254740991)&&(typeof p=="number"||h.test(p))&&p>-1&&p%1==0&&p<g}function We(p){if(p!=null){try{return Je.call(p)}catch{}try{return p+""}catch{}}return""}function Dn(p,g){return p===g||p!=p&&g!=g}(gt&&Fe(new gt(new ArrayBuffer(1)))!="[object DataView]"||ce&&Fe(new ce)!=i||et&&Fe(et.resolve())!="[object Promise]"||be&&Fe(new be)!=s||en&&Fe(new en)!="[object WeakMap]")&&(Fe=function(p){var g=vt(p),S=g==a?p.constructor:void 0,E=S?We(S):"";if(E)switch(E){case Pr:return"[object DataView]";case kr:return i;case Fr:return"[object Promise]";case Lr:return s;case Ar:return"[object WeakMap]"}return g});var Ur=On(function(){return arguments}())?On:function(p){return _t(p)&&T.call(p,"callee")&&!Q.call(p,"callee")},Tt=Array.isArray,nn=Ft||function(){return!1};function Un(p){if(!Rn(p))return!1;var g=vt(p);return g=="[object Function]"||g=="[object GeneratorFunction]"||g=="[object AsyncFunction]"||g=="[object Proxy]"}function $n(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=9007199254740991}function Rn(p){var g=typeof p;return p!=null&&(g=="object"||g=="function")}function _t(p){return p!=null&&typeof p=="object"}var Vn=b?function(p){return function(g){return p(g)}}(b):function(p){return _t(p)&&$n(p.length)&&!!u[vt(p)]};function $r(p){return(g=p)!=null&&$n(g.length)&&!Un(g)?Or(p):jr(p);var g}n.exports=function(p,g){return Tn(p,g)}}),qt=Ht(function(n,r){var o=function(){var i=function(b,M,w,k){for(w=w||{},k=b.length;k--;w[b[k]]=M);return w},a=[1,12],s=[1,13],c=[1,9],h=[1,10],u=[1,11],f=[1,14],l=[1,15],y=[14,18,22,24],m=[18,22],_=[22,24],d={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(b,M,w,k,v,P,J){var C=P.length-1;switch(v){case 1:this.$=b.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(b);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=P[C-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=P[C-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[P[C-2],P[C]];break;case 16:this.$={},this.$[P[C][0]]=P[C][1];break;case 17:this.$=P[C-2],P[C-2][P[C][0]]!==void 0&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(P[C][0])),P[C-2][P[C][0]]=P[C][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[P[C]];break;case 21:this.$=P[C-2],P[C-2].push(P[C])}},table:[{3:5,4:a,5:6,6:s,7:3,8:c,9:4,10:h,11:u,12:1,13:2,15:7,16:8,17:f,23:l},{1:[3]},{14:[1,16]},i(y,[2,7]),i(y,[2,8]),i(y,[2,9]),i(y,[2,10]),i(y,[2,11]),i(y,[2,12]),i(y,[2,3]),i(y,[2,4]),i(y,[2,5]),i([14,18,21,22,24],[2,1]),i(y,[2,2]),{3:20,4:a,18:[1,17],19:18,20:19},{3:5,4:a,5:6,6:s,7:3,8:c,9:4,10:h,11:u,13:23,15:7,16:8,17:f,23:l,24:[1,21],25:22},{1:[2,6]},i(y,[2,13]),{18:[1,24],22:[1,25]},i(m,[2,16]),{21:[1,26]},i(y,[2,18]),{22:[1,28],24:[1,27]},i(_,[2,20]),i(y,[2,14]),{3:20,4:a,20:29},{3:5,4:a,5:6,6:s,7:3,8:c,9:4,10:h,11:u,13:30,15:7,16:8,17:f,23:l},i(y,[2,19]),{3:5,4:a,5:6,6:s,7:3,8:c,9:4,10:h,11:u,13:31,15:7,16:8,17:f,23:l},i(m,[2,17]),i(m,[2,15]),i(_,[2,21])],defaultActions:{16:[2,6]},parseError:function(b,M){if(!M.recoverable){let w=function(k,v){this.message=k,this.hash=v};throw w.prototype=Error,new w(b,M)}this.trace(b)},parse:function(b){var M=this,w=[0],k=[null],v=[],P=this.table,J="",C=0,D=0,U=2,V=1,Je=v.slice.call(arguments,1),T=Object.create(this.lexer),ge={yy:{}};for(var He in this.yy)Object.prototype.hasOwnProperty.call(this.yy,He)&&(ge.yy[He]=this.yy[He]);T.setInput(b,ge.yy),ge.yy.lexer=T,ge.yy.parser=this,T.yylloc===void 0&&(T.yylloc={});var yt=T.yylloc;v.push(yt);var Pt=T.options&&T.options.ranges;typeof ge.yy.parseError=="function"?this.parseError=ge.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var K,me,Q,kt,ae,se,Ft,Qe,gt=function(){var be;return typeof(be=T.lex()||V)!="number"&&(be=M.symbols_[be]||be),be},ce={};;){if(me=w[w.length-1],this.defaultActions[me]?Q=this.defaultActions[me]:(K==null&&(K=gt()),Q=P[me]&&P[me][K]),Q===void 0||!Q.length||!Q[0]){var et="";for(ae in Qe=[],P[me])this.terminals_[ae]&&ae>U&&Qe.push("'"+this.terminals_[ae]+"'");et=T.showPosition?"Parse error on line "+(C+1)+`:
`+T.showPosition()+`
Expecting `+Qe.join(", ")+", got '"+(this.terminals_[K]||K)+"'":"Parse error on line "+(C+1)+": Unexpected "+(K==V?"end of input":"'"+(this.terminals_[K]||K)+"'"),this.parseError(et,{text:T.match,token:this.terminals_[K]||K,line:T.yylineno,loc:yt,expected:Qe})}if(Q[0]instanceof Array&&Q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+me+", token: "+K);switch(Q[0]){case 1:w.push(K),k.push(T.yytext),v.push(T.yylloc),w.push(Q[1]),K=null,D=T.yyleng,J=T.yytext,C=T.yylineno,yt=T.yylloc;break;case 2:if(se=this.productions_[Q[1]][1],ce.$=k[k.length-se],ce._$={first_line:v[v.length-(se||1)].first_line,last_line:v[v.length-1].last_line,first_column:v[v.length-(se||1)].first_column,last_column:v[v.length-1].last_column},Pt&&(ce._$.range=[v[v.length-(se||1)].range[0],v[v.length-1].range[1]]),(kt=this.performAction.apply(ce,[J,D,C,ge.yy,Q[1],k,v].concat(Je)))!==void 0)return kt;se&&(w=w.slice(0,-1*se*2),k=k.slice(0,-1*se),v=v.slice(0,-1*se)),w.push(this.productions_[Q[1]][0]),k.push(ce.$),v.push(ce._$),Ft=P[w[w.length-2]][w[w.length-1]],w.push(Ft);break;case 3:return!0}}return!0}},x={EOF:1,parseError:function(b,M){if(!this.yy.parser)throw new Error(b);this.yy.parser.parseError(b,M)},setInput:function(b,M){return this.yy=M||this.yy||{},this._input=b,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var b=this._input[0];return this.yytext+=b,this.yyleng++,this.offset++,this.match+=b,this.matched+=b,b.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),b},unput:function(b){var M=b.length,w=b.split(/(?:\r\n?|\n)/g);this._input=b+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-M),this.offset-=M;var k=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),w.length-1&&(this.yylineno-=w.length-1);var v=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:w?(w.length===k.length?this.yylloc.first_column:0)+k[k.length-w.length].length-w[0].length:this.yylloc.first_column-M},this.options.ranges&&(this.yylloc.range=[v[0],v[0]+this.yyleng-M]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(b){this.unput(this.match.slice(b))},pastInput:function(){var b=this.matched.substr(0,this.matched.length-this.match.length);return(b.length>20?"...":"")+b.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var b=this.match;return b.length<20&&(b+=this._input.substr(0,20-b.length)),(b.substr(0,20)+(b.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var b=this.pastInput(),M=new Array(b.length+1).join("-");return b+this.upcomingInput()+`
`+M+"^"},test_match:function(b,M){var w,k,v;if(this.options.backtrack_lexer&&(v={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(v.yylloc.range=this.yylloc.range.slice(0))),(k=b[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=k.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:k?k[k.length-1].length-k[k.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],w=this.performAction.call(this,this.yy,this,M,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),w)return w;if(this._backtrack){for(var P in v)this[P]=v[P];return!1}return!1},next:function(){if(this.done)return this.EOF;var b,M,w,k;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var v=this._currentRules(),P=0;P<v.length;P++)if((w=this._input.match(this.rules[v[P]]))&&(!M||w[0].length>M[0].length)){if(M=w,k=P,this.options.backtrack_lexer){if((b=this.test_match(w,v[P]))!==!1)return b;if(this._backtrack){M=!1;continue}return!1}if(!this.options.flex)break}return M?(b=this.test_match(M,v[k]))!==!1&&b:this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return b||this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(b){return(b=this.conditionStack.length-1-Math.abs(b||0))>=0?this.conditionStack[b]:"INITIAL"},pushState:function(b){this.begin(b)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(b,M,w,k){switch(w){case 0:break;case 1:return 6;case 2:return M.yytext=M.yytext.substr(1,M.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};function I(){this.yy={}}return d.lexer=x,I.prototype=d,d.Parser=I,new I}();r.parser=o,r.Parser=o.Parser,r.parse=function(){return o.parse.apply(o,arguments)},r.main=function(i){i[1]||(console.log("Usage: "+i[0]+" FILE"),process.exit(1));var a=t.readFileSync(e.normalize(i[1]),"utf8");return r.parser.parse(a)},go.main===n&&r.main(process.argv.slice(1))}),ri=(qt.parser,qt.Parser,qt.parse,qt.main,{Polygon:he,LineString:Ee,Point:Xe,MultiPolygon:oe,MultiLineString:oe,MultiPoint:oe});function oi(n,r){return r.modes=L,r.getFeatureIdsAt=function(o){return wt.click({point:o},null,n).map(function(i){return i.properties.id})},r.getSelectedIds=function(){return n.store.getSelectedIds()},r.getSelected=function(){return{type:Ue,features:n.store.getSelectedIds().map(function(o){return n.store.get(o)}).map(function(o){return o.toGeoJSON()})}},r.getSelectedPoints=function(){return{type:Ue,features:n.store.getSelectedCoordinates().map(function(o){return{type:z,properties:{},geometry:{type:H,coordinates:o.coordinates}}})}},r.set=function(o){if(o.type===void 0||o.type!==Ue||!Array.isArray(o.features))throw new Error("Invalid FeatureCollection");var i=n.store.createRenderBatch(),a=n.store.getAllIds().slice(),s=r.add(o),c=new fe(s);return(a=a.filter(function(h){return!c.has(h)})).length&&r.delete(a),i(),s},r.add=function(o){var i=JSON.parse(JSON.stringify(_r(o))).features.map(function(a){if(a.id=a.id||Mn(),a.geometry===null)throw new Error("Invalid geometry: null");if(n.store.get(a.id)===void 0||n.store.get(a.id).type!==a.geometry.type){var s=ri[a.geometry.type];if(s===void 0)throw new Error("Invalid geometry type: "+a.geometry.type+".");var c=new s(n,a);n.store.add(c)}else{var h=n.store.get(a.id);h.properties=a.properties,ni(h.getCoordinates(),a.geometry.coordinates)||h.incomingCoords(a.geometry.coordinates)}return a.id});return n.store.render(),i},r.get=function(o){var i=n.store.get(o);if(i)return i.toGeoJSON(!!i.properties.isCustom)},r.getAll=function(){return{type:Ue,features:n.store.getAll().map(function(o){return o.toGeoJSON(!!o.properties.isCustom)})}},r.delete=function(o){return n.store.delete(o,{silent:!0}),r.getMode()!==L.DIRECT_SELECT||n.store.getSelectedIds().length?n.store.render():n.events.changeMode(L.SIMPLE_SELECT,void 0,{silent:!0}),r},r.deleteAll=function(){return n.store.delete(n.store.getAllIds(),{silent:!0}),r.getMode()===L.DIRECT_SELECT?n.events.changeMode(L.SIMPLE_SELECT,void 0,{silent:!0}):n.store.render(),r},r.changeMode=function(o,i){return i===void 0&&(i={}),o===L.SIMPLE_SELECT&&r.getMode()===L.SIMPLE_SELECT?(a=i.featureIds||[],s=n.store.getSelectedIds(),a.length===s.length&&JSON.stringify(a.map(function(c){return c}).sort())===JSON.stringify(s.map(function(c){return c}).sort())||(n.store.setSelected(i.featureIds,{silent:!0}),n.store.render()),r):(o===L.DIRECT_SELECT&&r.getMode()===L.DIRECT_SELECT&&i.featureId===n.store.getSelectedIds()[0]||n.events.changeMode(o,i,{silent:!0}),r);var a,s},r.getMode=function(){return n.events.getMode()},r.trash=function(){return n.events.trash({silent:!0}),r},r.combineFeatures=function(){return n.events.combineFeatures({silent:!0}),r},r.uncombineFeatures=function(){return n.events.uncombineFeatures({silent:!0}),r},r.setFeatureProperty=function(o,i,a){return n.store.setFeatureProperty(o,i,a),n.store.render(),r},r}var ii=["mode","feature","mouse"],St=function(n,r){var o={options:r=function(a){a===void 0&&(a={});var s=qe(a);return a.controls||(s.controls={}),a.displayControlsDefault===!1?s.controls=qe(ti,a.controls):s.controls=qe(ei,a.controls),(s=qe(Qo,s)).styles=hr(s.styles,"cold").concat(hr(s.styles,"hot")),s}(r)};this.ctx=o;var i=oi(o,this);o.api=i,o.map=n,o.events=function(a){var s=Object.keys(a.options.modes).reduce(function(d,x){return d[x]=Ro(a.options.modes[x]),d},{}),c={},h={},u={},f=null,l=null;u.drag=function(d,x){x({point:d.point,time:new Date().getTime()})?(a.ui.queueMapClasses({mouse:Qr}),l.drag(d)):d.originalEvent.stopPropagation()},u.mousedrag=function(d){u.drag(d,function(x){return!Hn(c,x)})},u.touchdrag=function(d){u.drag(d,function(x){return!Qn(h,x)})},u.mousemove=function(d){if((d.originalEvent.buttons!==void 0?d.originalEvent.buttons:d.originalEvent.which)===1)return u.mousedrag(d);var x=sn(d,a);d.featureTarget=x,l.mousemove(d)},u.mousedown=function(d){c={time:new Date().getTime(),point:d.point};var x=sn(d,a);d.featureTarget=x,l.mousedown(d)},u.mouseup=function(d){var x=sn(d,a);d.featureTarget=x,Hn(c,{point:d.point,time:new Date().getTime()})?l.click(d):l.mouseup(d)},u.mouseout=function(d){l.mouseout(d)},u.touchstart=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled){h={time:new Date().getTime(),point:d.point};var x=wt.touch(d,null,a)[0];d.featureTarget=x,l.touchstart(d)}},u.touchmove=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled)return l.touchmove(d),u.touchdrag(d)},u.touchend=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled){var x=wt.touch(d,null,a)[0];d.featureTarget=x,Qn(h,{time:new Date().getTime(),point:d.point})?l.tap(d):l.touchend(d)}};var y=function(d){return!(d===8||d===46||d>=48&&d<=57)};function m(d,x,I){I===void 0&&(I={}),l.stop();var b=s[d];if(b===void 0)throw new Error(d+" is not valid");f=d;var M=b(a,x);l=Gn(M,a),I.silent||a.map.fire(io,{mode:d}),a.store.setDirty(),a.store.render()}u.keydown=function(d){(d.srcElement||d.target).classList[0]==="mapboxgl-canvas"&&(d.keyCode!==8&&d.keyCode!==46||!a.options.controls.trash?y(d.keyCode)?l.keydown(d):d.keyCode===49&&a.options.controls.point?m(L.DRAW_POINT):d.keyCode===50&&a.options.controls.line_string?m(L.DRAW_LINE_STRING):d.keyCode===51&&a.options.controls.polygon&&m(L.DRAW_POLYGON):(d.preventDefault(),l.trash()))},u.keyup=function(d){y(d.keyCode)&&l.keyup(d)},u.zoomend=function(){a.store.changeZoom()},u.data=function(d){if(d.dataType==="style"){var x=a.setup,I=a.map,b=a.options,M=a.store;b.styles.some(function(w){return I.getLayer(w.id)})||(x.addLayers(),M.setDirty(),M.render())}};var _={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){f=a.options.defaultMode,l=Gn(s[f](a),a)},changeMode:m,actionable:function(d){var x=!1;Object.keys(d).forEach(function(I){if(_[I]===void 0)throw new Error("Invalid action type");_[I]!==d[I]&&(x=!0),_[I]=d[I]}),x&&a.map.fire(ao,{actions:_})},currentModeName:function(){return f},currentModeRender:function(d,x){return l.render(d,x)},fire:function(d,x){u[d]&&u[d](x)},addEventListeners:function(){a.map.on("mousemove",u.mousemove),a.map.on("mousedown",u.mousedown),a.map.on("mouseup",u.mouseup),a.map.on("data",u.data),a.map.on("touchmove",u.touchmove),a.map.on("touchstart",u.touchstart),a.map.on("touchend",u.touchend),a.container.addEventListener("mouseout",u.mouseout),a.options.keybindings&&(a.container.addEventListener("keydown",u.keydown),a.container.addEventListener("keyup",u.keyup))},removeEventListeners:function(){a.map.off("mousemove",u.mousemove),a.map.off("mousedown",u.mousedown),a.map.off("mouseup",u.mouseup),a.map.off("data",u.data),a.map.off("touchmove",u.touchmove),a.map.off("touchstart",u.touchstart),a.map.off("touchend",u.touchend),a.container.removeEventListener("mouseout",u.mouseout),a.options.keybindings&&(a.container.removeEventListener("keydown",u.keydown),a.container.removeEventListener("keyup",u.keyup))},trash:function(d){l.trash(d)},combineFeatures:function(){l.combineFeatures()},uncombineFeatures:function(){l.uncombineFeatures()},getMode:function(){return f}}}(o),o.ui=function(a){var s={},c=null,h={mode:null,feature:null,mouse:null},u={mode:null,feature:null,mouse:null};function f(d){u=qe(u,d)}function l(){var d,x;if(a.container){var I=[],b=[];ii.forEach(function(M){u[M]!==h[M]&&(I.push(M+"-"+h[M]),u[M]!==null&&b.push(M+"-"+u[M]))}),I.length>0&&(d=a.container.classList).remove.apply(d,I),b.length>0&&(x=a.container.classList).add.apply(x,b),h=qe(h,u)}}function y(d,x){x===void 0&&(x={});var I=document.createElement("button");return I.className=zr+" "+x.className,I.setAttribute("title",x.title),x.container.appendChild(I),I.addEventListener("click",function(b){if(b.preventDefault(),b.stopPropagation(),b.target===c)return m(),void x.onDeactivate();_(d),x.onActivate()},!0),I}function m(){c&&(c.classList.remove(Zn),c=null)}function _(d){m();var x=s[d];x&&x&&d!=="trash"&&(x.classList.add(Zn),c=x)}return{setActiveButton:_,queueMapClasses:f,updateMapClasses:l,clearMapClasses:function(){f({mode:null,feature:null,mouse:null}),l()},addButtons:function(){var d=a.options.controls,x=document.createElement("div");return x.className=Xr+" "+Jr,d&&(d[Zt]&&(s[Zt]=y(Zt,{container:x,className:Gr,title:"LineString tool "+(a.options.keybindings?"(l)":""),onActivate:function(){return a.events.changeMode(L.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),d[ht]&&(s[ht]=y(ht,{container:x,className:Wr,title:"Polygon tool "+(a.options.keybindings?"(p)":""),onActivate:function(){return a.events.changeMode(L.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),d[Ye]&&(s[Ye]=y(Ye,{container:x,className:qr,title:"Marker tool "+(a.options.keybindings?"(m)":""),onActivate:function(){return a.events.changeMode(L.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),d.trash&&(s.trash=y("trash",{container:x,className:Zr,title:"Delete",onActivate:function(){a.events.trash()}})),d.combine_features&&(s.combine_features=y("combineFeatures",{container:x,className:Kr,title:"Combine",onActivate:function(){a.events.combineFeatures()}})),d.uncombine_features&&(s.uncombine_features=y("uncombineFeatures",{container:x,className:Yr,title:"Uncombine",onActivate:function(){a.events.uncombineFeatures()}}))),x},removeButtons:function(){Object.keys(s).forEach(function(d){var x=s[d];x.parentNode&&x.parentNode.removeChild(x),delete s[d]})}}}(o),o.container=n.getContainer(),o.store=new R(o),o.options.boxSelect&&(n.boxZoom.disable(),n.dragPan.disable(),n.dragPan.enable()),this.connect(),o.events.start()};St.prototype.connect=function(){var n=this,r=this.ctx;this.addLayers(),this.updateLayersZIndexWapepr=function(){n.updateLayersZIndex()},r.map.on("layerAdded",this.updateLayersZIndexWapepr),r.map.on("layerMoved",this.updateLayersZIndexWapepr),r.store.storeMapConfig(),r.events.addEventListeners()},St.prototype.addLayers=function(){var n=this.ctx;n.map.addSource(Mt,{data:{type:Ue,features:[]},buffer:512,type:"geojson"}),n.map.addSource(lt,{data:{type:Ue,features:[]},buffer:512,type:"geojson"}),n.options.styles.forEach(function(r){n.map.addLayer(r)}),n.store.setDirty(!0),n.store.render()},St.prototype.updateLayersZIndex=function(){var n=this.ctx,r=n.map,o=n.options.styles,i=r.getStyle().layers;i===void 0&&(i=[]),i.length!==0&&i[i.length-1].id!==o[o.length-1].id&&o.forEach(function(a){r.getLayer(a.id)&&r.moveLayer(a.id,null,!1)})},St.prototype.removeLayers=function(){var n=this.ctx;n.options.styles.forEach(function(r){n.map.getLayer(r.id)&&n.map.removeLayer(r.id)}),n.map.getSource(Mt)&&n.map.removeSource(Mt),n.map.getSource(lt)&&n.map.removeSource(lt)},St.prototype.destroy=function(){var n=this.ctx;return n.map.off("layerAdded",this.updateLayersZIndexWapepr),n.map.off("layerMoved",this.updateLayersZIndexWapepr),this.removeLayers(),n.store.restoreMapConfig(),n.events.removeEventListeners(),n.map=null,n.container=null,n.store=null,this};export{St as $};
